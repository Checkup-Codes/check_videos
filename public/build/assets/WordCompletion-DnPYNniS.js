import{Q as ue,p as h,r as p,m as de,y as ge,c as i,o as c,a as n,t as u,F as x,g as k,h as L,n as A,f as U,S as ve,U as me,N as fe,I as N}from"./ssr-CelVhnxm.js";import{g as y}from"./index-D3jsOSc0.js";import{_ as he}from"./app-DKGn_rdn.js";/* empty css            */const m=I=>(ve("data-v-1b7eec00"),I=I(),me(),I),pe={class:"flex flex-col items-center justify-center"},xe={key:0,class:"game-summary w-full max-w-md rounded-2xl border border-gray-200 bg-white px-6 shadow-sm"},ye=m(()=>n("h2",{class:"mb-2 text-2xl font-semibold text-gray-900"},"Test Özeti",-1)),we={class:"mb-4 text-center"},_e={class:"text-4xl font-bold text-gray-900"},be=m(()=>n("p",{class:"text-sm text-gray-600"},"Puan",-1)),ke={class:"mb-4 grid grid-cols-2 gap-4 rounded-lg bg-gray-50 p-4"},Le={class:"text-center"},Ie={class:"text-2xl font-bold text-green-600"},Ce=m(()=>n("p",{class:"text-sm text-gray-600"},"Doğru",-1)),Ae={class:"text-center"},Pe={class:"text-2xl font-bold text-red-600"},Se=m(()=>n("p",{class:"text-sm text-gray-600"},"Yanlış",-1)),Qe={class:"mb-4 text-center"},Me={class:"text-3xl font-bold text-blue-600"},je=m(()=>n("p",{class:"text-sm text-gray-600"},"Toplam Puan",-1)),Ue={class:"mb-4 max-h-60 overflow-y-auto"},ze=m(()=>n("h3",{class:"mb-2 font-medium text-gray-700"},"Cevaplarınız:",-1)),He={class:"space-y-2 text-left text-sm text-gray-800"},Re={class:"flex flex-col"},Be={class:"text-xs text-gray-500"},Te={key:0,class:"text-xs text-blue-600"},De={class:"space-y-2"},Ee={key:1,disabled:"",class:"w-full rounded-lg bg-blue-400 px-4 py-2 text-center text-sm font-medium text-white"},qe={class:"flex gap-2"},Ke={class:"relative mb-4 h-1 w-full overflow-hidden rounded-full bg-gray-200"},$e={class:"mb-4 flex items-center justify-between text-sm text-gray-500"},Ge={class:"flex flex-col items-end gap-1"},Ne={class:"flex items-center gap-2"},We={class:"font-medium text-blue-600"},Fe=m(()=>n("span",null,"toplam puan",-1)),Oe={class:"flex items-center gap-2 text-xs"},Ve={class:"font-medium text-gray-600"},Ye=m(()=>n("span",null,"mevcut soru puanı",-1)),Je=m(()=>n("div",{class:"flex items-center justify-between"},[n("h2",{class:"text-xl font-semibold text-gray-900"},"Eksik harfleri tamamlayın:")],-1)),Xe={class:"mt-1 text-sm text-gray-500"},Ze={class:"space-y-2"},et={key:0,class:"flex justify-center space-x-2"},tt=["disabled"],st={key:1,class:"mt-4"},nt={class:"flex flex-col gap-1 rounded-lg border border-gray-200 bg-gray-100 p-2"},rt={class:"flex gap-1"},ot=["onClick"],at={class:"flex gap-1"},lt=["onClick"],it={class:"flex gap-1"},ct=["onClick"],ut=m(()=>n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[n("path",{d:"M10 2a8 8 0 100 16 8 8 0 000-16zm0 14a6 6 0 110-12 6 6 0 010 12zm-1-5a1 1 0 011-1h2a1 1 0 110 2h-2a1 1 0 01-1-1zm0-4a1 1 0 011-1h2a1 1 0 110 2h-2a1 1 0 01-1-1z"})],-1)),dt=m(()=>n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[n("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)),gt={__name:"WordCompletion",props:{gameType:String,packSlug:String,words:Array,gameConfig:Object},emits:["game-completed"],setup(I,{emit:W}){const d=I,z=W,H=ue(),F=H.props.languagePacks||[],S=h(()=>{var t;return!!((t=H.props.auth)!=null&&t.user)});h(()=>d.packSlug?F.find(t=>t.slug===d.packSlug):null);const e=p({isLoading:!0,isPlaying:!1,currentQuestion:null,showAnswer:!1,isCorrect:!1,progress:0,currentIndex:0,totalQuestions:0,userResponses:[],maskedIndices:[],selectedLetters:[],hintShown:!1,currentHintIndex:0,correctAnswer:"",totalPoints:0,displayPoints:0,hintsUsed:0,hintLetterIndices:[],isHintAnimating:!1}),w=p([]),R=h(()=>Object.fromEntries(w.value.map(t=>[t.id,t]))),Q=h(()=>e.value.selectedLetters.every(t=>t!=="")),_=p(!1),P=p(!1),B=()=>{P.value=!P.value},O=()=>{const t=[...e.value.selectedLetters].reverse().findIndex((o,s)=>{const r=e.value.selectedLetters.length-1-s;return o&&!e.value.hintLetterIndices.includes(r)});if(t!==-1){const o=e.value.selectedLetters.length-1-t;e.value.selectedLetters[o]=""}},V=()=>{if(e.value.showAnswer||e.value.isHintAnimating)return;const t=q(e.value.currentQuestion.word.length);if(e.value.hintsUsed>=t){console.log("Maksimum ipucu sayısına ulaşıldı");return}const o=e.value.maskedIndices.filter((s,r)=>!e.value.selectedLetters[r]);if(o.length>0){const s=o[Math.floor(Math.random()*o.length)],r=e.value.currentQuestion.word[s].toLowerCase();e.value.isHintAnimating=!0;const a=C.value.children[s],l="abcdefghijklmnopqrstuvwxyz".split("");let v=50,g=0;const f=20,b=setInterval(()=>{a.textContent=l[Math.floor(Math.random()*l.length)],g>f*.7&&(v+=10),g++,g>=f&&(clearInterval(b),a.textContent=r,e.value.selectedLetters[s]=r,e.value.hintsUsed++,e.value.hintLetterIndices.push(s),y.to(a,{scale:1.1,duration:.2,yoyo:!0,repeat:1,onComplete:()=>{e.value.isHintAnimating=!1}}))},v)}},T=()=>{if(!d.words||d.words.length<2){alert("Oyunu başlatmak için en az 2 kelime gereklidir.");return}e.value.isLoading=!0;let t=[...d.words];if(d.gameConfig.wordType&&(t=t.filter(s=>s.type===d.gameConfig.wordType)),d.gameConfig.learningStatus!==""&&(t=t.filter(s=>s.learning_status===parseInt(d.gameConfig.learningStatus))),d.gameConfig.difficultyLevel&&(t=t.filter(s=>s.difficulty_level===d.gameConfig.difficultyLevel)),d.gameConfig.prioritizeUnlearned){const s=t.filter(l=>l.learning_status===0),r=t.filter(l=>l.learning_status===1),a=t.filter(l=>l.learning_status===2);t=[...s,...r,...a]}d.gameConfig.prioritizeRecentlyLearned&&t.sort((s,r)=>{const a=new Date(s.last_reviewed_at||0);return new Date(r.last_reviewed_at||0)-a}),d.gameConfig.prioritizeFlagged&&t.sort((s,r)=>s.is_flagged&&!r.is_flagged?-1:!s.is_flagged&&r.is_flagged?1:0),d.gameConfig.prioritizeMostIncorrect&&t.sort((s,r)=>{const a=s.incorrect_count||0;return(r.incorrect_count||0)-a}),t=t.sort(()=>Math.random()-.5);const o=Math.min(d.gameConfig.questionCount,t.length);t=t.slice(0,o),w.value=t,e.value.totalQuestions=w.value.length,e.value.currentIndex=0,e.value.userResponses=[],e.value.isLoading=!1,e.value.isPlaying=!0,D()},Y=h(()=>{if(!e.value.userResponses.length)return 0;const t=e.value.userResponses.filter(o=>o.correct).length;return Math.round(t/e.value.userResponses.length*100)}),J=h(()=>{if(!e.value.currentQuestion)return 0;const o=e.value.currentQuestion.word.length*100,s=e.value.hintsUsed*100;return o-s}),X=()=>"abcçdefgğhıijklmnoöprsştuüvwxyz".split(""),Z=h(()=>e.value.userResponses.filter(t=>t.correct).length),ee=h(()=>e.value.userResponses.filter(t=>!t.correct).length),D=()=>{if(e.value.currentIndex>=w.value.length){ae();return}const t=w.value[e.value.currentIndex].word,o=t.length;console.log("Yeni soru yükleniyor:",{currentIndex:e.value.currentIndex,word:t,wordLength:o});const r={...{isLoading:e.value.isLoading,isPlaying:e.value.isPlaying,currentIndex:e.value.currentIndex,totalQuestions:e.value.totalQuestions,userResponses:e.value.userResponses,totalPoints:e.value.totalPoints,displayPoints:e.value.displayPoints},currentQuestion:w.value[e.value.currentIndex],selectedLetters:[],showAnswer:!1,hintShown:!1,currentHintIndex:0,hintsUsed:0,hintLetterIndices:[],isHintAnimating:!1,progress:0,maskedIndices:[]};e.value=r,e.value.selectedLetters=Array(o).fill(""),e.value.hintLetterIndices=[],e.value.maskedIndices=Array.from({length:o},(a,l)=>l),console.log("Yeni state:",{selectedLetters:e.value.selectedLetters,hintLetterIndices:e.value.hintLetterIndices,maskedIndices:e.value.maskedIndices}),N(()=>{console.log("DOM güncellendi, harf kutuları:",{selectedLetters:e.value.selectedLetters,hintLetterIndices:e.value.hintLetterIndices,maskedIndices:e.value.maskedIndices});const a=C.value.children;y.fromTo(a,{y:-50,opacity:0,scale:.8},{y:0,opacity:1,scale:1,duration:.5,stagger:.05,ease:"back.out(1.7)"})})},E=p(null),te=p(null),se=p(null),C=p(null),ne=t=>{const o=e.value.selectedLetters.findIndex(r=>!r);if(o===-1)return;const s=C.value.children[o];y.from(s,{scale:1.2,duration:.2,ease:"power2.out"})},M=t=>{if(e.value.showAnswer)return;const o=e.value.selectedLetters.findIndex(s=>!s);o!==-1&&(e.value.selectedLetters[o]=t.toLowerCase(),ne())},re=()=>e.value.selectedLetters.findIndex(t=>!t),q=t=>t<=3?1:t<=4?2:t<=5?3:4,K=t=>{if(e.value.showAnswer)return;const o=t.key.toLowerCase(),s=X();if(t.key==="Shift"){if(console.log("Shift tuşuna basıldı:",{selectedLetters:e.value.selectedLetters,hintLetterIndices:e.value.hintLetterIndices}),e.value.isHintAnimating)return;const r=q(e.value.currentQuestion.word.length);if(e.value.hintsUsed>=r){console.log("Maksimum ipucu sayısına ulaşıldı");return}const a=e.value.maskedIndices.filter((l,v)=>!e.value.selectedLetters[v]);if(a.length>0){const l=a[Math.floor(Math.random()*a.length)],v=e.value.currentQuestion.word[l].toLowerCase();e.value.isHintAnimating=!0;const g=C.value.children[l],f="abcdefghijklmnopqrstuvwxyz".split("");let b=50,j=0;const G=20,ce=setInterval(()=>{g.textContent=f[Math.floor(Math.random()*f.length)],j>G*.7&&(b+=10),j++,j>=G&&(clearInterval(ce),g.textContent=v,e.value.selectedLetters[l]=v,e.value.hintsUsed++,e.value.hintLetterIndices.push(l),y.to(g,{scale:1.1,duration:.2,yoyo:!0,repeat:1,onComplete:()=>{e.value.isHintAnimating=!1}}))},b)}}else if(s.includes(o)||o===" "){const r=e.value.selectedLetters.findIndex(a=>!a);r!==-1&&(e.value.selectedLetters[r]=o)}else if(t.key==="Backspace"){const r=[...e.value.selectedLetters].reverse().findIndex((a,l)=>{const v=e.value.selectedLetters.length-1-l;return a&&!e.value.hintLetterIndices.includes(v)});if(r!==-1){const a=e.value.selectedLetters.length-1-r;e.value.selectedLetters[a]=""}}else t.key==="Enter"&&Q.value&&$()},$=()=>{if(e.value.showAnswer||!Q.value)return;console.log("Cevap kontrolü öncesi:",{selectedLetters:e.value.selectedLetters,hintLetterIndices:e.value.hintLetterIndices});const t=e.value.currentQuestion.word.toLowerCase();let o=!0,s="";for(let g=0;g<e.value.maskedIndices.length;g++){const f=t[e.value.maskedIndices[g]],b=e.value.selectedLetters[g].toLowerCase();f!==b&&(o=!1),s+=f}console.log("Cevap kontrolü sonrası:",{isCorrect:o,correctAnswer:s,selectedLetters:e.value.selectedLetters,hintLetterIndices:e.value.hintLetterIndices}),e.value.isCorrect=o,e.value.correctAnswer=s;let r=0;o&&(r=t.length*100,r-=e.value.hintsUsed*100);const a=e.value.totalPoints,l=a+r;e.value.displayPoints=a,setTimeout(()=>{oe(a,l)},500),e.value.userResponses.push({word_id:e.value.currentQuestion.id,correct:o,points:r,hintsUsed:e.value.hintsUsed}),e.value.showAnswer=!0;const v=Math.round((e.value.currentIndex+1)/e.value.totalQuestions*100);y.to(E.value,{width:`${v}%`,duration:.5,ease:"power2.out"}),setTimeout(()=>{e.value.currentIndex++,D()},2e3)},oe=(t,o)=>{y.to(e.value,{displayPoints:o,duration:1,ease:"power2.out",onUpdate:()=>{e.value.totalPoints=Math.round(e.value.displayPoints)}})},ae=()=>{console.log("Oyun bitti, özet ekranı gösteriliyor"),e.value.isPlaying=!1,N(()=>{const t=document.querySelector(".game-summary");t&&y.fromTo(t,{opacity:0,y:20},{opacity:1,y:0,duration:.5,ease:"power2.out"})})},le=()=>{e.value={isLoading:!0,isPlaying:!1,currentQuestion:null,showAnswer:!1,isCorrect:!1,progress:0,currentIndex:0,totalQuestions:0,userResponses:[],maskedIndices:[],selectedLetters:[],hintShown:!1,currentHintIndex:0,correctAnswer:"",totalPoints:0,displayPoints:0,hintsUsed:0,hintLetterIndices:[],isHintAnimating:!1},T()},ie=()=>{if(!S.value||!e.value.userResponses.length||_.value)return;_.value=!0;const t=e.value.userResponses.map(o=>({word_id:o.word_id,review_count:1,incorrect_count:o.correct?0:1}));fe.post("/update-words",{words:t},{preserveState:!0,onSuccess:()=>{console.log("İstatistikler başarıyla güncellendi"),_.value=!1,setTimeout(()=>{z("game-completed")},1e3)},onError:o=>{console.error("İstatistik güncelleme hatası:",o),_.value=!1}})};return de(()=>{T(),window.addEventListener("keydown",K)}),ge(()=>{window.removeEventListener("keydown",K)}),(t,o)=>(c(),i("div",pe,[!e.value.isPlaying&&e.value.userResponses.length>0?(c(),i("div",xe,[ye,n("div",we,[n("p",_e,u(Y.value)+" / 100",1),be]),n("div",ke,[n("div",Le,[n("p",Ie,u(Z.value),1),Ce]),n("div",Ae,[n("p",Pe,u(ee.value),1),Se])]),n("div",Qe,[n("p",Me,u(e.value.totalPoints),1),je]),n("div",Ue,[ze,n("ul",He,[(c(!0),i(x,null,k(e.value.userResponses,s=>{var r,a;return c(),i("li",{key:s.word_id,class:"flex items-center justify-between rounded-md bg-gray-50 px-4 py-2"},[n("div",Re,[n("span",{class:A(s.correct?"font-medium text-green-600":"font-medium text-red-600")},u(((r=R.value[s.word_id])==null?void 0:r.word)||"Unknown"),3),n("span",Be,u(((a=R.value[s.word_id])==null?void 0:a.meaning)||""),1),s.correct?(c(),i("span",Te,u(s.points)+" puan "+u(s.hintsUsed>0?`(${s.hintsUsed} ipucu kullanıldı)`:""),1)):L("",!0)]),n("span",{class:A(s.correct?"text-lg text-green-600":"text-lg text-red-600")},u(s.correct?"✓":"✗"),3)])}),128))])]),n("div",De,[S.value&&!_.value?(c(),i("button",{key:0,onClick:ie,class:"w-full rounded-lg bg-blue-600 px-4 py-2 text-center text-sm font-medium text-white transition hover:bg-blue-700"}," Kelime İstatistiklerini Güncelle ve Pakete Dön ")):L("",!0),S.value&&_.value?(c(),i("button",Ee," Güncelleniyor... ")):L("",!0),n("div",qe,[n("button",{onClick:o[0]||(o[0]=s=>z("game-completed")),class:"flex-1 rounded-lg bg-black px-4 py-2 text-center text-sm font-medium text-white transition hover:bg-gray-700"}," Pakete Dön "),n("button",{onClick:le,class:"flex-1 rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 transition hover:bg-gray-100"}," Tekrar Başla ")])])])):(c(),i("div",{key:1,class:A(["relative w-full max-w-md rounded-2xl border border-gray-200 p-6 shadow-sm transition-colors duration-500",{"bg-white":!e.value.showAnswer,"bg-green-50":e.value.showAnswer&&e.value.isCorrect,"bg-red-50":e.value.showAnswer&&!e.value.isCorrect}])},[n("div",Ke,[n("div",{ref_key:"progressBar",ref:E,class:"h-full w-0 bg-black"},null,512),n("div",{ref_key:"progressBarGlow",ref:te,class:"absolute left-0 top-0 h-full w-[50px] bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,512)]),n("div",$e,[n("div",null,"Soru "+u(e.value.currentIndex+1)+" / "+u(e.value.totalQuestions),1),n("div",Ge,[n("div",Ne,[n("span",We,u(e.value.totalPoints),1),Fe]),n("div",Oe,[n("span",Ve,u(J.value),1),Ye])])]),e.value.currentQuestion?(c(),i("div",{key:0,class:"space-y-4",ref_key:"questionContainer",ref:se},[n("div",null,[Je,n("p",Xe,"Anlam: "+u(e.value.currentQuestion.meaning),1)]),n("div",Ze,[n("div",{class:"flex justify-center space-x-2",ref_key:"selectedLettersContainer",ref:C},[(c(!0),i(x,null,k(e.value.currentQuestion.word.split(""),(s,r)=>(c(),i("div",{key:`${e.value.currentIndex}-${r}`,class:A(["flex h-12 w-12 items-center justify-center rounded-lg border text-xl font-semibold transition-all",{"border-gray-300":!e.value.selectedLetters[r],"border-black bg-gray-50":!e.value.selectedLetters[r]&&r===re(),"border-green-500 bg-green-50":e.value.showAnswer&&e.value.isCorrect,"border-red-500 bg-red-50":e.value.showAnswer&&!e.value.isCorrect,"border-blue-500":e.value.hintLetterIndices.includes(r)&&!e.value.isHintAnimating}])},[e.value.maskedIndices.includes(r)?(c(),i("span",{key:0,class:A({"text-blue-600":e.value.hintLetterIndices.includes(r)})},u(e.value.selectedLetters[r]||""),3)):(c(),i(x,{key:1},[U(u(s.toLowerCase()),1)],64))],2))),128))],512),e.value.showAnswer&&!e.value.isCorrect?(c(),i("div",et,[(c(!0),i(x,null,k(e.value.currentQuestion.word.split(""),(s,r)=>(c(),i("div",{key:r,class:"flex h-8 w-8 items-center justify-center rounded-lg border border-green-500 bg-green-50 text-sm font-medium text-green-700"},u(s.toLowerCase()),1))),128))])):L("",!0)]),n("button",{onClick:$,disabled:e.value.showAnswer||!Q.value,class:"w-full rounded-lg bg-black px-4 py-2 text-center text-sm font-medium text-white transition hover:bg-gray-700 disabled:opacity-50"}," Kontrol Et ",8,tt)],512)):L("",!0),P.value?(c(),i("div",st,[n("div",nt,[n("div",rt,[(c(),i(x,null,k(["q","w","e","r","t","y","u","ı","o","p","ğ","ü"],s=>n("button",{key:s,onClick:r=>M(s),class:"flex h-10 w-10 items-center justify-center rounded-lg bg-white text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 active:bg-gray-100"},u(s),9,ot)),64))]),n("div",at,[(c(),i(x,null,k(["a","s","d","f","g","h","j","k","l","ş","i"],s=>n("button",{key:s,onClick:r=>M(s),class:"flex h-10 w-10 items-center justify-center rounded-lg bg-white text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 active:bg-gray-100"},u(s),9,lt)),64))]),n("div",it,[(c(),i(x,null,k(["z","x","c","v","b","n","m","ö","ç"],s=>n("button",{key:s,onClick:r=>M(s),class:"flex h-10 w-10 items-center justify-center rounded-lg bg-white text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 active:bg-gray-100"},u(s),9,ct)),64))]),n("div",{class:"flex gap-1"},[n("button",{onClick:O,class:"flex h-10 flex-1 items-center justify-center rounded-lg bg-white text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 active:bg-gray-100"}," ← "),n("button",{onClick:V,class:"flex h-10 flex-1 items-center justify-center rounded-lg bg-blue-100 text-sm font-medium text-blue-700 shadow-sm transition hover:bg-blue-200 active:bg-blue-300"}," İpucu ")])])])):L("",!0),P.value?(c(),i("button",{key:3,onClick:B,class:"mt-4 flex w-full items-center justify-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 transition hover:bg-gray-50"},[dt,U(" Klavyeyi Kapat ")])):(c(),i("button",{key:2,onClick:B,class:"mt-4 flex w-full items-center justify-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 transition hover:bg-gray-50"},[ut,U(" Klavyeyi Aç ")]))],2))]))}},pt=he(gt,[["__scopeId","data-v-1b7eec00"]]);export{pt as default};
