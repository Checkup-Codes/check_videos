import{g as v,b as K,T as Q,y as I,s as Y,x as Z,c as d,a as r,j as p,n as C,u as i,t as m,i as ee,m as te,G as se,F as re,l as oe,k as V,h as ne,o as c,N as ie,H as S}from"./ssr-Dzsw7L2j.js";const le={class:"space-y-4 py-6"},ae={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ue=["value"],de={key:0,class:"mt-1 text-xs text-destructive"},ce=["value"],fe={key:0,class:"mt-1 text-xs text-destructive"},ve={class:"mb-1 flex items-center gap-2"},ge={key:0,class:"flex items-center gap-1.5"},pe={class:"text-sm text-foreground"},me={key:0,class:"text-xs text-muted-foreground"},be={class:"relative w-full"},he={key:0,class:"absolute z-30 mt-1 w-full rounded-md border border-border bg-popover shadow-lg"},xe={class:"max-h-60 w-full overflow-y-auto p-1"},we=["onMousedown"],ye={class:"flex flex-col gap-0.5"},ke={class:"font-medium"},_e={key:0,class:"text-xs text-muted-foreground"},Ce={key:0,class:"mt-1 text-xs text-destructive"},Ee=["value"],Se={key:0,class:"mt-1 text-xs text-destructive"},Fe={class:"flex justify-end gap-2 pt-2"},Le=["disabled"],je=["disabled"],Re={key:0,class:"mr-2 h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ze={__name:"CategoriesCreateFrom",props:{categories:{type:Array,default:()=>[]}},setup(H){const q=H,N=s=>{const e=[],n=new Set,a=u=>{!u||!Array.isArray(u)||u.forEach(o=>{o&&o.id&&!n.has(o.id)&&(n.add(o.id),e.push(o),o.children&&Array.isArray(o.children)&&o.children.length>0&&a(o.children))})};return a(s),e},w=v(q.categories||[]),g=K(()=>N(w.value)),t=Q({name:"",slug:"",parent_id:"",status:"public"});t.processing=!1;const F=v(null),L=v(null),j=v(null),R=v(null),l=v({name:"",slug:"",parent_id:"",status:""}),b=v(""),y=v(""),h=v(!1),M=v(!1),P=v(null),D=()=>{clearTimeout(P.value),E.value.length>0&&(h.value=!0)},O=()=>{P.value=setTimeout(()=>{h.value=!1},100)},x=s=>{if(!s||!g.value||g.value.length===0)return"";const e=u=>g.value.find(o=>o.id===u),n=(u,o=[])=>{const f=e(u);return f?(o.unshift(f.name),f.parent_id?n(f.parent_id,o):o):o},a=n(s);return a.length>1?a.slice(0,-1).join(" > "):""},z=s=>{if(!s||!g.value||g.value.length===0)return"";const e=u=>g.value.find(o=>o.id===u),n=(u,o=[])=>{const f=e(u);return f?(o.unshift(f.name),f.parent_id?n(f.parent_id,o):o):o};return n(s).join(" > ")},E=K(()=>{if(!g.value||g.value.length===0)return[];if(!b.value){const a=[],u=new Set;return g.value.forEach(o=>{o&&o.id&&!u.has(o.id)&&(u.add(o.id),a.push(o))}),a}const s=b.value.toLowerCase(),e=[],n=new Set;return g.value.forEach(a=>{if(!a||!a.name||n.has(a.id))return;const u=a.name.toLowerCase().includes(s),f=x(a.id).toLowerCase().includes(s),J=z(a.id).toLowerCase().includes(s);(u||f||J)&&(n.add(a.id),e.push(a))}),e}),$=()=>{Object.keys(l.value).forEach(e=>{l.value[e]=""});let s=!1;return(!t.name||t.name.trim()==="")&&(l.value.name="İsim zorunludur.",s=!0),(!t.slug||t.slug.trim()==="")&&(l.value.slug="Slug zorunludur.",s=!0),s&&T(),s},T=()=>{S(()=>{const s=[{ref:F,error:l.value.name},{ref:L,error:l.value.slug},{ref:j,error:l.value.parent_id},{ref:R,error:l.value.status}];for(const e of s)if(e.error&&e.ref.value){e.ref.value.scrollIntoView({behavior:"smooth",block:"center"}),S(()=>{const n=e.ref.value.querySelector("input, select");n&&n.focus()});break}})},A=()=>{t.reset(),t.processing=!1,t.status="public",Object.keys(l.value).forEach(s=>{l.value[s]=""}),b.value="",y.value="",t.parent_id=""},G=()=>{t.parent_id="",b.value.length>=1&&(h.value=!0)},U=s=>{if(!s||!s.id)return;t.parent_id=s.id,y.value=s.name;const e=z(s.id);b.value=e,S(()=>{h.value=!1})},X=()=>{t.parent_id="",b.value="",y.value=""};I(()=>t.name,s=>{s&&(t.slug=s.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""))});const B=()=>{$()||t.post(route("categories.store"),{onSuccess:()=>{ie.visit(route("categories.index"))},onError:e=>{Object.assign(l.value,e),T()}})};let k=null,_=null;Y(()=>{t.processing=!1,(!w.value||w.value.length===0)&&W(),document.addEventListener("keydown",s=>{s.key==="Escape"&&(h.value=!1)}),k=()=>{B()},window.addEventListener("sidebarFormSubmit",k),_=()=>{A()},window.addEventListener("sidebarFormReset",_)}),Z(()=>{k&&window.removeEventListener("sidebarFormSubmit",k),_&&window.removeEventListener("sidebarFormReset",_)}),I(()=>t.processing,s=>{window.dispatchEvent(new CustomEvent("formProcessingState",{detail:{processing:s}}))});const W=async()=>{M.value=!0;try{const s=await fetch(route("categories.index"),{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!s.ok)throw new Error("Failed to fetch categories");const e=await s.json();w.value=e.categories||[]}catch(s){console.error("Error fetching categories:",s)}finally{M.value=!1}};return(s,e)=>(c(),d("div",le,[r("form",{onSubmit:ne(B,["prevent"]),class:"space-y-4"},[r("div",ae,[r("div",{class:"md:col-span-2",ref_key:"nameRef",ref:F},[r("div",null,[e[5]||(e[5]=r("label",{class:"mb-1 block text-sm font-medium text-foreground"},"İsim",-1)),r("input",{type:"text",value:i(t).name,onInput:e[0]||(e[0]=n=>i(t).name=n.target.value),placeholder:"Kategori ismi",class:C(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":l.value.name||i(t).errors.name}])},null,42,ue),l.value.name||i(t).errors.name?(c(),d("p",de,m(l.value.name||i(t).errors.name),1)):p("",!0)])],512),r("div",{ref_key:"slugRef",ref:L},[e[6]||(e[6]=r("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Slug",-1)),r("input",{type:"text",value:i(t).slug,onInput:e[1]||(e[1]=n=>i(t).slug=n.target.value),placeholder:"kategori-slug",class:C(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":l.value.slug||i(t).errors.slug}])},null,42,ce),l.value.slug||i(t).errors.slug?(c(),d("p",fe,m(l.value.slug||i(t).errors.slug),1)):p("",!0)],512),r("div",{ref_key:"parentIdRef",ref:j},[r("div",ve,[e[9]||(e[9]=r("label",{class:"text-sm font-medium text-foreground"},"Üst Kategori",-1)),i(t).parent_id?(c(),d("div",ge,[e[8]||(e[8]=r("span",{class:"text-xs text-muted-foreground"},":",-1)),r("span",pe,m(y.value),1),x(i(t).parent_id)?(c(),d("span",me," ("+m(x(i(t).parent_id))+") ",1)):p("",!0),r("button",{type:"button",onClick:X,class:"flex h-4 w-4 items-center justify-center rounded text-muted-foreground transition-colors hover:text-destructive","aria-label":"Kaldır"},[...e[7]||(e[7]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):p("",!0)]),r("div",be,[ee(r("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=n=>b.value=n),onFocus:D,onBlur:O,onInput:G,onKeydown:e[3]||(e[3]=se(n=>h.value=!1,["esc"])),placeholder:"Üst kategori ara (opsiyonel)",class:C(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":l.value.parent_id||i(t).errors.parent_id}])},null,34),[[te,b.value]]),h.value&&E.value.length>0?(c(),d("div",he,[r("ul",xe,[(c(!0),d(re,null,oe(E.value,n=>(c(),d("li",{key:n.id,onMousedown:a=>U(n),class:"cursor-pointer rounded-sm px-2 py-1.5 text-sm text-popover-foreground transition-colors hover:bg-accent hover:text-accent-foreground"},[r("div",ye,[r("span",ke,m(n.name),1),x(n.id)?(c(),d("span",_e,[e[10]||(e[10]=r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mr-1 inline h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1)),V(" "+m(x(n.id)),1)])):p("",!0)])],40,we))),128))])])):p("",!0)]),l.value.parent_id||i(t).errors.parent_id?(c(),d("p",Ce,m(l.value.parent_id||i(t).errors.parent_id),1)):p("",!0)],512),r("div",{ref_key:"statusRef",ref:R},[e[12]||(e[12]=r("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Durum",-1)),r("select",{value:i(t).status,onChange:e[4]||(e[4]=n=>i(t).status=n.target.value),class:C(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":l.value.status||i(t).errors.status}])},[...e[11]||(e[11]=[r("option",{value:"public"},"Açık",-1),r("option",{value:"hidden"},"Gizli",-1)])],42,Ee),l.value.status||i(t).errors.status?(c(),d("p",Se,m(l.value.status||i(t).errors.status),1)):p("",!0)],512)]),r("div",Fe,[r("button",{type:"button",onClick:A,class:"inline-flex h-9 items-center justify-center rounded-md border border-input bg-background px-4 text-sm font-medium text-foreground ring-offset-background transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",disabled:i(t).processing}," Sıfırla ",8,Le),r("button",{type:"submit",class:"inline-flex h-9 items-center justify-center rounded-md bg-primary px-4 text-sm font-medium text-primary-foreground ring-offset-background transition-colors hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",disabled:i(t).processing},[i(t).processing?(c(),d("svg",Re,[...e[13]||(e[13]=[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):p("",!0),V(" "+m(i(t).processing?"Kaydediliyor...":"Kategoriyi Kaydet"),1)],8,je)])],32)]))}};export{ze as default};
