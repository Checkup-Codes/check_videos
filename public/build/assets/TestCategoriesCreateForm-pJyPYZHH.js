import{g as f,b as I,T as Y,y as V,s as Z,x as ee,c as d,a as r,j as g,n as w,u as i,t as m,i as te,m as se,G as re,F as oe,l as ne,k as H,h as ie,o as c,N as le,H as R}from"./ssr-DHg8KZh6.js";const ae={class:"space-y-4 py-6"},ue={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},de=["value"],ce={key:0,class:"mt-1 text-xs text-destructive"},fe=["value"],ve={key:0,class:"mt-1 text-xs text-destructive"},pe={class:"mb-1 flex items-center gap-2"},ge={key:0,class:"flex items-center gap-1.5"},me={class:"text-sm text-foreground"},be={key:0,class:"text-xs text-muted-foreground"},he={class:"relative w-full"},xe={key:0,class:"absolute z-30 mt-1 w-full rounded-md border border-border bg-popover shadow-lg"},we={class:"max-h-60 w-full overflow-y-auto p-1"},ke=["onMousedown"],ye={class:"flex flex-col gap-0.5"},_e={class:"font-medium"},Ce={key:0,class:"text-xs text-muted-foreground"},Ee={key:0,class:"mt-1 text-xs text-destructive"},Re=["value"],Se={key:0,class:"mt-1 text-xs text-destructive"},Fe=["value"],Le={key:0,class:"mt-1 text-xs text-destructive"},je={class:"flex justify-end gap-2 pt-2"},Me=["disabled"],Pe=["disabled"],ze={key:0,class:"mr-2 h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ke={__name:"TestCategoriesCreateForm",props:{categories:{type:Array,default:()=>[]}},setup(q){const N=q,D=s=>{const e=[],o=new Set,a=u=>{!u||!Array.isArray(u)||u.forEach(n=>{n&&n.id&&!o.has(n.id)&&(o.add(n.id),e.push(n),n.children&&Array.isArray(n.children)&&n.children.length>0&&a(n.children))})};return a(s),e},k=f(N.categories||[]),p=I(()=>D(k.value)),t=Y({name:"",slug:"",parent_id:null,status:"public",description:""});t.processing=!1;const S=f(null),F=f(null),L=f(null),j=f(null),M=f(null),l=f({name:"",slug:"",parent_id:"",status:"",description:""}),b=f(""),y=f(""),h=f(!1),P=f(!1),z=f(null),O=()=>{clearTimeout(z.value),E.value.length>0&&(h.value=!0)},$=()=>{z.value=setTimeout(()=>{h.value=!1},100)},x=s=>{if(!s||!p.value||p.value.length===0)return"";const e=u=>p.value.find(n=>n.id===u),o=(u,n=[])=>{const v=e(u);return v?(n.unshift(v.name),v.parent_id?o(v.parent_id,n):n):n},a=o(s);return a.length>1?a.slice(0,-1).join(" > "):""},T=s=>{if(!s||!p.value||p.value.length===0)return"";const e=u=>p.value.find(n=>n.id===u),o=(u,n=[])=>{const v=e(u);return v?(n.unshift(v.name),v.parent_id?o(v.parent_id,n):n):n};return o(s).join(" > ")},E=I(()=>{if(!p.value||p.value.length===0)return[];if(!b.value){const a=[],u=new Set;return p.value.forEach(n=>{n&&n.id&&!u.has(n.id)&&(u.add(n.id),a.push(n))}),a}const s=b.value.toLowerCase(),e=[],o=new Set;return p.value.forEach(a=>{if(!a||!a.name||o.has(a.id))return;const u=a.name.toLowerCase().includes(s),v=x(a.id).toLowerCase().includes(s),Q=T(a.id).toLowerCase().includes(s);(u||v||Q)&&(o.add(a.id),e.push(a))}),e}),G=()=>{Object.keys(l.value).forEach(e=>{l.value[e]=""});let s=!1;return(!t.name||t.name.trim()==="")&&(l.value.name="İsim zorunludur.",s=!0),(!t.slug||t.slug.trim()==="")&&(l.value.slug="Slug zorunludur.",s=!0),s&&A(),s},A=()=>{R(()=>{const s=[{ref:S,error:l.value.name},{ref:F,error:l.value.slug},{ref:L,error:l.value.parent_id},{ref:j,error:l.value.status},{ref:M,error:l.value.description}];for(const e of s)if(e.error&&e.ref.value){e.ref.value.scrollIntoView({behavior:"smooth",block:"center"}),R(()=>{const o=e.ref.value.querySelector("input, select, textarea");o&&o.focus()});break}})},K=()=>{t.reset(),t.processing=!1,t.status="public",t.description="",Object.keys(l.value).forEach(s=>{l.value[s]=""}),b.value="",y.value="",t.parent_id=null},U=()=>{t.parent_id=null,b.value.length>=1&&(h.value=!0)},X=s=>{if(!s||!s.id)return;t.parent_id=s.id,y.value=s.name;const e=T(s.id);b.value=e,R(()=>{h.value=!1})},W=()=>{t.parent_id=null,b.value="",y.value=""};V(()=>t.name,s=>{s&&(t.slug=s.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""))});const B=()=>{G()||t.post(route("test-categories.store"),{onSuccess:()=>{le.visit(route("test-categories.index"))},onError:e=>{Object.assign(l.value,e),A()}})};let _=null,C=null;Z(()=>{t.processing=!1,(!k.value||k.value.length===0)&&J(),document.addEventListener("keydown",s=>{s.key==="Escape"&&(h.value=!1)}),_=()=>{B()},window.addEventListener("sidebarFormSubmit",_),C=()=>{K()},window.addEventListener("sidebarFormReset",C)}),ee(()=>{_&&window.removeEventListener("sidebarFormSubmit",_),C&&window.removeEventListener("sidebarFormReset",C)}),V(()=>t.processing,s=>{window.dispatchEvent(new CustomEvent("formProcessingState",{detail:{processing:s}}))});const J=async()=>{P.value=!0;try{const s=await fetch(route("test-categories.index"),{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!s.ok)throw new Error("Failed to fetch categories");const e=await s.json();k.value=e.categories||[]}catch(s){console.error("Error fetching categories:",s)}finally{P.value=!1}};return(s,e)=>(c(),d("div",ae,[r("form",{onSubmit:ie(B,["prevent"]),class:"space-y-4"},[r("div",ue,[r("div",{class:"md:col-span-2",ref_key:"nameRef",ref:S},[r("div",null,[e[6]||(e[6]=r("label",{class:"mb-1 block text-sm font-medium text-foreground"},"İsim",-1)),r("input",{type:"text",value:i(t).name,onInput:e[0]||(e[0]=o=>i(t).name=o.target.value),placeholder:"Kategori ismi",class:w(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":l.value.name||i(t).errors.name}])},null,42,de),l.value.name||i(t).errors.name?(c(),d("p",ce,m(l.value.name||i(t).errors.name),1)):g("",!0)])],512),r("div",{ref_key:"slugRef",ref:F},[e[7]||(e[7]=r("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Slug",-1)),r("input",{type:"text",value:i(t).slug,onInput:e[1]||(e[1]=o=>i(t).slug=o.target.value),placeholder:"kategori-slug",class:w(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":l.value.slug||i(t).errors.slug}])},null,42,fe),l.value.slug||i(t).errors.slug?(c(),d("p",ve,m(l.value.slug||i(t).errors.slug),1)):g("",!0)],512),r("div",{ref_key:"parentIdRef",ref:L},[r("div",pe,[e[10]||(e[10]=r("label",{class:"text-sm font-medium text-foreground"},"Üst Kategori",-1)),i(t).parent_id?(c(),d("div",ge,[e[9]||(e[9]=r("span",{class:"text-xs text-muted-foreground"},":",-1)),r("span",me,m(y.value),1),x(i(t).parent_id)?(c(),d("span",be," ("+m(x(i(t).parent_id))+") ",1)):g("",!0),r("button",{type:"button",onClick:W,class:"flex h-4 w-4 items-center justify-center rounded text-muted-foreground transition-colors hover:text-destructive","aria-label":"Kaldır"},[...e[8]||(e[8]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):g("",!0)]),r("div",he,[te(r("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=o=>b.value=o),onFocus:O,onBlur:$,onInput:U,onKeydown:e[3]||(e[3]=re(o=>h.value=!1,["esc"])),placeholder:"Üst kategori ara (opsiyonel)",class:w(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":l.value.parent_id||i(t).errors.parent_id}])},null,34),[[se,b.value]]),h.value&&E.value.length>0?(c(),d("div",xe,[r("ul",we,[(c(!0),d(oe,null,ne(E.value,o=>(c(),d("li",{key:o.id,onMousedown:a=>X(o),class:"cursor-pointer rounded-sm px-2 py-1.5 text-sm text-popover-foreground transition-colors hover:bg-accent hover:text-accent-foreground"},[r("div",ye,[r("span",_e,m(o.name),1),x(o.id)?(c(),d("span",Ce,[e[11]||(e[11]=r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mr-1 inline h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1)),H(" "+m(x(o.id)),1)])):g("",!0)])],40,ke))),128))])])):g("",!0)]),l.value.parent_id||i(t).errors.parent_id?(c(),d("p",Ee,m(l.value.parent_id||i(t).errors.parent_id),1)):g("",!0)],512),r("div",{ref_key:"statusRef",ref:j},[e[13]||(e[13]=r("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Durum",-1)),r("select",{value:i(t).status,onChange:e[4]||(e[4]=o=>i(t).status=o.target.value),class:w(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":l.value.status||i(t).errors.status}])},[...e[12]||(e[12]=[r("option",{value:"public"},"Açık",-1),r("option",{value:"private"},"Özel",-1),r("option",{value:"hidden"},"Gizli",-1)])],42,Re),l.value.status||i(t).errors.status?(c(),d("p",Se,m(l.value.status||i(t).errors.status),1)):g("",!0)],512),r("div",{class:"md:col-span-2",ref_key:"descriptionRef",ref:M},[e[14]||(e[14]=r("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Açıklama",-1)),r("textarea",{value:i(t).description,onInput:e[5]||(e[5]=o=>i(t).description=o.target.value),placeholder:"Kategori açıklaması (opsiyonel)",rows:"3",class:w(["flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":l.value.description||i(t).errors.description}])},null,42,Fe),l.value.description||i(t).errors.description?(c(),d("p",Le,m(l.value.description||i(t).errors.description),1)):g("",!0)],512)]),r("div",je,[r("button",{type:"button",onClick:K,class:"inline-flex h-9 items-center justify-center rounded-md border border-input bg-background px-4 text-sm font-medium text-foreground ring-offset-background transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",disabled:i(t).processing}," Sıfırla ",8,Me),r("button",{type:"submit",class:"inline-flex h-9 items-center justify-center rounded-md bg-primary px-4 text-sm font-medium text-primary-foreground ring-offset-background transition-colors hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",disabled:i(t).processing},[i(t).processing?(c(),d("svg",ze,[...e[15]||(e[15]=[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):g("",!0),H(" "+m(i(t).processing?"Kaydediliyor...":"Kategoriyi Kaydet"),1)],8,Pe)])],32)]))}};export{Ke as default};
