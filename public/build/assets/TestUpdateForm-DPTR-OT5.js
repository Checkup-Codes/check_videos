import{Q,e as h,p as U,m as z,T as P,c as d,a as t,k as b,h as f,v as m,u as r,n as x,t as g,E as Y,J,F as C,g as $,f as q,b as W,w as X,i as Z,l as I,o as a,N as ee}from"./ssr-BDs4_-3i.js";const te={class:"space-y-6 py-6"},se={class:"space-y-4 rounded-lg border border-border bg-card p-6"},oe={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},re={class:"md:col-span-2",ref:"titleRef"},ie={key:0,class:"mt-1 text-xs text-destructive"},le={ref:"slugRef"},ne={key:0,class:"mt-1 text-xs text-destructive"},ue={ref:"statusRef"},de={key:0,class:"mt-1 text-xs text-destructive"},ae={class:"md:col-span-2",ref:"descriptionRef"},ce={key:0,class:"mt-1 text-xs text-destructive"},pe={ref:"categoryRef"},fe={class:"relative"},be={key:1,tabindex:"0",class:"absolute z-50 mt-1 max-h-48 w-full overflow-y-auto rounded border border-border bg-popover shadow-lg"},ge=["onMousedown"],me={key:0,class:"mt-1 text-xs text-destructive"},ve={ref:"timeLimitRef"},xe={key:0,class:"mt-1 text-xs text-destructive"},_e={ref:"publishedAtRef"},he={class:"flex gap-2"},ye={key:0,class:"mt-1 text-xs text-destructive"},ke={class:"space-y-4 rounded-lg border border-border bg-card p-6"},we={key:0,class:"text-sm text-muted-foreground"},Ce={class:"flex items-center justify-between"},$e={class:"text-lg font-semibold text-foreground"},qe=["onClick"],Se={class:"space-y-4"},Te=["onUpdate:modelValue"],Ve={key:0,class:"mt-1 text-xs text-destructive"},je={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Ue=["onUpdate:modelValue"],ze=["onUpdate:modelValue"],Ee={class:"space-y-3"},Be={class:"flex items-center justify-between"},Me=["onClick"],Ae={class:"flex-1 space-y-2"},De={class:"flex items-center gap-2"},Le={class:"flex h-6 w-6 items-center justify-center rounded-full bg-muted text-xs font-medium text-muted-foreground"},Re=["onUpdate:modelValue","placeholder"],Oe={class:"flex items-center gap-2"},Fe={class:"flex cursor-pointer items-center gap-2"},Ne=["name","checked","onChange"],Ke=["onClick"],Ge={key:0,class:"text-xs text-destructive"},He={class:"flex gap-4"},Qe=["disabled"],Pe={key:0},Ye={key:1},Xe={__name:"TestUpdateForm",setup(Je){const{props:S}=Q(),c=h(S.test||{}),E=n=>{const e=[],o=new Set,l=u=>{!u||!Array.isArray(u)||u.forEach(p=>{p&&p.id&&!o.has(p.id)&&(o.add(p.id),e.push(p),p.children&&Array.isArray(p.children)&&p.children.length>0&&l(p.children))})};return l(n),e},B=h(S.categories||[]),k=U(()=>E(B.value)),_=h(""),y=h(!1),T=h(null);z(()=>{if(c.value.category_id){const n=k.value.find(e=>e.id===c.value.category_id);n&&(_.value=n.name)}});const V=U(()=>{if(!_.value)return k.value.slice(0,10);const n=_.value.toLowerCase();return k.value.filter(e=>e.name.toLowerCase().includes(n)).slice(0,10)}),M=()=>{clearTimeout(T.value),y.value=!0},A=()=>{T.value=setTimeout(()=>{y.value=!1},200)},D=()=>{y.value=!0},L=n=>{s.category_id=n.id,_.value=n.name,y.value=!1},R=()=>{s.category_id=null,_.value=""},v=h({date:"",time:""});if(c.value.published_at){const n=new Date(c.value.published_at);v.value.date=n.toISOString().split("T")[0],v.value.time=n.toTimeString().slice(0,5)}const s=P({title:c.value.title||"",slug:c.value.slug||"",description:c.value.description||"",category_id:c.value.category_id||null,status:c.value.status||"draft",time_limit:c.value.time_limit||null,published_at:c.value.published_at||null,questions:[]});z(()=>{c.value.questions&&c.value.questions.length>0?s.questions=c.value.questions.map(n=>({question_text:n.question_text||"",question_type:n.question_type||"multiple_choice",points:n.points||10,explanation:n.explanation||"",order:n.order||0,options:(n.options||[]).map((e,o)=>({option_text:e.option_text||"",is_correct:e.is_correct||!1,order:o}))})):j()});const j=()=>{s.questions.push({question_text:"",question_type:"multiple_choice",points:10,explanation:"",order:s.questions.length,options:[{option_text:"",is_correct:!1,order:0},{option_text:"",is_correct:!1,order:1},{option_text:"",is_correct:!1,order:2},{option_text:"",is_correct:!1,order:3}]})},O=n=>{s.questions.splice(n,1),s.questions.forEach((e,o)=>{e.order=o})},F=n=>{const e=s.questions[n];e.options.push({option_text:"",is_correct:!1,order:e.options.length})},N=(n,e)=>{const o=s.questions[n];o.options.length>2&&(o.options.splice(e,1),o.options.forEach((l,u)=>{l.order=u}))},K=(n,e)=>{s.questions[n].options.forEach((l,u)=>{l.is_correct=u===e})},i=h({}),G=()=>(i.value={},(!s.title||s.title.trim()==="")&&(i.value.title="Başlık zorunludur."),(!s.slug||s.slug.trim()==="")&&(i.value.slug="Slug zorunludur."),s.questions.length===0&&(i.value.questions="En az bir soru eklenmelidir."),s.questions.forEach((n,e)=>{(!n.question_text||n.question_text.trim()==="")&&(i.value[`questions.${e}.question_text`]="Soru metni zorunludur."),(!n.options||n.options.length<2)&&(i.value[`questions.${e}.options`]="En az 2 şık eklenmelidir."),n.options.some(l=>l.is_correct)||(i.value[`questions.${e}.options`]="En az bir doğru cevap seçilmelidir."),n.options.forEach((l,u)=>{(!l.option_text||l.option_text.trim()==="")&&(i.value[`questions.${e}.options.${u}.option_text`]="Şık metni zorunludur.")})}),Object.keys(i.value).length===0),H=()=>{if(!G())return;v.value.date&&v.value.time?s.published_at=`${v.value.date}T${v.value.time}:00`:s.published_at=null;const n=s.questions.map((e,o)=>({question_text:e.question_text,question_type:e.question_type||"multiple_choice",points:e.points||10,explanation:e.explanation||null,order:o,options:e.options.map((l,u)=>({option_text:l.option_text,is_correct:l.is_correct||!1,order:u}))}));s.questions=n,s.put(route("tests.update",{test:c.value.slug}),{onSuccess:e=>{var o,l;((l=(o=e==null?void 0:e.props)==null?void 0:o.test)!=null&&l.slug||s.slug)&&ee.visit(route("tests.show",{test:s.slug||c.value.slug}))},onError:e=>{e&&Object.keys(e).forEach(o=>{i.value.hasOwnProperty(o)&&(i.value[o]=e[o])})}})};return(n,e)=>(a(),d("div",te,[e[29]||(e[29]=t("div",{class:"mb-6"},[t("h1",{class:"text-3xl font-bold text-foreground"},"Test Düzenle"),t("p",{class:"mt-2 text-sm text-muted-foreground"},"Test bilgilerini ve sorularını düzenleyin")],-1)),t("form",{onSubmit:I(H,["prevent"]),class:"space-y-6"},[t("div",se,[e[17]||(e[17]=t("h2",{class:"text-xl font-semibold text-foreground"},"Test Bilgileri",-1)),t("div",oe,[t("div",re,[e[9]||(e[9]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Test Başlığı *",-1)),b(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>r(s).title=o),placeholder:"Test başlığını girin",class:x(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.title||r(s).errors.title}])},null,2),[[m,r(s).title]]),i.value.title||r(s).errors.title?(a(),d("p",ie,g(i.value.title||r(s).errors.title),1)):f("",!0)],512),t("div",le,[e[10]||(e[10]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Slug *",-1)),b(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=o=>r(s).slug=o),placeholder:"test-slug",class:x(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.slug||r(s).errors.slug}])},null,2),[[m,r(s).slug]]),i.value.slug||r(s).errors.slug?(a(),d("p",ne,g(i.value.slug||r(s).errors.slug),1)):f("",!0)],512),t("div",ue,[e[12]||(e[12]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Durum *",-1)),b(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>r(s).status=o),class:x(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",{"border-destructive focus-visible:ring-destructive":i.value.status||r(s).errors.status}])},[...e[11]||(e[11]=[t("option",{value:"draft"},"Taslak",-1),t("option",{value:"published"},"Yayınlandı",-1),t("option",{value:"private"},"Gizli",-1)])],2),[[Y,r(s).status]]),i.value.status||r(s).errors.status?(a(),d("p",de,g(i.value.status||r(s).errors.status),1)):f("",!0)],512),t("div",ae,[e[13]||(e[13]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Açıklama",-1)),b(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=o=>r(s).description=o),rows:"3",placeholder:"Test hakkında kısa bir açıklama",class:x(["flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.description||r(s).errors.description}])},null,2),[[m,r(s).description]]),i.value.description||r(s).errors.description?(a(),d("p",ce,g(i.value.description||r(s).errors.description),1)):f("",!0)],512),t("div",pe,[e[14]||(e[14]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Kategori",-1)),t("div",fe,[b(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=o=>_.value=o),onFocus:M,onBlur:A,onInput:D,onKeydown:e[5]||(e[5]=J(o=>y.value=!1,["esc"])),placeholder:"Kategori seçin...",class:x(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 pr-8 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.category_id||r(s).errors.category_id}]),tabindex:"0"},null,34),[[m,_.value]]),_.value?(a(),d("button",{key:0,onClick:R,class:"absolute right-2 top-1/2 inline-flex h-5 w-5 -translate-y-1/2 items-center justify-center rounded text-xs hover:bg-accent"}," ✕ ")):f("",!0),y.value&&V.value.length>0?(a(),d("ul",be,[(a(!0),d(C,null,$(V.value,o=>(a(),d("li",{key:o.id,onMousedown:l=>L(o),class:"cursor-pointer px-2 py-1.5 text-sm hover:bg-accent"},g(o.name),41,ge))),128))])):f("",!0)]),i.value.category_id||r(s).errors.category_id?(a(),d("p",me,g(i.value.category_id||r(s).errors.category_id),1)):f("",!0)],512),t("div",ve,[e[15]||(e[15]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Süre Limiti (dakika)",-1)),b(t("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=o=>r(s).time_limit=o),min:"0",placeholder:"Boş bırakılabilir",class:x(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.time_limit||r(s).errors.time_limit}])},null,2),[[m,r(s).time_limit,void 0,{number:!0}]]),i.value.time_limit||r(s).errors.time_limit?(a(),d("p",xe,g(i.value.time_limit||r(s).errors.time_limit),1)):f("",!0)],512),t("div",_e,[e[16]||(e[16]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Yayınlama Tarihi",-1)),t("div",he,[b(t("input",{type:"date","onUpdate:modelValue":e[7]||(e[7]=o=>v.value.date=o),class:x(["flex h-9 flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.published_at||r(s).errors.published_at}])},null,2),[[m,v.value.date]]),b(t("input",{type:"time","onUpdate:modelValue":e[8]||(e[8]=o=>v.value.time=o),class:x(["flex h-9 flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.published_at||r(s).errors.published_at}])},null,2),[[m,v.value.time]])]),i.value.published_at||r(s).errors.published_at?(a(),d("p",ye,g(i.value.published_at||r(s).errors.published_at),1)):f("",!0)],512)])]),t("div",ke,[t("div",{class:"flex items-center justify-between"},[e[19]||(e[19]=t("h2",{class:"text-xl font-semibold text-foreground"},"Sorular",-1)),t("button",{type:"button",onClick:j,class:"inline-flex h-9 items-center justify-center gap-2 rounded-md bg-primary px-4 text-sm font-medium text-primary-foreground hover:bg-primary/90"},[...e[18]||(e[18]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),q(" Soru Ekle ",-1)])])]),r(s).questions.length===0?(a(),d("p",we,' Henüz soru eklenmedi. "Soru Ekle" butonuna tıklayarak soru ekleyin. ')):f("",!0),(a(!0),d(C,null,$(r(s).questions,(o,l)=>(a(),d("div",{key:l,class:"space-y-4 rounded-lg border border-border bg-background p-4"},[t("div",Ce,[t("h3",$e,"Soru "+g(l+1),1),t("button",{type:"button",onClick:u=>O(l),class:"inline-flex h-8 w-8 items-center justify-center rounded-md text-destructive hover:bg-destructive/10"},[...e[20]||(e[20]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,qe)]),t("div",Se,[t("div",null,[e[21]||(e[21]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Soru Metni *",-1)),b(t("textarea",{"onUpdate:modelValue":u=>o.question_text=u,rows:"3",placeholder:"Soruyu buraya yazın...",class:x(["flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",{"border-destructive focus-visible:ring-destructive":i.value[`questions.${l}.question_text`]||r(s).errors[`questions.${l}.question_text`]}])},null,10,Te),[[m,o.question_text]]),i.value[`questions.${l}.question_text`]||r(s).errors[`questions.${l}.question_text`]?(a(),d("p",Ve,g(i.value[`questions.${l}.question_text`]||r(s).errors[`questions.${l}.question_text`]),1)):f("",!0)]),t("div",je,[t("div",null,[e[22]||(e[22]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Puan",-1)),b(t("input",{type:"number","onUpdate:modelValue":u=>o.points=u,min:"1",placeholder:"10",class:"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,8,Ue),[[m,o.points,void 0,{number:!0}]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Açıklama",-1)),b(t("input",{type:"text","onUpdate:modelValue":u=>o.explanation=u,placeholder:"Doğru cevap açıklaması (opsiyonel)",class:"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,8,ze),[[m,o.explanation]])])]),t("div",Ee,[t("div",Be,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-foreground"},"Şıklar *",-1)),t("button",{type:"button",onClick:u=>F(l),class:"inline-flex h-8 items-center justify-center gap-1 rounded-md border border-input bg-background px-3 text-xs font-medium text-foreground hover:bg-accent"},[...e[24]||(e[24]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),q(" Şık Ekle ",-1)])],8,Me)]),(a(!0),d(C,null,$(o.options,(u,p)=>(a(),d("div",{key:p,class:"flex items-start gap-3 rounded-lg border border-border bg-background p-3"},[t("div",Ae,[t("div",De,[t("span",Le,g(String.fromCharCode(65+p)),1),b(t("input",{type:"text","onUpdate:modelValue":w=>u.option_text=w,placeholder:`Şık ${p+1} metni`,class:x(["flex-1 rounded-md border border-input bg-background px-3 py-1.5 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",{"border-destructive focus-visible:ring-destructive":i.value[`questions.${l}.options.${p}.option_text`]||r(s).errors[`questions.${l}.options.${p}.option_text`]}])},null,10,Re),[[m,u.option_text]])])]),t("div",Oe,[t("label",Fe,[t("input",{type:"radio",name:`question-${l}-correct`,checked:u.is_correct,onChange:w=>K(l,p),class:"h-4 w-4 cursor-pointer text-primary focus:ring-primary"},null,40,Ne),e[26]||(e[26]=t("span",{class:"text-xs text-muted-foreground"},"Doğru",-1))]),o.options.length>2?(a(),d("button",{key:0,type:"button",onClick:w=>N(l,p),class:"inline-flex h-8 w-8 items-center justify-center rounded-md text-destructive hover:bg-destructive/10"},[...e[27]||(e[27]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Ke)):f("",!0)])]))),128)),i.value[`questions.${l}.options`]||r(s).errors[`questions.${l}.options`]?(a(),d("p",Ge,g(i.value[`questions.${l}.options`]||r(s).errors[`questions.${l}.options`]),1)):f("",!0)])])]))),128))]),t("div",He,[t("button",{type:"submit",disabled:r(s).processing,class:"inline-flex h-11 items-center justify-center rounded-md bg-primary px-8 text-sm font-medium text-primary-foreground hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-50"},[r(s).processing?(a(),d("span",Pe,"Güncelleniyor...")):(a(),d("span",Ye,"Testi Güncelle"))],8,Qe),W(r(Z),{href:`/tests/${c.value.slug}`,class:"inline-flex h-11 items-center justify-center rounded-md border border-input bg-background px-8 text-sm font-medium text-foreground hover:bg-accent hover:text-accent-foreground"},{default:X(()=>[...e[28]||(e[28]=[q(" İptal ",-1)])]),_:1},8,["href"])])],32)]))}};export{Xe as default};
