import{Q as X,p as x,r as b,m as ee,c as l,a as s,t as o,F as M,g as R,h,n as _,N as te,o as i,f as se,J as ne}from"./ssr-CAy-S3_r.js";import{g as d}from"./index-CH_iu5NA.js";import{_ as re}from"./app-CfiUSdJ9.js";/* empty css            */const oe={class:"flex flex-col items-center justify-center"},ae={key:0,class:"w-full max-w-2xl rounded-lg border border-base-300 bg-base-100 p-6"},le={class:"mb-4 text-center"},ie={class:"inline-flex items-center gap-2 rounded bg-base-200 px-3 py-1"},ue={class:"text-lg font-bold text-base-content"},ce={class:"mb-4 grid grid-cols-2 gap-4"},de={class:"rounded border border-base-300 bg-base-200 p-3 text-center"},ge={class:"mb-1"},xe={class:"mx-auto flex h-8 w-8 items-center justify-center rounded-full bg-green-100"},be={class:"text-sm font-bold text-green-600"},fe={class:"rounded border border-base-300 bg-base-200 p-3 text-center"},ve={class:"mb-1"},me={class:"mx-auto flex h-8 w-8 items-center justify-center rounded-full bg-red-100"},pe={class:"text-sm font-bold text-red-600"},he={class:"mb-4"},_e={class:"max-h-48 space-y-2 overflow-y-auto"},we={class:"flex items-center gap-2"},ye={class:"flex flex-col"},Ce={class:"text-sm font-medium text-base-content"},ke={class:"text-base-content/70 text-xs"},Ie={class:"space-y-2"},Qe=["disabled"],Se={class:"flex gap-2"},Ae={key:1,class:"w-full max-w-4xl rounded-lg border border-base-300 bg-base-100 p-6"},Oe={class:"mb-4 h-1 w-full overflow-hidden rounded-full bg-base-200"},Te={class:"mb-6 text-right"},Me={class:"text-base-content/70 text-sm"},Re={class:"mb-2 text-2xl font-semibold text-base-content"},Pe={class:"inline-flex items-center rounded border border-base-300 bg-base-200 px-2 py-1 text-xs text-base-content"},We={key:0,class:"rounded border border-base-300 bg-base-200 p-3"},De={class:"mb-2 flex items-center justify-between"},je={class:"text-sm text-base-content"},He=["onClick","disabled"],Be={class:"flex items-center gap-3"},ze={class:"flex h-6 w-6 items-center justify-center rounded-full bg-base-content text-xs font-bold text-base-100"},Le={key:1,class:"text-center"},Ne={__name:"MultipleChoice",props:{gameType:String,packSlug:String,words:Array,gameConfig:Object},emits:["game-completed"],setup(P,{emit:W}){const u=P,w=W,y=X(),D=y.props.languagePacks||[],C=x(()=>{var t;return!!((t=y.props.auth)!=null&&t.user)});x(()=>u.packSlug?D.find(t=>t.slug===u.packSlug):null);const e=b({isLoading:!0,isPlaying:!1,currentQuestion:null,currentOptions:[],selectedAnswer:null,showAnswer:!1,isCorrect:!1,progress:0,currentIndex:0,totalQuestions:0,userResponses:[],hintShown:!1,currentHintIndex:0}),f=b([]),k=x(()=>Object.fromEntries(f.value.map(t=>[t.id,t]))),I=b(null),Q=b(null),S=b(null),A=b(null),v=b(!1),j=()=>{d.fromTo(A.value,{opacity:0,y:20},{opacity:1,y:0,duration:.5,ease:"power2.out"}),d.fromTo(I.value.children,{opacity:0,x:-20},{opacity:1,x:0,duration:.3,stagger:.1,ease:"power2.out"})},H=t=>{d.to(t,{scale:1.05,duration:.2,backgroundColor:"#ecfdf5",borderColor:"#34d399",ease:"power2.out"}),d.to(t,{scale:1,duration:.2,delay:.2})},B=t=>{d.timeline().to(t,{scale:1.05,duration:.2,backgroundColor:"#fef2f2",borderColor:"#f87171",ease:"power2.out"}).to(t,{x:-10,duration:.1}).to(t,{x:10,duration:.1}).to(t,{x:-5,duration:.1}).to(t,{x:5,duration:.1}).to(t,{x:0,scale:1,duration:.2})},z=t=>{d.to(Q.value,{width:`${t}%`,duration:.5,ease:"power2.out"}),d.fromTo(S.value,{x:"-100%"},{x:"100%",duration:1,ease:"none",repeat:-1}),d.to(S.value,{opacity:t===100?0:.5,duration:.3})},L=()=>{e.value.currentIndex++,e.value.progress=Math.round(e.value.currentIndex/e.value.totalQuestions*100),e.value.currentIndex<e.value.totalQuestions?(e.value.selectedAnswer=null,e.value.showAnswer=!1,e.value.currentOptions=[],e.value.hintShown=f.value[e.value.currentIndex].example_sentences&&f.value[e.value.currentIndex].example_sentences.length>0,e.value.currentHintIndex=0,e.value.currentQuestion=f.value[e.value.currentIndex],ne(()=>{j()})):e.value.isPlaying=!1},O=async()=>{if(!u.words||u.words.length<2){alert("Oyunu başlatmak için en az 2 kelime gereklidir.");return}e.value.isLoading=!0;let t=[...u.words];if(u.gameConfig.prioritizeUnlearned){const r=t.filter(c=>c.learning_status===0),a=t.filter(c=>c.learning_status===1),g=t.filter(c=>c.learning_status===2);t=[...r,...a,...g]}u.gameConfig.prioritizeRecentlyLearned&&t.sort((r,a)=>{const g=new Date(r.last_reviewed_at||0);return new Date(a.last_reviewed_at||0)-g}),u.gameConfig.prioritizeFlagged&&t.sort((r,a)=>r.is_flagged&&!a.is_flagged?-1:!r.is_flagged&&a.is_flagged?1:0),u.gameConfig.prioritizeMostIncorrect&&t.sort((r,a)=>{const g=r.incorrect_count||0;return(a.incorrect_count||0)-g}),t=t.sort(()=>Math.random()-.5);const n=Math.min(u.gameConfig.questionCount,t.length);t=t.slice(0,n),e.value={isLoading:!1,isPlaying:!0,currentQuestion:t[0],currentOptions:[],selectedAnswer:null,showAnswer:!1,isCorrect:!1,progress:0,currentIndex:0,totalQuestions:t.length,userResponses:[],hintShown:t[0].example_sentences&&t[0].example_sentences.length>0,currentHintIndex:0},f.value=t},N=x(()=>{if(!e.value.userResponses.length)return 0;const t=e.value.userResponses.filter(n=>n.correct).length;return Math.round(t/e.value.userResponses.length*100)}),G=t=>{switch(t){case"noun":return"İsim";case"verb":return"Fiil";case"adjective":return"Sıfat";case"adverb":return"Zarf";default:return"Bilinmiyor"}},$=x(()=>e.value.userResponses.filter(t=>t.correct).length),E=x(()=>e.value.userResponses.filter(t=>!t.correct).length),F=x(()=>e.value.currentQuestion?(e.value.currentOptions.length===0&&(e.value.currentOptions=K(e.value.currentQuestion,f.value)),e.value.currentOptions):[]),U=t=>{e.value.selectedAnswer=t,e.value.showAnswer=!0,e.value.isCorrect=T(t,e.value.currentQuestion),e.value.userResponses.push({word_id:e.value.currentQuestion.id,selected_option:t.meaningText,correct:e.value.isCorrect});const n=event.target;e.value.isCorrect?H(n):B(n);const r=Math.round((e.value.currentIndex+1)/e.value.totalQuestions*100);z(r),setTimeout(()=>{L()},1500)},q=()=>{e.value={isLoading:!0,isPlaying:!1,currentQuestion:null,currentOptions:[],selectedAnswer:null,showAnswer:!1,isCorrect:!1,progress:0,currentIndex:0,totalQuestions:0,userResponses:[],hintShown:!1,currentHintIndex:0},O()},V=()=>{if(!C.value||!e.value.userResponses.length||v.value)return;v.value=!0;const t=e.value.userResponses.map(n=>({word_id:n.word_id,review_count:1,incorrect_count:n.correct?0:1}));te.post("/update-words",{words:t},{preserveState:!0,onSuccess:()=>{console.log("İstatistikler başarıyla güncellendi"),v.value=!1,w("game-completed")},onError:n=>{console.error("İstatistik güncelleme hatası:",n),v.value=!1}})},Y=()=>{if(!e.value.currentQuestion.example_sentences||e.value.currentQuestion.example_sentences.length===0){e.value.hintShown=!0;return}e.value.hintShown?e.value.currentHintIndex=(e.value.currentHintIndex+1)%e.value.currentQuestion.example_sentences.length:(e.value.hintShown=!0,e.value.currentHintIndex=0)},m=t=>{if(!t)return"";if(t.meanings&&t.meanings.length>0){const n=t.meanings.find(r=>r.is_primary);return n?n.meaning:t.meanings[0].meaning}return t.meaning||""},T=(t,n)=>!t||!n?!1:t.wordId===n.id,J=t=>{var n;return((n=e.value.selectedAnswer)==null?void 0:n.wordId)===t.wordId},Z=(t,n)=>e.value.showAnswer?T(t,e.value.currentQuestion)?"border-green-500 bg-green-50 text-green-800":J(t)?"border-red-500 bg-red-50 text-red-800":"border-base-300 bg-base-100 text-base-content":"border-base-300 bg-base-100 text-base-content",K=(t,n,r=4)=>{const a={wordId:t.id,meaningText:m(t),isCorrect:!0};return[...[...n.filter(p=>p.id!==t.id&&m(p)!==m(t))].sort(()=>.5-Math.random()).slice(0,r-1).map(p=>({wordId:p.id,meaningText:m(p),isCorrect:!1})),a].sort(()=>.5-Math.random())};return ee(()=>{O()}),(t,n)=>(i(),l("div",oe,[!e.value.isPlaying&&e.value.userResponses.length>0?(i(),l("div",ae,[s("div",le,[n[2]||(n[2]=s("h2",{class:"mb-2 text-xl font-semibold text-base-content"},"Test Tamamlandı",-1)),s("div",ie,[n[1]||(n[1]=s("span",{class:"text-base-content/70 text-sm"},"Puan:",-1)),s("span",ue,o(N.value)+" / 100",1)])]),s("div",ce,[s("div",de,[s("div",ge,[s("div",xe,[s("span",be,o($.value),1)])]),n[3]||(n[3]=s("p",{class:"text-base-content/70 text-xs"},"Doğru",-1))]),s("div",fe,[s("div",ve,[s("div",me,[s("span",pe,o(E.value),1)])]),n[4]||(n[4]=s("p",{class:"text-base-content/70 text-xs"},"Yanlış",-1))])]),s("div",he,[n[5]||(n[5]=s("h3",{class:"mb-2 text-sm font-medium text-base-content"},"Cevaplarınız",-1)),s("div",_e,[(i(!0),l(M,null,R(e.value.userResponses,r=>{var a;return i(),l("div",{key:r.word_id,class:"flex items-center justify-between rounded border border-base-300 bg-base-200 p-2"},[s("div",we,[s("div",{class:_(["flex h-5 w-5 items-center justify-center rounded-full text-xs font-bold",r.correct?"bg-green-100 text-green-600":"bg-red-100 text-red-600"])},o(r.correct?"✓":"✗"),3),s("div",ye,[s("span",Ce,o(((a=k.value[r.word_id])==null?void 0:a.word)||"Unknown"),1),s("span",ke,o(m(k.value[r.word_id])),1)])]),s("span",{class:_(["inline-flex items-center rounded px-2 py-1 text-xs font-medium",r.correct?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},o(r.correct?"Doğru":"Yanlış"),3)])}),128))])]),s("div",Ie,[C.value?(i(),l("button",{key:0,onClick:V,class:"w-full rounded border border-base-300 bg-base-content px-4 py-2 text-center text-sm font-medium text-base-100 transition hover:bg-base-300 hover:text-base-content",disabled:v.value},o(v.value?"Güncelleniyor...":"İstatistikleri Güncelle"),9,Qe)):h("",!0),s("div",Se,[s("button",{onClick:n[0]||(n[0]=r=>w("game-completed")),class:"flex-1 rounded border border-base-300 bg-base-content px-4 py-2 text-center text-sm font-medium text-base-100 transition hover:bg-base-300 hover:text-base-content"}," Pakete Dön "),s("button",{onClick:q,class:"flex-1 rounded border border-base-300 px-4 py-2 text-sm font-medium text-base-content transition hover:bg-base-200"}," Tekrar Başla ")])])])):(i(),l("div",Ae,[s("div",Oe,[s("div",{ref_key:"progressBar",ref:Q,class:"h-full w-0 bg-base-content transition-all duration-500"},null,512)]),s("div",Te,[s("span",Me," Soru "+o(e.value.currentIndex+1)+" / "+o(e.value.totalQuestions),1)]),e.value.currentQuestion?(i(),l("div",{key:0,class:"space-y-4",ref_key:"questionContainer",ref:A},[s("div",null,[s("h2",Re,'"'+o(e.value.currentQuestion.word)+'"',1),n[6]||(n[6]=s("p",{class:"text-base-content/70 mb-3"},"Bu kelimenin anlamı nedir?",-1)),s("span",Pe,o(G(e.value.currentQuestion.type)),1)]),e.value.currentQuestion.example_sentences&&e.value.currentQuestion.example_sentences.length>0?(i(),l("div",We,[s("div",De,[n[7]||(n[7]=s("p",{class:"text-sm font-medium text-base-content"},"Örnek Cümle",-1)),e.value.currentQuestion.example_sentences.length>1?(i(),l("button",{key:0,onClick:Y,class:"text-base-content/70 text-xs transition-colors hover:text-base-content"}," Sonraki ("+o(e.value.currentHintIndex+1)+"/"+o(e.value.currentQuestion.example_sentences.length)+") ",1)):h("",!0)]),s("p",je,o(e.value.currentQuestion.example_sentences[e.value.currentHintIndex].sentence),1)])):h("",!0),s("div",{class:"space-y-2",ref_key:"optionsContainer",ref:I},[(i(!0),l(M,null,R(F.value,(r,a)=>(i(),l("button",{key:`${e.value.currentIndex}-${a}`,onClick:g=>U(r),disabled:e.value.showAnswer,class:_(["w-full rounded border border-base-300 bg-base-100 p-3 text-left text-base text-base-content transition-all duration-200 hover:bg-base-200 disabled:cursor-not-allowed",Z(r)])},[s("div",Be,[s("span",ze,o(String.fromCharCode(65+a)),1),se(" "+o(r.meaningText),1)])],10,He))),128))],512),e.value.showAnswer?(i(),l("div",Le,[s("p",{class:_(["text-lg font-medium",e.value.isCorrect?"text-green-600":"text-red-600"])},o(e.value.isCorrect?"Doğru!":"Yanlış!"),3)])):h("",!0)],512)):h("",!0)]))]))}},Ve=re(Ne,[["__scopeId","data-v-a8783795"]]);export{Ve as default};
