import{Q as ue,p as b,r as g,m as de,y as ve,c as l,a as s,t as i,F as h,g as k,h as L,n as C,f as S,N as fe,J as $,o as c}from"./ssr-21H53JUc.js";import{g as w}from"./index-CH_iu5NA.js";import{_ as me}from"./app-rjQhlrUM.js";/* empty css            */const be={class:"flex flex-col items-center justify-center"},ge={key:0,class:"w-full max-w-2xl rounded-lg border border-base-300 bg-base-100 p-6"},xe={class:"mb-4 text-center"},pe={class:"inline-flex items-center gap-2 rounded bg-base-200 px-3 py-1"},he={class:"text-lg font-bold text-base-content"},we={class:"mb-4 grid grid-cols-2 gap-4"},ye={class:"rounded border border-base-300 bg-base-200 p-3 text-center"},_e={class:"mb-1"},ke={class:"mx-auto flex h-8 w-8 items-center justify-center rounded-full bg-green-100"},Le={class:"text-sm font-bold text-green-600"},Ce={class:"rounded border border-base-300 bg-base-200 p-3 text-center"},Ie={class:"mb-1"},Ae={class:"mx-auto flex h-8 w-8 items-center justify-center rounded-full bg-red-100"},Pe={class:"text-sm font-bold text-red-600"},Qe={class:"mb-4 text-center"},Se={class:"inline-flex items-center gap-2 rounded bg-base-200 px-3 py-1"},je={class:"text-lg font-bold text-base-content"},Me={class:"mb-4"},ze={class:"max-h-48 space-y-2 overflow-y-auto"},He={class:"flex items-center gap-2"},Ue={class:"flex flex-col"},Be={class:"text-sm font-medium text-base-content"},Te={class:"text-base-content/70 text-xs"},Re={key:0,class:"text-base-content/70 text-xs"},De={class:"space-y-2"},Ee=["disabled"],qe={class:"flex gap-2"},We={class:"relative mb-4 h-1 w-full overflow-hidden rounded-full bg-base-200"},$e={class:"text-base-content/70 mb-4 flex items-center justify-between text-sm"},Fe={class:"flex flex-col items-end gap-1"},Ge={class:"flex items-center gap-2"},Ke={class:"font-medium text-base-content"},Ne={class:"flex items-center gap-2 text-xs"},Ve={class:"text-base-content/70 font-medium"},Oe={class:"mb-2 text-2xl font-semibold text-base-content"},Ye={class:"flex items-center justify-between"},Je={class:"inline-flex items-center rounded border border-base-300 bg-base-200 px-2 py-1 text-xs text-base-content"},Ze={class:"space-y-2"},Xe={key:1,class:"text-base-content/70 text-center"},et={key:2,class:"flex justify-center space-x-2"},tt=["disabled"],st={key:1,class:"mt-4"},nt={class:"flex flex-col gap-1 rounded border border-base-300 bg-base-200 p-2"},rt={class:"flex gap-1"},ot=["onClick"],at={class:"flex gap-1"},lt=["onClick"],it={class:"flex gap-1"},ct=["onClick"],ut={__name:"WordCompletion",props:{gameType:String,packSlug:String,words:Array,gameConfig:Object},emits:["game-completed"],setup(F,{emit:G}){const d=F,j=G,M=ue(),K=M.props.languagePacks||[],z=b(()=>{var t;return!!((t=M.props.auth)!=null&&t.user)});b(()=>d.packSlug?K.find(t=>t.slug===d.packSlug):null);const e=g({isLoading:!0,isPlaying:!1,currentQuestion:null,showAnswer:!1,isCorrect:!1,progress:0,currentIndex:0,totalQuestions:0,userResponses:[],maskedIndices:[],selectedLetters:[],hintShown:!1,currentHintIndex:0,correctAnswer:"",totalPoints:0,displayPoints:0,hintsUsed:0,hintLetterIndices:[],isHintAnimating:!1}),x=g([]),H=b(()=>Object.fromEntries(x.value.map(t=>[t.id,t]))),A=b(()=>e.value.selectedLetters.every(t=>t!=="")),y=g(!1),I=g(!1),U=()=>{I.value=!I.value},N=()=>{const t=[...e.value.selectedLetters].reverse().findIndex((n,r)=>{const o=e.value.selectedLetters.length-1-r;return n&&!e.value.hintLetterIndices.includes(o)});if(t!==-1){const n=e.value.selectedLetters.length-1-t;e.value.selectedLetters[n]=""}},V=()=>{if(e.value.showAnswer||e.value.isHintAnimating)return;const t=D(e.value.currentQuestion.word.length);if(e.value.hintsUsed>=t){console.log("Maksimum ipucu sayısına ulaşıldı");return}const n=e.value.maskedIndices.filter((r,o)=>!e.value.selectedLetters[o]);if(n.length>0){const r=n[Math.floor(Math.random()*n.length)],o=e.value.currentQuestion.word[r].toLowerCase();e.value.isHintAnimating=!0;const a=p.value.children[r],u="abcdefghijklmnopqrstuvwxyz".split("");let f=50,v=0;const m=20,_=setInterval(()=>{a.textContent=u[Math.floor(Math.random()*u.length)],v>m*.7&&(f+=10),v++,v>=m&&(clearInterval(_),a.textContent=o,e.value.selectedLetters[r]=o,e.value.hintsUsed++,e.value.hintLetterIndices.push(r),w.to(a,{scale:1.1,duration:.2,yoyo:!0,repeat:1,onComplete:()=>{e.value.isHintAnimating=!1}}))},f)}},B=()=>{if(!d.words||d.words.length<2){alert("Oyunu başlatmak için en az 2 kelime gereklidir.");return}e.value.isLoading=!0;let t=[...d.words];if(d.gameConfig.wordType&&d.gameConfig.wordType!==""&&(t=t.filter(r=>r.type===d.gameConfig.wordType)),d.gameConfig.learningStatus&&d.gameConfig.learningStatus!==""&&(t=t.filter(r=>r.learning_status===parseInt(d.gameConfig.learningStatus))),d.gameConfig.difficultyLevel&&d.gameConfig.difficultyLevel!==""&&(t=t.filter(r=>r.difficulty_level===d.gameConfig.difficultyLevel)),d.gameConfig.prioritizeUnlearned){const r=t.filter(u=>u.learning_status===0),o=t.filter(u=>u.learning_status===1),a=t.filter(u=>u.learning_status===2);t=[...r,...o,...a]}d.gameConfig.prioritizeRecentlyLearned&&t.sort((r,o)=>{const a=new Date(r.last_reviewed_at||0);return new Date(o.last_reviewed_at||0)-a}),d.gameConfig.prioritizeFlagged&&t.sort((r,o)=>r.is_flagged&&!o.is_flagged?-1:!r.is_flagged&&o.is_flagged?1:0),d.gameConfig.prioritizeMostIncorrect&&t.sort((r,o)=>{const a=r.incorrect_count||0;return(o.incorrect_count||0)-a}),t=t.sort(()=>Math.random()-.5);const n=Math.min(d.gameConfig.questionCount||10,t.length);if(t=t.slice(0,n),t.length===0){alert("Filtreleme sonucu hiç kelime kalmadı. Lütfen filtreleri kontrol edin.");return}x.value=t,e.value.totalQuestions=x.value.length,e.value.currentIndex=0,e.value.userResponses=[],e.value.isLoading=!1,e.value.isPlaying=!0,T()},O=b(()=>{if(!e.value.userResponses.length)return 0;const t=e.value.userResponses.filter(n=>n.correct).length;return Math.round(t/e.value.userResponses.length*100)}),Y=b(()=>{if(!e.value.currentQuestion)return 0;const n=e.value.currentQuestion.word.length*100,r=e.value.hintsUsed*100;return n-r}),J=()=>"abcçdefgğhıijklmnoöprsştuüvwxyz".split(""),Z=b(()=>e.value.userResponses.filter(t=>t.correct).length),X=b(()=>e.value.userResponses.filter(t=>!t.correct).length),T=()=>{if(e.value.currentIndex>=x.value.length){ae();return}if(!x.value[e.value.currentIndex])return;const n=x.value[e.value.currentIndex].word.length;e.value.currentQuestion=x.value[e.value.currentIndex],e.value.showAnswer=!1,e.value.hintShown=!1,e.value.currentHintIndex=0,e.value.hintsUsed=0,e.value.hintLetterIndices=[],e.value.isHintAnimating=!1,e.value.progress=0,e.value.currentQuestion.example_sentences&&e.value.currentQuestion.example_sentences.length>0&&(e.value.hintShown=!0,e.value.currentHintIndex=0),e.value.selectedLetters=Array(n).fill(""),e.value.maskedIndices=Array.from({length:n},(r,o)=>o),$(()=>{if(p.value&&p.value.children){const r=p.value.children;w.fromTo(r,{y:-50,opacity:0,scale:.8},{y:0,opacity:1,scale:1,duration:.5,stagger:.05,ease:"back.out(1.7)"})}})},R=g(null),ee=g(null),te=g(null),p=g(null),se=t=>{const n=e.value.selectedLetters.findIndex(o=>!o);if(n===-1)return;const r=p.value.children[n];w.from(r,{scale:1.2,duration:.2,ease:"power2.out"})},P=t=>{if(e.value.showAnswer)return;const n=e.value.selectedLetters.findIndex(r=>!r);n!==-1&&(e.value.selectedLetters[n]=t.toLowerCase(),se())},ne=()=>e.value.selectedLetters.findIndex(t=>!t),D=t=>t<=3?1:t<=4?2:t<=5?3:4,re=t=>{switch(t){case"noun":return"İsim";case"verb":return"Fiil";case"adjective":return"Sıfat";case"adverb":return"Zarf";default:return"Bilinmiyor"}},E=t=>{if(e.value.showAnswer)return;const n=t.key.toLowerCase(),r=J();if(t.key==="Shift"){if(console.log("Shift tuşuna basıldı:",{selectedLetters:e.value.selectedLetters,hintLetterIndices:e.value.hintLetterIndices}),e.value.isHintAnimating)return;const o=D(e.value.currentQuestion.word.length);if(e.value.hintsUsed>=o){console.log("Maksimum ipucu sayısına ulaşıldı");return}const a=e.value.maskedIndices.filter((u,f)=>!e.value.selectedLetters[f]);if(a.length>0){const u=a[Math.floor(Math.random()*a.length)],f=e.value.currentQuestion.word[u].toLowerCase();e.value.isHintAnimating=!0;const v=p.value.children[u],m="abcdefghijklmnopqrstuvwxyz".split("");let _=50,Q=0;const W=20,ce=setInterval(()=>{v.textContent=m[Math.floor(Math.random()*m.length)],Q>W*.7&&(_+=10),Q++,Q>=W&&(clearInterval(ce),v.textContent=f,e.value.selectedLetters[u]=f,e.value.hintsUsed++,e.value.hintLetterIndices.push(u),w.to(v,{scale:1.1,duration:.2,yoyo:!0,repeat:1,onComplete:()=>{e.value.isHintAnimating=!1}}))},_)}}else if(r.includes(n)||n===" "){const o=e.value.selectedLetters.findIndex(a=>!a);o!==-1&&(e.value.selectedLetters[o]=n)}else if(t.key==="Backspace"){const o=[...e.value.selectedLetters].reverse().findIndex((a,u)=>{const f=e.value.selectedLetters.length-1-u;return a&&!e.value.hintLetterIndices.includes(f)});if(o!==-1){const a=e.value.selectedLetters.length-1-o;e.value.selectedLetters[a]=""}}else t.key==="Enter"&&A.value&&q()},q=()=>{if(e.value.showAnswer||!A.value)return;console.log("Cevap kontrolü öncesi:",{selectedLetters:e.value.selectedLetters,hintLetterIndices:e.value.hintLetterIndices});const t=e.value.currentQuestion.word.toLowerCase();let n=!0,r="";for(let v=0;v<e.value.maskedIndices.length;v++){const m=t[e.value.maskedIndices[v]],_=e.value.selectedLetters[v].toLowerCase();m!==_&&(n=!1),r+=m}console.log("Cevap kontrolü sonrası:",{isCorrect:n,correctAnswer:r,selectedLetters:e.value.selectedLetters,hintLetterIndices:e.value.hintLetterIndices}),e.value.isCorrect=n,e.value.correctAnswer=r;let o=0;n&&(o=t.length*100,o-=e.value.hintsUsed*100);const a=e.value.totalPoints,u=a+o;e.value.displayPoints=a,setTimeout(()=>{oe(a,u)},500),e.value.userResponses.push({word_id:e.value.currentQuestion.id,correct:n,points:o,hintsUsed:e.value.hintsUsed}),e.value.showAnswer=!0;const f=Math.round((e.value.currentIndex+1)/e.value.totalQuestions*100);w.to(R.value,{width:`${f}%`,duration:.5,ease:"power2.out"}),setTimeout(()=>{e.value.currentIndex++,T()},2e3)},oe=(t,n)=>{w.to(e.value,{displayPoints:n,duration:1,ease:"power2.out",onUpdate:()=>{e.value.totalPoints=Math.round(e.value.displayPoints)}})},ae=()=>{console.log("Oyun bitti, özet ekranı gösteriliyor"),e.value.isPlaying=!1,$(()=>{const t=document.querySelector(".game-summary");t&&w.fromTo(t,{opacity:0,y:20},{opacity:1,y:0,duration:.5,ease:"power2.out"})})},le=()=>{e.value={isLoading:!0,isPlaying:!1,currentQuestion:null,showAnswer:!1,isCorrect:!1,progress:0,currentIndex:0,totalQuestions:0,userResponses:[],maskedIndices:[],selectedLetters:[],hintShown:!1,currentHintIndex:0,correctAnswer:"",totalPoints:0,displayPoints:0,hintsUsed:0,hintLetterIndices:[],isHintAnimating:!1},B()},ie=()=>{if(!z.value||!e.value.userResponses.length||y.value)return;y.value=!0;const t=e.value.userResponses.map(n=>({word_id:n.word_id,review_count:1,incorrect_count:n.correct?0:1}));fe.post("/update-words",{words:t},{preserveState:!0,onSuccess:()=>{console.log("İstatistikler başarıyla güncellendi"),y.value=!1,setTimeout(()=>{j("game-completed")},1e3)},onError:n=>{console.error("İstatistik güncelleme hatası:",n),y.value=!1}})};return de(()=>{B(),window.addEventListener("keydown",E)}),ve(()=>{window.removeEventListener("keydown",E)}),(t,n)=>(c(),l("div",be,[!e.value.isPlaying&&e.value.userResponses.length>0?(c(),l("div",ge,[s("div",xe,[n[2]||(n[2]=s("h2",{class:"mb-2 text-xl font-semibold text-base-content"},"Test Tamamlandı",-1)),s("div",pe,[n[1]||(n[1]=s("span",{class:"text-base-content/70 text-sm"},"Puan:",-1)),s("span",he,i(O.value)+" / 100",1)])]),s("div",we,[s("div",ye,[s("div",_e,[s("div",ke,[s("span",Le,i(Z.value),1)])]),n[3]||(n[3]=s("p",{class:"text-base-content/70 text-xs"},"Doğru",-1))]),s("div",Ce,[s("div",Ie,[s("div",Ae,[s("span",Pe,i(X.value),1)])]),n[4]||(n[4]=s("p",{class:"text-base-content/70 text-xs"},"Yanlış",-1))])]),s("div",Qe,[s("div",Se,[n[5]||(n[5]=s("span",{class:"text-base-content/70 text-sm"},"Toplam Puan:",-1)),s("span",je,i(e.value.totalPoints),1)])]),s("div",Me,[n[6]||(n[6]=s("h3",{class:"mb-2 text-sm font-medium text-base-content"},"Cevaplarınız",-1)),s("div",ze,[(c(!0),l(h,null,k(e.value.userResponses,r=>{var o,a;return c(),l("div",{key:r.word_id,class:"flex items-center justify-between rounded border border-base-300 bg-base-200 p-2"},[s("div",He,[s("div",{class:C(["flex h-5 w-5 items-center justify-center rounded-full text-xs font-bold",r.correct?"bg-success/20 text-success":"bg-error/20 text-error"])},i(r.correct?"✓":"✗"),3),s("div",Ue,[s("span",Be,i(((o=H.value[r.word_id])==null?void 0:o.word)||"Unknown"),1),s("span",Te,i(((a=H.value[r.word_id])==null?void 0:a.meaning)||""),1),r.correct?(c(),l("span",Re,i(r.points)+" puan "+i(r.hintsUsed>0?`(${r.hintsUsed} ipucu)`:""),1)):L("",!0)])]),s("span",{class:C(["inline-flex items-center rounded px-2 py-1 text-xs font-medium",r.correct?"bg-success/20 text-success":"bg-error/20 text-error"])},i(r.correct?"Doğru":"Yanlış"),3)])}),128))])]),s("div",De,[z.value?(c(),l("button",{key:0,onClick:ie,class:"w-full rounded border border-base-300 bg-base-content px-4 py-2 text-center text-sm font-medium text-base-100 transition hover:bg-base-300 hover:text-base-content",disabled:y.value},i(y.value?"Güncelleniyor...":"İstatistikleri Güncelle"),9,Ee)):L("",!0),s("div",qe,[s("button",{onClick:n[0]||(n[0]=r=>j("game-completed")),class:"flex-1 rounded border border-base-300 bg-base-content px-4 py-2 text-center text-sm font-medium text-base-100 transition hover:bg-base-300 hover:text-base-content"}," Pakete Dön "),s("button",{onClick:le,class:"flex-1 rounded border border-base-300 px-4 py-2 text-sm font-medium text-base-content transition hover:bg-base-200"}," Tekrar Başla ")])])])):(c(),l("div",{key:1,class:C(["relative w-full max-w-2xl rounded-lg border border-base-300 bg-base-100 p-6 transition-colors duration-500",{"bg-base-100":!e.value.showAnswer,"bg-success/5":e.value.showAnswer&&e.value.isCorrect,"bg-error/5":e.value.showAnswer&&!e.value.isCorrect}])},[s("div",We,[s("div",{ref_key:"progressBar",ref:R,class:"h-full w-0 bg-base-content"},null,512),s("div",{ref_key:"progressBarGlow",ref:ee,class:"absolute left-0 top-0 h-full w-[50px] bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,512)]),s("div",$e,[s("div",null,"Soru "+i(e.value.currentIndex+1)+" / "+i(e.value.totalQuestions),1),s("div",Fe,[s("div",Ge,[s("span",Ke,i(e.value.totalPoints),1),n[7]||(n[7]=s("span",null,"toplam puan",-1))]),s("div",Ne,[s("span",Ve,i(Y.value),1),n[8]||(n[8]=s("span",null,"mevcut soru puanı",-1))])])]),e.value.currentQuestion?(c(),l("div",{key:0,class:"space-y-4",ref_key:"questionContainer",ref:te},[s("div",null,[s("h2",Oe,'"'+i(e.value.currentQuestion.meaning)+'"',1),n[9]||(n[9]=s("p",{class:"text-base-content/70 mb-3"},"Bu kelimenin İngilizce anlamını yazın",-1)),s("div",Ye,[s("span",Je,i(re(e.value.currentQuestion.type)),1)])]),s("div",Ze,[e.value.currentQuestion&&e.value.currentQuestion.word?(c(),l("div",{key:0,class:"flex justify-center space-x-2",ref_key:"selectedLettersContainer",ref:p},[(c(!0),l(h,null,k(e.value.currentQuestion.word.split(""),(r,o)=>(c(),l("div",{key:`${e.value.currentIndex}-${o}`,class:C(["flex h-12 w-12 items-center justify-center rounded border text-xl font-semibold transition-all",{"border-base-300 bg-base-100":!e.value.selectedLetters[o],"border-base-content bg-base-200":!e.value.selectedLetters[o]&&o===ne(),"bg-success/10 border-success text-success":e.value.showAnswer&&e.value.isCorrect,"bg-error/10 border-error text-error":e.value.showAnswer&&!e.value.isCorrect,"border-info":e.value.hintLetterIndices.includes(o)&&!e.value.isHintAnimating}])},[e.value.maskedIndices.includes(o)?(c(),l("span",{key:0,class:C({"text-info":e.value.hintLetterIndices.includes(o)})},i(e.value.selectedLetters[o]||""),3)):(c(),l(h,{key:1},[S(i(r.toLowerCase()),1)],64))],2))),128))],512)):(c(),l("div",Xe,[...n[10]||(n[10]=[s("p",null,"Harf kutuları yükleniyor...",-1)])])),e.value.showAnswer&&!e.value.isCorrect?(c(),l("div",et,[(c(!0),l(h,null,k(e.value.currentQuestion.word.split(""),(r,o)=>(c(),l("div",{key:o,class:"bg-success/10 flex h-8 w-8 items-center justify-center rounded border border-success text-sm font-medium text-success"},i(r.toLowerCase()),1))),128))])):L("",!0)]),s("button",{onClick:q,disabled:e.value.showAnswer||!A.value,class:"w-full rounded border border-base-300 bg-base-content px-4 py-2 text-center text-sm font-medium text-base-100 transition hover:bg-base-300 hover:text-base-content disabled:opacity-50"}," Kontrol Et ",8,tt)],512)):L("",!0),I.value?(c(),l("div",st,[s("div",nt,[s("div",rt,[(c(),l(h,null,k(["q","w","e","r","t","y","u","ı","o","p","ğ","ü"],r=>s("button",{key:r,onClick:o=>P(r),class:"flex h-10 w-10 items-center justify-center rounded bg-base-100 text-sm font-medium text-base-content transition hover:bg-base-300 active:bg-base-content active:text-base-100"},i(r),9,ot)),64))]),s("div",at,[(c(),l(h,null,k(["a","s","d","f","g","h","j","k","l","ş","i"],r=>s("button",{key:r,onClick:o=>P(r),class:"flex h-10 w-10 items-center justify-center rounded bg-base-100 text-sm font-medium text-base-content transition hover:bg-base-300 active:bg-base-content active:text-base-100"},i(r),9,lt)),64))]),s("div",it,[(c(),l(h,null,k(["z","x","c","v","b","n","m","ö","ç"],r=>s("button",{key:r,onClick:o=>P(r),class:"flex h-10 w-10 items-center justify-center rounded bg-base-100 text-sm font-medium text-base-content transition hover:bg-base-300 active:bg-base-content active:text-base-100"},i(r),9,ct)),64))]),s("div",{class:"flex gap-1"},[s("button",{onClick:N,class:"flex h-10 flex-1 items-center justify-center rounded bg-base-100 text-sm font-medium text-base-content transition hover:bg-base-300 active:bg-base-content active:text-base-100"}," ← "),s("button",{onClick:V,class:"flex h-10 flex-1 items-center justify-center rounded bg-base-content text-sm font-medium text-base-100 transition hover:bg-base-300 hover:text-base-content"}," İpucu ")])])])):L("",!0),I.value?(c(),l("button",{key:3,onClick:U,class:"mt-4 flex w-full items-center justify-center gap-2 rounded border border-base-300 bg-base-100 px-4 py-2 text-sm font-medium text-base-content transition hover:bg-base-200"},[...n[12]||(n[12]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[s("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1),S(" Klavyeyi Kapat ",-1)])])):(c(),l("button",{key:2,onClick:U,class:"mt-4 flex w-full items-center justify-center gap-2 rounded border border-base-300 bg-base-100 px-4 py-2 text-sm font-medium text-base-content transition hover:bg-base-200"},[...n[11]||(n[11]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[s("path",{d:"M10 2a8 8 0 100 16 8 8 0 000-16zm0 14a6 6 0 110-12 6 6 0 010 12zm-1-5a1 1 0 011-1h2a1 1 0 110 2h-2a1 1 0 01-1-1zm0-4a1 1 0 011-1h2a1 1 0 110 2h-2a1 1 0 01-1-1z"})],-1),S(" Klavyeyi Aç ",-1)])]))],2))]))}},bt=me(ut,[["__scopeId","data-v-6bf3e077"]]);export{bt as default};
