const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/main-CKdwMZY5.js","assets/index-X8FpDc4f.js","assets/ssr-CHe0FcHz.js","assets/ssr-CY4U0JXg.css","assets/index-BWiVoIO4.js","assets/client-DUIXC0Tr.js"])))=>i.map(i=>d[i]);
import{a as O}from"./app-C-7B2Ohz.js";import{g as r,b as I,y as F,s as G,z as Q,c as d,j as E,a as l,k as R,t as K,n as W,h as X,C as Z,D as ee,o as c}from"./ssr-CHe0FcHz.js";const te={class:"relative h-full w-full"},re={key:0,class:"absolute left-32 top-[53px] z-10 lg:left-36 lg:top-4"},ae=["disabled"],se={key:0,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},le={key:1,class:"h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ne={key:0,class:"mt-1 flex items-center gap-1 text-xs text-amber-600 dark:text-amber-400"},de={__name:"ExcalidrawComponent",props:{write:{type:Object,default:()=>({})},auth:{type:Object,default:null}},setup(P){const a=P,v=r([]),w=r({}),p=r(""),L=r("success"),_=r(null),k=r(null),C=r(null),i=r(!1),N=r(!1),f=r(!1),m=r(null),x=r(!1),y=r(document.documentElement.getAttribute("data-theme")==="dark"),S=I(()=>{var t,e;return((t=a.write)==null?void 0:t.writeDraws)||((e=a.write)==null?void 0:e.write_draws)||[]});F(y,t=>{_.value&&_.value.updateScene({theme:t?"dark":"light"})});const M=()=>{N.value||(N.value=!0,O(async()=>{const{Excalidraw:t}=await import("./main-CKdwMZY5.js").then(e=>e.m);return{Excalidraw:t}},__vite__mapDeps([0,1,2,3,4])).then(({Excalidraw:t})=>{O(()=>import("./index-X8FpDc4f.js").then(e=>e.i),__vite__mapDeps([1,2,3])).then(e=>{O(()=>import("./client-DUIXC0Tr.js").then(s=>s.c),__vite__mapDeps([5,4,1,2,3])).then(s=>{var B;const o=document.getElementById("excali");if(!o)return;const g=s.createRoot(o),n=S.value||[];let h=[],b={};if(n.length>0&&n[0]){if(n[0].elements)try{h=typeof n[0].elements=="string"?JSON.parse(n[0].elements):n[0].elements}catch(u){console.warn("Elements parse error:",u),h=[]}if(n[0].files)try{b=typeof n[0].files=="string"?JSON.parse(n[0].files):n[0].files}catch(u){console.warn("Files parse error:",u),b={}}}k.value=JSON.stringify(h),C.value=JSON.stringify(b),w.value=b,v.value=h;const Y={elements:h,files:b,scrollToContent:!0,theme:y.value?"dark":"light"},$=(u,ie,J)=>{var T;v.value=u,J&&(w.value=J),(T=a.auth)!=null&&T.user&&(x.value=!0)},q=e.createElement(t,{initialData:Y,onChange:$,viewModeEnabled:!((B=a.auth)!=null&&B.user),theme:y.value?"dark":"light",onMount:u=>{_.value=u}});g.render(q)})})}))};F(S,t=>{t&&t.length>0&&!N.value&&M()},{deep:!0}),G(()=>{var e,s;const t=new MutationObserver(o=>{o.forEach(g=>{g.attributeName==="data-theme"&&(y.value=document.documentElement.getAttribute("data-theme")==="dark")})});return t.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),(S.value.length>0||(e=a.write)!=null&&e.id)&&M(),(s=a.auth)!=null&&s.user&&(window.addEventListener("beforeunload",V),document.addEventListener("inertia:before",j)),()=>t.disconnect()}),Q(()=>{var t;(t=a.auth)!=null&&t.user&&(window.removeEventListener("beforeunload",V),document.removeEventListener("inertia:before",j))});const z=I(()=>{if(!k.value||!x.value)return!1;const t=JSON.stringify(v.value),e=JSON.stringify(w.value);return t!==k.value||e!==C.value}),U=async()=>{var o;if(!((o=a.write)!=null&&o.id)){D("Yazı bulunamadı, kaydetme başarısız.","error");return}if(i.value)return;const t=v.value.length>0?v.value:[],e=JSON.stringify(t),s=JSON.stringify(w.value||{});i.value=!0;try{await ee.post(`/writes/${a.write.id}/draw`,{elements:e,files:s,version:1}),k.value=e,C.value=s,x.value=!1,D("Canvas durumu başarıyla kaydedildi!","success")}catch(g){console.error("Save error:",g),D("Kaydetme sırasında bir hata oluştu. Lütfen tekrar deneyin.","error")}finally{i.value=!1}},V=t=>{var e;if((e=a.auth)!=null&&e.user&&z.value)return t.preventDefault(),t.returnValue="",""},j=t=>{var e;(e=a.auth)!=null&&e.user&&z.value&&!f.value&&(t.preventDefault(),m.value=t.detail.visit,f.value=!0)},H=()=>{f.value=!1,x.value=!1,m.value&&(m.value(),m.value=null)},A=()=>{f.value=!1,m.value=null},D=(t,e="success")=>{p.value=t,L.value=e,setTimeout(()=>{p.value=""},3e3)};return(t,e)=>{var s;return c(),d("div",te,[(s=a.auth)!=null&&s.user?(c(),d("div",re,[l("button",{onClick:U,disabled:i.value,class:"flex items-center gap-2 rounded-lg border border-input bg-background px-3 py-2 text-sm text-foreground shadow-lg transition-all hover:bg-accent disabled:cursor-not-allowed disabled:opacity-50"},[i.value?(c(),d("svg",le,[...e[1]||(e[1]=[l("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),l("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(c(),d("svg",se,[...e[0]||(e[0]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.5 3.75V16.5L12 14.25 7.5 16.5V3.75m9 0H18A2.25 2.25 0 0120.25 6v12A2.25 2.25 0 0118 20.25H6A2.25 2.25 0 013.75 18V6A2.25 2.25 0 016 3.75h1.5m9 0h-9"},null,-1)])])),R(" "+K(i.value?"Kaydediliyor...":"Kaydet"),1)],8,ae),z.value&&!i.value?(c(),d("div",ne,[...e[2]||(e[2]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),R(" Kaydedilmemiş değişiklikler ",-1)])])):E("",!0)])):E("",!0),p.value?(c(),d("div",{key:1,class:W(["absolute left-32 top-[101px] z-20 rounded-lg border px-3 py-2 text-sm shadow-lg lg:left-36 lg:top-16",L.value==="success"?"border-green-300 bg-green-100 text-green-800 dark:border-green-700 dark:bg-green-900/50 dark:text-green-200":"border-red-300 bg-red-100 text-red-800 dark:border-red-700 dark:bg-red-900/50 dark:text-red-200"])},K(p.value),3)):E("",!0),f.value?(c(),d("div",{key:2,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:X(A,["self"])},[l("div",{class:"w-full max-w-md rounded-lg border border-border bg-background p-6 shadow-xl"},[e[3]||(e[3]=Z('<div class="mb-4 flex items-start gap-3"><div class="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-amber-100 dark:bg-amber-900/50"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-amber-600 dark:text-amber-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg></div><div class="flex-1"><h3 class="text-lg font-semibold text-foreground">Kaydedilmemiş Değişiklikler</h3><p class="mt-2 text-sm text-muted-foreground"> Çizimde kaydedilmemiş değişiklikleriniz var. Sayfadan ayrılırsanız bu değişiklikler kaybolacak. </p></div></div>',1)),l("div",{class:"flex justify-end gap-2"},[l("button",{onClick:A,class:"inline-flex h-9 items-center justify-center rounded-md border border-input bg-background px-4 text-sm font-medium ring-offset-background transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"}," İptal "),l("button",{onClick:H,class:"inline-flex h-9 items-center justify-center rounded-md bg-destructive px-4 text-sm font-medium text-destructive-foreground ring-offset-background transition-colors hover:bg-destructive/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"}," Yine de Ayrıl ")])])])):E("",!0),e[4]||(e[4]=l("div",{id:"excalidraw-container",class:"h-full w-full"},[l("div",{id:"excali",class:"h-full w-full"})],-1))])}}};export{de as _};
