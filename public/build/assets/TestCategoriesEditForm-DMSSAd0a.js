import{Q as ne,e as v,p as B,T as ie,y as F,m as le,D as M,A as ae,c,a as r,h as m,n as S,u as n,t as b,k as ue,v as de,C as ce,F as fe,g as ve,f as I,l as pe,N as A,o as f}from"./ssr-B00CJT2V.js";const ge={class:"space-y-4 py-6"},me={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},be=["value"],he={key:0,class:"mt-1 text-xs text-destructive"},xe=["value"],we={key:0,class:"mt-1 text-xs text-destructive"},ke={class:"mb-1 flex items-center gap-2"},ye={key:0,class:"flex items-center gap-1.5"},_e={class:"text-sm text-foreground"},Ce={key:0,class:"text-xs text-muted-foreground"},Ee={class:"relative w-full"},Se={key:0,class:"absolute z-30 mt-1 w-full rounded-md border border-border bg-popover shadow-lg"},Le={class:"max-h-60 w-full overflow-y-auto p-1"},Pe=["onMousedown"],je={class:"flex flex-col gap-0.5"},Fe={class:"font-medium"},Me={key:0,class:"text-xs text-muted-foreground"},Re={key:0,class:"mt-1 text-xs text-destructive"},ze=["value"],Te={key:0,class:"mt-1 text-xs text-destructive"},Be=["value"],Ie={key:0,class:"mt-1 text-xs text-destructive"},Ae={class:"flex justify-end gap-2 pt-2"},Ke=["disabled"],Ve=["disabled"],De={key:0,class:"mr-2 h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ge=Object.assign({name:"TestCategoriesEditForm"},{__name:"TestCategoriesEditForm",setup(qe){const U=t=>{const e=[],o=new Set,g=u=>{!u||!Array.isArray(u)||u.forEach(l=>{l&&l.id&&!o.has(l.id)&&(o.add(l.id),e.push(l),l.children&&Array.isArray(l.children)&&l.children.length>0&&g(l.children))})};return g(t),e},_=ne(),L=v(_.props.categories||[]),p=B(()=>U(L.value)),x=B(()=>_.props.category||{}),C=_.props.category||{},s=ie({name:C.name||"",slug:C.slug||"",parent_id:C.parent_id||null,status:C.status||"public",description:C.description||""});s.processing=!1;const R=t=>{t&&t.id&&(s.name=t.name||"",s.slug=t.slug||"",s.parent_id=t.parent_id||null,s.status=t.status||"public",s.description=t.description||"",t.parent?w.value=t.parent.name||"":w.value="")};F(()=>_.props.category,t=>{t&&t.id&&R(t)},{immediate:!0,deep:!0}),F(()=>x.value,t=>{t&&t.id&&R(t)},{immediate:!0,deep:!0});const K=v(null),V=v(null),D=v(null),q=v(null),H=v(null),a=v({name:"",slug:"",parent_id:"",status:"",description:""}),h=v(""),w=v(""),k=v(!1),N=v(!1),$=v(null),E=t=>{if(!t||!p.value||p.value.length===0)return"";const e=u=>p.value.find(l=>l.id===u),o=(u,l=[])=>{const i=e(u);return i?(l.unshift(i.name),i.parent_id?o(i.parent_id,l):l):l},g=o(t);return g.length>1?g.slice(0,-1).join(" > "):""},P=t=>{if(!t||!p.value||p.value.length===0)return"";const e=u=>p.value.find(l=>l.id===u),o=(u,l=[])=>{const i=e(u);return i?(l.unshift(i.name),i.parent_id?o(i.parent_id,l):l):l};return o(t).join(" > ")},z=B(()=>{if(!p.value||p.value.length===0)return[];const t=(i,y=new Set)=>(p.value.filter(d=>d.parent_id===i).forEach(d=>{y.add(d.id),t(d.id,y)}),y),e=new Set([x.value.id]);t(x.value.id).forEach(i=>e.add(i));let g=p.value.filter(i=>i&&i.id&&!e.has(i.id));if(h.value){const i=h.value.toLowerCase(),y=[],T=new Set;return g.forEach(d=>{if(!d||!d.name||T.has(d.id))return;const se=d.name.toLowerCase().includes(i),re=E(d.id).toLowerCase().includes(i),oe=P(d.id).toLowerCase().includes(i);(se||re||oe)&&(T.add(d.id),y.push(d))}),y}const u=[],l=new Set;return g.forEach(i=>{i&&i.id&&!l.has(i.id)&&(l.add(i.id),u.push(i))}),u}),W=()=>{Object.keys(a.value).forEach(e=>{a.value[e]=""});let t=!1;return(!s.name||s.name.trim()==="")&&(a.value.name="İsim zorunludur.",t=!0),(!s.slug||s.slug.trim()==="")&&(a.value.slug="Slug zorunludur.",t=!0),t&&G(),t},G=()=>{M(()=>{const t=[{ref:K,error:a.value.name},{ref:V,error:a.value.slug},{ref:D,error:a.value.parent_id},{ref:q,error:a.value.status},{ref:H,error:a.value.description}];for(const e of t)if(e.error&&e.ref.value){e.ref.value.scrollIntoView({behavior:"smooth",block:"center"}),M(()=>{const o=e.ref.value.querySelector("input, select, textarea");o&&o.focus()});break}})};F(()=>s.name,t=>{t&&(s.slug=t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""))});let j=null;le(()=>{s.processing=!1,window.dispatchEvent(new CustomEvent("formProcessingState",{detail:{processing:!1}})),M(()=>{const t=_.props.category||x.value;if(t&&t.id){if(R(t),t.parent){w.value=t.parent.name||"";const e=P(t.parent.id);h.value=e}else if(s.parent_id){const e=p.value.find(o=>o.id===s.parent_id);if(e){const o=P(e.id);h.value=o,w.value=e.name}}}}),(!L.value||L.value.length===0)&&ee(),document.addEventListener("keydown",t=>{t.key==="Escape"&&(k.value=!1)}),j=()=>{O()},window.addEventListener("sidebarFormSubmit",j)}),ae(()=>{j&&window.removeEventListener("sidebarFormSubmit",j)}),F(()=>s.processing,t=>{window.dispatchEvent(new CustomEvent("formProcessingState",{detail:{processing:t}}))});const X=()=>{clearTimeout($.value),z.value.length>0&&(k.value=!0)},Q=()=>{$.value=setTimeout(()=>{k.value=!1},100)},J=()=>{s.parent_id=null,h.value.length>=1&&(k.value=!0)},Y=t=>{if(!t||!t.id)return;s.parent_id=t.id,w.value=t.name;const e=P(t.id);h.value=e,M(()=>{k.value=!1})},Z=()=>{s.parent_id=null,h.value="",w.value=""},O=()=>{if(!W()){const e=x.value.slug||x.value.id;s.put(route("test-categories.update",{category:e}),{onSuccess:()=>{A.visit(route("test-categories.index"))},onError:o=>{Object.assign(a.value,o),G()}})}},ee=async()=>{N.value=!0;try{const t=await fetch(route("test-categories.index"),{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error("Failed to fetch categories");const e=await t.json();L.value=e.categories||[]}catch(t){console.error("Error fetching categories:",t)}finally{N.value=!1}},te=t=>{if(confirm("Bu kategoriyi silmek istediğinize emin misiniz?")){const e=x.value.slug||t;A.delete(route("test-categories.destroy",{category:e}),{onSuccess:()=>{A.visit(route("test-categories.index"))},onError:o=>{console.error("Kategori silinirken hata:",o)}})}};return(t,e)=>(f(),c("div",ge,[r("form",{onSubmit:pe(O,["prevent"]),class:"space-y-4"},[r("div",me,[r("div",{class:"md:col-span-2",ref_key:"nameRef",ref:K},[r("div",null,[e[7]||(e[7]=r("label",{class:"mb-1 block text-sm font-medium text-foreground"},"İsim",-1)),r("input",{type:"text",value:n(s).name,onInput:e[0]||(e[0]=o=>n(s).name=o.target.value),placeholder:"Kategori ismi",class:S(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":a.value.name||n(s).errors.name}])},null,42,be),a.value.name||n(s).errors.name?(f(),c("p",he,b(a.value.name||n(s).errors.name),1)):m("",!0)])],512),r("div",{ref_key:"slugRef",ref:V},[e[8]||(e[8]=r("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Slug",-1)),r("input",{type:"text",value:n(s).slug,onInput:e[1]||(e[1]=o=>n(s).slug=o.target.value),placeholder:"kategori-slug",class:S(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":a.value.slug||n(s).errors.slug}])},null,42,xe),a.value.slug||n(s).errors.slug?(f(),c("p",we,b(a.value.slug||n(s).errors.slug),1)):m("",!0)],512),r("div",{ref_key:"parentIdRef",ref:D},[r("div",ke,[e[11]||(e[11]=r("label",{class:"text-sm font-medium text-foreground"},"Üst Kategori",-1)),n(s).parent_id?(f(),c("div",ye,[e[10]||(e[10]=r("span",{class:"text-xs text-muted-foreground"},":",-1)),r("span",_e,b(w.value),1),E(n(s).parent_id)?(f(),c("span",Ce," ("+b(E(n(s).parent_id))+") ",1)):m("",!0),r("button",{type:"button",onClick:Z,class:"flex h-4 w-4 items-center justify-center rounded text-muted-foreground transition-colors hover:text-destructive","aria-label":"Kaldır"},[...e[9]||(e[9]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):m("",!0)]),r("div",Ee,[ue(r("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=o=>h.value=o),onFocus:X,onBlur:Q,onInput:J,onKeydown:e[3]||(e[3]=ce(o=>k.value=!1,["esc"])),placeholder:"Üst kategori ara (opsiyonel)",class:S(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":a.value.parent_id||n(s).errors.parent_id}])},null,34),[[de,h.value]]),k.value&&z.value.length>0?(f(),c("div",Se,[r("ul",Le,[(f(!0),c(fe,null,ve(z.value,o=>(f(),c("li",{key:o.id,onMousedown:g=>Y(o),class:"cursor-pointer rounded-sm px-2 py-1.5 text-sm text-popover-foreground transition-colors hover:bg-accent hover:text-accent-foreground"},[r("div",je,[r("span",Fe,b(o.name),1),E(o.id)?(f(),c("span",Me,[e[12]||(e[12]=r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mr-1 inline h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1)),I(" "+b(E(o.id)),1)])):m("",!0)])],40,Pe))),128))])])):m("",!0)]),a.value.parent_id||n(s).errors.parent_id?(f(),c("p",Re,b(a.value.parent_id||n(s).errors.parent_id),1)):m("",!0)],512),r("div",{ref_key:"statusRef",ref:q},[e[14]||(e[14]=r("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Durum",-1)),r("select",{value:n(s).status,onChange:e[4]||(e[4]=o=>n(s).status=o.target.value),class:S(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":a.value.status||n(s).errors.status}])},[...e[13]||(e[13]=[r("option",{value:"public"},"Açık",-1),r("option",{value:"private"},"Özel",-1),r("option",{value:"hidden"},"Gizli",-1)])],42,ze),a.value.status||n(s).errors.status?(f(),c("p",Te,b(a.value.status||n(s).errors.status),1)):m("",!0)],512),r("div",{class:"md:col-span-2",ref_key:"descriptionRef",ref:H},[e[15]||(e[15]=r("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Açıklama",-1)),r("textarea",{value:n(s).description,onInput:e[5]||(e[5]=o=>n(s).description=o.target.value),placeholder:"Kategori açıklaması (opsiyonel)",rows:"3",class:S(["flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":a.value.description||n(s).errors.description}])},null,42,Be),a.value.description||n(s).errors.description?(f(),c("p",Ie,b(a.value.description||n(s).errors.description),1)):m("",!0)],512)]),r("div",Ae,[r("button",{type:"button",onClick:e[6]||(e[6]=o=>te(x.value.id)),class:"inline-flex h-9 items-center justify-center gap-1.5 rounded-md border border-destructive bg-background px-4 text-sm font-medium text-destructive ring-offset-background transition-colors hover:bg-destructive hover:text-destructive-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-destructive focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",disabled:n(s).processing},[...e[16]||(e[16]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})],-1),I(" Sil ",-1)])],8,Ke),r("button",{type:"submit",class:"inline-flex h-9 items-center justify-center rounded-md bg-primary px-4 text-sm font-medium text-primary-foreground ring-offset-background transition-colors hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",disabled:n(s).processing},[n(s).processing?(f(),c("svg",De,[...e[17]||(e[17]=[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):m("",!0),I(" "+b(n(s).processing?"Güncelleniyor...":"Kategoriyi Güncelle"),1)],8,Ve)])],32)]))}});export{Ge as default};
