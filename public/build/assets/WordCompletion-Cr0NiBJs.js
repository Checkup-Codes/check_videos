import{_ as te,Q as se,i as v,r as h,l as ne,A as re,g as i,o as c,b as n,t as l,F as I,q as S,h as b,n as k,J as ae,K as oe,N as le,P as E,f as ie}from"./app-D1sKSmUB.js";import{g as L}from"./index-D3jsOSc0.js";/* empty css            */const g=y=>(ae("data-v-4b6a119a"),y=y(),oe(),y),ce={class:"flex flex-col items-center justify-center"},ue={key:0,class:"game-summary w-full max-w-md rounded-2xl border border-gray-200 bg-white px-6 shadow-sm"},de=g(()=>n("h2",{class:"mb-2 text-2xl font-semibold text-gray-900"},"Test Özeti",-1)),ge={class:"mb-4 text-center"},ve={class:"text-4xl font-bold text-gray-900"},fe=g(()=>n("p",{class:"text-sm text-gray-600"},"Puan",-1)),me={class:"mb-4 grid grid-cols-2 gap-4 rounded-lg bg-gray-50 p-4"},he={class:"text-center"},pe={class:"text-2xl font-bold text-green-600"},xe=g(()=>n("p",{class:"text-sm text-gray-600"},"Doğru",-1)),ye={class:"text-center"},we={class:"text-2xl font-bold text-red-600"},_e=g(()=>n("p",{class:"text-sm text-gray-600"},"Yanlış",-1)),be={class:"mb-4 text-center"},ke={class:"text-3xl font-bold text-blue-600"},Le=g(()=>n("p",{class:"text-sm text-gray-600"},"Toplam Puan",-1)),Ie={class:"mb-4 max-h-60 overflow-y-auto"},Ce=g(()=>n("h3",{class:"mb-2 font-medium text-gray-700"},"Cevaplarınız:",-1)),Pe={class:"space-y-2 text-left text-sm text-gray-800"},Ae={class:"flex flex-col"},Se={class:"text-xs text-gray-500"},Qe={key:0,class:"text-xs text-blue-600"},Re={class:"space-y-2"},Ue={key:1,disabled:"",class:"w-full rounded-lg bg-blue-400 px-4 py-2 text-center text-sm font-medium text-white"},Te={class:"flex gap-2"},je={class:"relative mb-4 h-1 w-full overflow-hidden rounded-full bg-gray-200"},Me={class:"mb-4 flex items-center justify-between text-sm text-gray-500"},ze={class:"flex flex-col items-end gap-1"},Be={class:"flex items-center gap-2"},De={class:"font-medium text-blue-600"},Ee=g(()=>n("span",null,"toplam puan",-1)),He={class:"flex items-center gap-2 text-xs"},Ge={class:"font-medium text-gray-600"},Ne=g(()=>n("span",null,"mevcut soru puanı",-1)),We=g(()=>n("div",{class:"flex items-center justify-between"},[n("h2",{class:"text-xl font-semibold text-gray-900"},"Eksik harfleri tamamlayın:")],-1)),qe={class:"mt-1 text-sm text-gray-500"},Oe={class:"space-y-2"},$e={key:0,class:"flex justify-center space-x-2"},Fe=["disabled"],Ke={__name:"WordCompletion",props:{gameType:String,packSlug:String,words:Array,gameConfig:Object},emits:["game-completed"],setup(y,{emit:H}){const u=y,Q=H,R=se(),G=R.props.languagePacks||[],C=v(()=>{var t;return!!((t=R.props.auth)!=null&&t.user)});v(()=>u.packSlug?G.find(t=>t.slug===u.packSlug):null);const e=h({isLoading:!0,isPlaying:!1,currentQuestion:null,showAnswer:!1,isCorrect:!1,progress:0,currentIndex:0,totalQuestions:0,userResponses:[],maskedIndices:[],selectedLetters:[],hintShown:!1,currentHintIndex:0,correctAnswer:"",totalPoints:0,displayPoints:0,hintsUsed:0,hintLetterIndices:[],isHintAnimating:!1}),p=h([]),U=v(()=>Object.fromEntries(p.value.map(t=>[t.id,t]))),P=v(()=>e.value.selectedLetters.every(t=>t!=="")),x=h(!1),T=async()=>{if(!u.words||u.words.length<2){alert("Oyunu başlatmak için en az 2 kelime gereklidir.");return}e.value.isLoading=!0;let t=[...u.words];if(u.gameConfig.wordType&&(t=t.filter(s=>s.type===u.gameConfig.wordType)),u.gameConfig.learningStatus!==""&&(t=t.filter(s=>s.learning_status===parseInt(u.gameConfig.learningStatus))),u.gameConfig.difficultyLevel&&(t=t.filter(s=>s.difficulty_level===u.gameConfig.difficultyLevel)),u.gameConfig.prioritizeUnlearned){const s=t.filter(o=>o.learning_status===0),a=t.filter(o=>o.learning_status===1),r=t.filter(o=>o.learning_status===2);t=[...s,...a,...r]}u.gameConfig.prioritizeRecentlyLearned&&t.sort((s,a)=>{const r=new Date(s.last_reviewed_at||0);return new Date(a.last_reviewed_at||0)-r}),u.gameConfig.prioritizeFlagged&&t.sort((s,a)=>s.is_flagged&&!a.is_flagged?-1:!s.is_flagged&&a.is_flagged?1:0),u.gameConfig.prioritizeMostIncorrect&&t.sort((s,a)=>{const r=s.incorrect_count||0;return(a.incorrect_count||0)-r}),t=t.sort(()=>Math.random()-.5),await new Promise(s=>{p.value=t,e.value.totalQuestions=p.value.length,e.value.currentIndex=0,e.value.userResponses=[],s()}),e.value.isLoading=!1,e.value.isPlaying=!0,j()},N=v(()=>{if(!e.value.userResponses.length)return 0;const t=e.value.userResponses.filter(s=>s.correct).length;return Math.round(t/e.value.userResponses.length*100)}),W=v(()=>{if(!e.value.currentQuestion)return 0;const s=e.value.currentQuestion.word.length*100,a=e.value.hintsUsed*100;return s-a}),q=()=>"abcçdefgğhıijklmnoöprsştuüvwxyz".split(""),O=v(()=>e.value.userResponses.filter(t=>t.correct).length),$=v(()=>e.value.userResponses.filter(t=>!t.correct).length),j=()=>{if(e.value.currentIndex>=p.value.length){J();return}const t=p.value[e.value.currentIndex].word,s=t.length;console.log("Yeni soru yükleniyor:",{currentIndex:e.value.currentIndex,word:t,wordLength:s});const r={...{isLoading:e.value.isLoading,isPlaying:e.value.isPlaying,currentIndex:e.value.currentIndex,totalQuestions:e.value.totalQuestions,userResponses:e.value.userResponses,totalPoints:e.value.totalPoints,displayPoints:e.value.displayPoints},currentQuestion:p.value[e.value.currentIndex],selectedLetters:[],showAnswer:!1,hintShown:!1,currentHintIndex:0,hintsUsed:0,hintLetterIndices:[],isHintAnimating:!1,progress:0,maskedIndices:[]};e.value=r,e.value.selectedLetters=Array(s).fill(""),e.value.hintLetterIndices=[],e.value.maskedIndices=Array.from({length:s},(o,d)=>d),console.log("Yeni state:",{selectedLetters:e.value.selectedLetters,hintLetterIndices:e.value.hintLetterIndices,maskedIndices:e.value.maskedIndices}),E(()=>{console.log("DOM güncellendi, harf kutuları:",{selectedLetters:e.value.selectedLetters,hintLetterIndices:e.value.hintLetterIndices,maskedIndices:e.value.maskedIndices});const o=A.value.children;L.fromTo(o,{y:-50,opacity:0,scale:.8},{y:0,opacity:1,scale:1,duration:.5,stagger:.05,ease:"back.out(1.7)"})})},M=h(null),F=h(null),K=h(null),A=h(null),V=()=>e.value.selectedLetters.findIndex(t=>!t),z=t=>{if(e.value.showAnswer)return;const s=t.key.toLowerCase(),a=q();if(t.key==="Shift"){if(console.log("Shift tuşuna basıldı:",{selectedLetters:e.value.selectedLetters,hintLetterIndices:e.value.hintLetterIndices}),e.value.isHintAnimating)return;const r=e.value.maskedIndices.filter((o,d)=>!e.value.selectedLetters[d]);if(r.length>0){const o=r[Math.floor(Math.random()*r.length)],d=e.value.currentQuestion.word[o].toLowerCase();e.value.isHintAnimating=!0;const f=A.value.children[o],m="abcdefghijklmnopqrstuvwxyz".split("");let w=50,_=0;const D=20,ee=setInterval(()=>{f.textContent=m[Math.floor(Math.random()*m.length)],_>D*.7&&(w+=10),_++,_>=D&&(clearInterval(ee),f.textContent=d,e.value.selectedLetters[o]=d,e.value.hintsUsed++,e.value.hintLetterIndices.push(o),L.to(f,{scale:1.1,duration:.2,yoyo:!0,repeat:1,onComplete:()=>{e.value.isHintAnimating=!1}}))},w)}}else if(a.includes(s)||s===" "){const r=e.value.selectedLetters.findIndex(o=>!o);r!==-1&&(e.value.selectedLetters[r]=s)}else if(t.key==="Backspace"){const r=[...e.value.selectedLetters].reverse().findIndex((o,d)=>{const f=e.value.selectedLetters.length-1-d;return o&&!e.value.hintLetterIndices.includes(f)});if(r!==-1){const o=e.value.selectedLetters.length-1-r;e.value.selectedLetters[o]=""}}else t.key==="Enter"&&P.value&&B()},B=()=>{if(e.value.showAnswer||!P.value)return;console.log("Cevap kontrolü öncesi:",{selectedLetters:e.value.selectedLetters,hintLetterIndices:e.value.hintLetterIndices});const t=e.value.currentQuestion.word.toLowerCase();let s=!0,a="";for(let m=0;m<e.value.maskedIndices.length;m++){const w=t[e.value.maskedIndices[m]],_=e.value.selectedLetters[m].toLowerCase();w!==_&&(s=!1),a+=w}console.log("Cevap kontrolü sonrası:",{isCorrect:s,correctAnswer:a,selectedLetters:e.value.selectedLetters,hintLetterIndices:e.value.hintLetterIndices}),e.value.isCorrect=s,e.value.correctAnswer=a;let r=0;s&&(r=t.length*100,r-=e.value.hintsUsed*100);const o=e.value.totalPoints,d=o+r;e.value.displayPoints=o,setTimeout(()=>{Y(o,d)},500),e.value.userResponses.push({word_id:e.value.currentQuestion.id,correct:s,points:r,hintsUsed:e.value.hintsUsed}),e.value.showAnswer=!0;const f=Math.round((e.value.currentIndex+1)/e.value.totalQuestions*100);L.to(M.value,{width:`${f}%`,duration:.5,ease:"power2.out"}),setTimeout(()=>{e.value.currentIndex++,j()},2e3)},Y=(t,s)=>{L.to(e.value,{displayPoints:s,duration:1,ease:"power2.out",onUpdate:()=>{e.value.totalPoints=Math.round(e.value.displayPoints)}})},J=()=>{console.log("Oyun bitti, özet ekranı gösteriliyor"),e.value.isPlaying=!1,E(()=>{const t=document.querySelector(".game-summary");t&&L.fromTo(t,{opacity:0,y:20},{opacity:1,y:0,duration:.5,ease:"power2.out"})})},X=()=>{e.value={isLoading:!0,isPlaying:!1,currentQuestion:null,showAnswer:!1,isCorrect:!1,progress:0,currentIndex:0,totalQuestions:0,userResponses:[],maskedIndices:[],selectedLetters:[],hintShown:!1,currentHintIndex:0,correctAnswer:"",totalPoints:0,displayPoints:0,hintsUsed:0,hintLetterIndices:[],isHintAnimating:!1},T()},Z=()=>{if(!C.value||!e.value.userResponses.length||x.value)return;x.value=!0;const t=e.value.userResponses.map(s=>({word_id:s.word_id,review_count:1,incorrect_count:s.correct?0:1}));le.post("/update-words",{words:t},{preserveState:!0,onSuccess:()=>{console.log("İstatistikler başarıyla güncellendi"),x.value=!1,setTimeout(()=>{Q("game-completed")},1e3)},onError:s=>{console.error("İstatistik güncelleme hatası:",s),x.value=!1}})};return ne(()=>{T(),window.addEventListener("keydown",z)}),re(()=>{window.removeEventListener("keydown",z)}),(t,s)=>(c(),i("div",ce,[!e.value.isPlaying&&e.value.userResponses.length>0?(c(),i("div",ue,[de,n("div",ge,[n("p",ve,l(N.value)+" / 100",1),fe]),n("div",me,[n("div",he,[n("p",pe,l(O.value),1),xe]),n("div",ye,[n("p",we,l($.value),1),_e])]),n("div",be,[n("p",ke,l(e.value.totalPoints),1),Le]),n("div",Ie,[Ce,n("ul",Pe,[(c(!0),i(I,null,S(e.value.userResponses,a=>{var r,o;return c(),i("li",{key:a.word_id,class:"flex items-center justify-between rounded-md bg-gray-50 px-4 py-2"},[n("div",Ae,[n("span",{class:k(a.correct?"font-medium text-green-600":"font-medium text-red-600")},l(((r=U.value[a.word_id])==null?void 0:r.word)||"Unknown"),3),n("span",Se,l(((o=U.value[a.word_id])==null?void 0:o.meaning)||""),1),a.correct?(c(),i("span",Qe,l(a.points)+" puan "+l(a.hintsUsed>0?`(${a.hintsUsed} ipucu kullanıldı)`:""),1)):b("",!0)]),n("span",{class:k(a.correct?"text-lg text-green-600":"text-lg text-red-600")},l(a.correct?"✓":"✗"),3)])}),128))])]),n("div",Re,[C.value&&!x.value?(c(),i("button",{key:0,onClick:Z,class:"w-full rounded-lg bg-blue-600 px-4 py-2 text-center text-sm font-medium text-white transition hover:bg-blue-700"}," Kelime İstatistiklerini Güncelle ve Pakete Dön ")):b("",!0),C.value&&x.value?(c(),i("button",Ue," Güncelleniyor... ")):b("",!0),n("div",Te,[n("button",{onClick:s[0]||(s[0]=a=>Q("game-completed")),class:"flex-1 rounded-lg bg-black px-4 py-2 text-center text-sm font-medium text-white transition hover:bg-gray-700"}," Pakete Dön "),n("button",{onClick:X,class:"flex-1 rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 transition hover:bg-gray-100"}," Tekrar Başla ")])])])):(c(),i("div",{key:1,class:k(["relative w-full max-w-md rounded-2xl border border-gray-200 p-6 shadow-sm transition-colors duration-500",{"bg-white":!e.value.showAnswer,"bg-green-50":e.value.showAnswer&&e.value.isCorrect,"bg-red-50":e.value.showAnswer&&!e.value.isCorrect}])},[n("div",je,[n("div",{ref_key:"progressBar",ref:M,class:"h-full w-0 bg-black"},null,512),n("div",{ref_key:"progressBarGlow",ref:F,class:"absolute left-0 top-0 h-full w-[50px] bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,512)]),n("div",Me,[n("div",null,"Soru "+l(e.value.currentIndex+1)+" / "+l(e.value.totalQuestions),1),n("div",ze,[n("div",Be,[n("span",De,l(e.value.totalPoints),1),Ee]),n("div",He,[n("span",Ge,l(W.value),1),Ne])])]),e.value.currentQuestion?(c(),i("div",{key:0,class:"space-y-4",ref_key:"questionContainer",ref:K},[n("div",null,[We,n("p",qe,"Anlam: "+l(e.value.currentQuestion.meaning),1)]),n("div",Oe,[n("div",{class:"flex justify-center space-x-2",ref_key:"selectedLettersContainer",ref:A},[(c(!0),i(I,null,S(e.value.currentQuestion.word.split(""),(a,r)=>(c(),i("div",{key:`${e.value.currentIndex}-${r}`,class:k(["flex h-12 w-12 items-center justify-center rounded-lg border text-xl font-semibold transition-all",{"border-gray-300":!e.value.selectedLetters[r],"border-black bg-gray-50":!e.value.selectedLetters[r]&&r===V(),"border-green-500 bg-green-50":e.value.showAnswer&&e.value.isCorrect,"border-red-500 bg-red-50":e.value.showAnswer&&!e.value.isCorrect,"border-blue-500":e.value.hintLetterIndices.includes(r)&&!e.value.isHintAnimating}])},[e.value.maskedIndices.includes(r)?(c(),i("span",{key:0,class:k({"text-blue-600":e.value.hintLetterIndices.includes(r)})},l(e.value.selectedLetters[r]||""),3)):(c(),i(I,{key:1},[ie(l(a.toLowerCase()),1)],64))],2))),128))],512),e.value.showAnswer&&!e.value.isCorrect?(c(),i("div",$e,[(c(!0),i(I,null,S(e.value.currentQuestion.word.split(""),(a,r)=>(c(),i("div",{key:r,class:"flex h-8 w-8 items-center justify-center rounded-lg border border-green-500 bg-green-50 text-sm font-medium text-green-700"},l(a.toLowerCase()),1))),128))])):b("",!0)]),n("button",{onClick:B,disabled:e.value.showAnswer||!P.value,class:"w-full rounded-lg bg-black px-4 py-2 text-center text-sm font-medium text-white transition hover:bg-gray-700 disabled:opacity-50"}," Kontrol Et ",8,Fe)],512)):b("",!0)],2))]))}},Xe=te(Ke,[["__scopeId","data-v-4b6a119a"]]);export{Xe as default};
