import{Q,b as C,g as x,T as J,s as W,y as Z,e as I,w as D,f as M,a as o,h as ee,i as g,c as u,j as _,n as z,u as n,m as y,o as d,t as b,F as T,l as S,v as V,I as te,k as N,p as oe,N as se,C as B}from"./ssr-D-O19Sjt.js";import{_ as re}from"./CheckScreen-CfAad_1h.js";import{_ as ie}from"./TopScreen-BNXHWRHd.js";import{_ as ne}from"./GoBackButton-Cb9Rfue0.js";import"./app-Ld--xmxC.js";/* empty css            */const le={class:"rounded-lg border border-border bg-card shadow-sm"},de={class:"p-6"},ue={class:"space-y-4"},ae={key:0,class:"mt-1 text-xs text-destructive"},ce=["value"],pe={key:0,class:"mt-1 text-xs text-destructive"},fe=["value"],me={key:0,class:"mt-1 text-xs text-destructive"},ge={class:"space-y-4 border-t border-border pt-6"},be={key:0,class:"flex items-center gap-3 rounded-md border border-border bg-muted/50 p-4 text-sm text-muted-foreground"},ve={key:1,class:"space-y-4"},xe={class:"flex cursor-pointer items-center gap-3"},_e=["value","onChange"],ye={class:"flex-1"},ke={class:"text-sm font-medium text-foreground"},he={key:0,class:"mt-1 text-xs text-muted-foreground"},we={key:0,class:"mt-4 space-y-3 border-t border-border pt-4 pl-7"},je={class:"grid grid-cols-1 gap-3 md:grid-cols-2"},Ce=["onUpdate:modelValue"],Te=["onUpdate:modelValue"],Se=["onUpdate:modelValue"],Ve=["onUpdate:modelValue"],Be=["onUpdate:modelValue"],Ue=["onUpdate:modelValue"],$e={class:"space-y-3 border-t border-border pt-4"},Me={class:"flex items-center justify-between"},ze={class:"text-xs text-muted-foreground"},Ne={class:"space-y-2"},Oe=["checked","onChange"],De=["onUpdate:modelValue","onBlur"],Ee=["onClick"],Re=["onClick"],Fe={key:2,class:"text-xs text-destructive"},Pe={class:"flex justify-end gap-2 border-t border-border pt-4"},Ae=["disabled"],Ke={key:0,class:"h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},qe={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},We={__name:"Screen",setup(He){const{props:h}=Q(),U=C(()=>h.services||[]),E=C(()=>h.customers||[]),R=C(()=>h.categories||[]),m=C(()=>h.project||{}),F=x(null),P=x(null),A=x(null),p=x({project_name:"",customer_id:"",category_id:"",services:""}),k=x({}),v=x([]),a=x({}),O=()=>{m.value.services&&m.value.services.length>0&&m.value.services.forEach(s=>{var t,e,r,c,l,w;v.value.push(s.id),k.value[s.id]={id:s.id,price:((t=s.pivot)==null?void 0:t.price)||null,status:((e=s.pivot)==null?void 0:e.status)||"pending",payment_status:((r=s.pivot)==null?void 0:r.payment_status)||"unpaid",notes:((c=s.pivot)==null?void 0:c.notes)||"",service_start_date:((l=s.pivot)==null?void 0:l.service_start_date)||null,service_end_date:((w=s.pivot)==null?void 0:w.service_end_date)||null},s.todos&&s.todos.length>0?a.value[s.id]=s.todos.map(j=>({id:j.id,title:j.title,is_completed:j.is_completed||!1,completed_at:j.completed_at||null})):a.value[s.id]=[]})},i=J({project_name:m.value.project_name||"",customer_id:m.value.customer_id||"",category_id:m.value.category_id||"",services:[]});i.processing=!1,W(()=>{O()}),Z(()=>m.value,()=>{O()},{deep:!0});const f=s=>(k.value[s]||(k.value[s]={id:s,price:null,status:"pending",payment_status:"unpaid",notes:"",service_start_date:null,service_end_date:null}),k.value[s]),$=s=>(a.value[s]||(a.value[s]=[]),a.value[s]),K=s=>{a.value[s]||(a.value[s]=[]),a.value[s].push({id:null,title:"",is_completed:!1,completed_at:null})},q=async(s,t)=>{var r;const e=a.value[s][t];if(a.value[s].splice(t,1),e.id)try{await B.delete(`/project-service-todos/${e.id}`,{headers:{"X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""}})}catch(c){a.value[s].splice(t,0,e),console.error("Todo silinirken hata oluştu:",c)}},H=async(s,t)=>{var l;const e=a.value[s][t],r=e.is_completed,c=e.completed_at;if(e.is_completed=!e.is_completed,e.completed_at=e.is_completed?new Date().toISOString():null,e.id)try{await B.put(`/project-service-todos/${e.id}`,{is_completed:e.is_completed},{headers:{"X-CSRF-TOKEN":((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content"))||""}})}catch(w){e.is_completed=r,e.completed_at=c,console.error("Todo güncellenirken hata oluştu:",w)}},X=async(s,t)=>{var c;const e=a.value[s][t];if(!e.title||!e.title.trim())return;const r=((c=document.querySelector('meta[name="csrf-token"]'))==null?void 0:c.getAttribute("content"))||"";if(e.id)try{await B.put(`/project-service-todos/${e.id}`,{title:e.title},{headers:{"X-CSRF-TOKEN":r}})}catch(l){console.error("Todo güncellenirken hata oluştu:",l)}else try{const l=await B.post("/project-service-todos",{project_id:m.value.id,service_id:s,title:e.title,is_completed:e.is_completed||!1},{headers:{"X-CSRF-TOKEN":r}});l.data&&l.data.id&&(e.id=l.data.id,l.data.completed_at&&(e.completed_at=l.data.completed_at))}catch(l){console.error("Todo oluşturulurken hata oluştu:",l)}},L=s=>{const t=$(s);if(t.length===0)return 0;const e=t.filter(r=>r.is_completed).length;return Math.round(e/t.length*100)},G=s=>{v.value.includes(s)||(delete k.value[s],delete a.value[s])},Y=()=>{i.services=v.value.map(s=>f(s)),i.put(`/projects/${m.value.id}`,{onSuccess:()=>{v.value.forEach(s=>{$(s).forEach(e=>{!e.id&&e.title&&e.title.trim()&&se.post("/project-service-todos",{project_id:m.value.id,service_id:s,title:e.title,is_completed:e.is_completed||!1},{preserveState:!0,preserveScroll:!0})})})},onError:s=>{s&&Object.keys(s).forEach(t=>{p.value.hasOwnProperty(t)&&(p.value[t]=s[t])})}})};return(s,t)=>(d(),I(re,null,{default:D(()=>[M(ne,{url:`/projects/${m.value.id}`},null,8,["url"]),M(ie,{title:"Projeyi Düzenle"}),o("div",le,[o("div",de,[o("form",{onSubmit:ee(Y,["prevent"]),class:"space-y-6"},[o("div",ue,[t[10]||(t[10]=o("h3",{class:"text-sm font-semibold text-foreground"},"Proje Bilgileri",-1)),o("div",{ref_key:"projectNameRef",ref:F},[t[4]||(t[4]=o("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Proje Adı",-1)),g(o("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>n(i).project_name=e),type:"text",placeholder:"Proje adını girin",class:z(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":p.value.project_name||n(i).errors.project_name}]),required:""},null,2),[[y,n(i).project_name]]),p.value.project_name||n(i).errors.project_name?(d(),u("p",ae,b(p.value.project_name||n(i).errors.project_name),1)):_("",!0)],512),o("div",{ref_key:"customerIdRef",ref:P},[t[6]||(t[6]=o("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Müşteri Seçin",-1)),g(o("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>n(i).customer_id=e),class:z(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":p.value.customer_id||n(i).errors.customer_id}]),required:""},[t[5]||(t[5]=o("option",{disabled:"",value:""},"Bir müşteri seçin",-1)),(d(!0),u(T,null,S(E.value,e=>(d(),u("option",{key:e.id,value:e.id},b(e.first_name)+" "+b(e.last_name),9,ce))),128))],2),[[V,n(i).customer_id]]),p.value.customer_id||n(i).errors.customer_id?(d(),u("p",pe,b(p.value.customer_id||n(i).errors.customer_id),1)):_("",!0)],512),o("div",{ref_key:"categoryIdRef",ref:A},[t[8]||(t[8]=o("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Kategori/Yazı Bağlantısı (Opsiyonel)",-1)),g(o("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>n(i).category_id=e),class:z(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":p.value.category_id||n(i).errors.category_id}])},[t[7]||(t[7]=o("option",{value:""},"Kategori seçin (opsiyonel)",-1)),(d(!0),u(T,null,S(R.value,e=>(d(),u("option",{key:e.id,value:e.id},b(e.name),9,fe))),128))],2),[[V,n(i).category_id]]),p.value.category_id||n(i).errors.category_id?(d(),u("p",me,b(p.value.category_id||n(i).errors.category_id),1)):_("",!0),t[9]||(t[9]=o("p",{class:"mt-1 text-xs text-muted-foreground"}," Bu projeye ait yazıların bulunduğu kategoriyi seçin. Bu kategori altındaki tüm yazılar bu projeyle ilişkilendirilir. ",-1))],512)]),o("div",ge,[t[23]||(t[23]=o("h3",{class:"text-sm font-semibold text-foreground"},"Servisler",-1)),!U.value||U.value.length===0?(d(),u("div",be,[...t[11]||(t[11]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"h-5 w-5 shrink-0",stroke:"currentColor","stroke-width":"2"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),o("span",null,"Henüz servis bulunmamaktadır.",-1)])])):(d(),u("div",ve,[(d(!0),u(T,null,S(U.value,e=>(d(),u("div",{key:e.id,class:"rounded-md border border-input bg-card p-4"},[o("label",xe,[g(o("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":t[3]||(t[3]=r=>v.value=r),onChange:r=>G(e.id),class:"h-4 w-4 rounded border-input text-primary focus:ring-2 focus:ring-ring focus:ring-offset-2"},null,40,_e),[[te,v.value]]),o("div",ye,[o("span",ke,b(e.name),1),e.description?(d(),u("p",he,b(e.description),1)):_("",!0)])]),v.value.includes(e.id)?(d(),u("div",we,[o("div",je,[o("div",null,[t[12]||(t[12]=o("label",{class:"mb-1 block text-xs font-medium text-foreground"},"Projeye Özel Fiyat (₺)",-1)),g(o("input",{"onUpdate:modelValue":r=>f(e.id).price=r,type:"number",step:"0.01",min:"0",placeholder:"Fiyat girin",class:"flex h-8 w-full rounded-md border border-input bg-background px-2 py-1 text-xs ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,8,Ce),[[y,f(e.id).price,void 0,{number:!0}]])]),o("div",null,[t[14]||(t[14]=o("label",{class:"mb-1 block text-xs font-medium text-foreground"},"Durum",-1)),g(o("select",{"onUpdate:modelValue":r=>f(e.id).status=r,class:"flex h-8 w-full rounded-md border border-input bg-background px-2 py-1 text-xs ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...t[13]||(t[13]=[o("option",{value:"pending"},"Beklemede",-1),o("option",{value:"active"},"Aktif",-1),o("option",{value:"completed"},"Tamamlandı",-1),o("option",{value:"cancelled"},"İptal Edildi",-1)])],8,Te),[[V,f(e.id).status]])]),o("div",null,[t[16]||(t[16]=o("label",{class:"mb-1 block text-xs font-medium text-foreground"},"Ödeme Durumu",-1)),g(o("select",{"onUpdate:modelValue":r=>f(e.id).payment_status=r,class:"flex h-8 w-full rounded-md border border-input bg-background px-2 py-1 text-xs ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...t[15]||(t[15]=[o("option",{value:"unpaid"},"Ödenmedi",-1),o("option",{value:"partial"},"Kısmi Ödendi",-1),o("option",{value:"paid"},"Ödendi",-1)])],8,Se),[[V,f(e.id).payment_status]])]),o("div",null,[t[17]||(t[17]=o("label",{class:"mb-1 block text-xs font-medium text-foreground"},"Hizmet Başlangıç Tarihi",-1)),g(o("input",{"onUpdate:modelValue":r=>f(e.id).service_start_date=r,type:"date",class:"flex h-8 w-full rounded-md border border-input bg-background px-2 py-1 text-xs ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,8,Ve),[[y,f(e.id).service_start_date]])]),o("div",null,[t[18]||(t[18]=o("label",{class:"mb-1 block text-xs font-medium text-foreground"},"Hizmet Bitiş Tarihi",-1)),g(o("input",{"onUpdate:modelValue":r=>f(e.id).service_end_date=r,type:"date",class:"flex h-8 w-full rounded-md border border-input bg-background px-2 py-1 text-xs ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,8,Be),[[y,f(e.id).service_end_date]])])]),o("div",null,[t[19]||(t[19]=o("label",{class:"mb-1 block text-xs font-medium text-foreground"},"Notlar",-1)),g(o("textarea",{"onUpdate:modelValue":r=>f(e.id).notes=r,rows:"3",placeholder:"Bu servis hakkında notlar...",class:"flex w-full rounded-md border border-input bg-background px-2 py-1 text-xs ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,8,Ue),[[y,f(e.id).notes]])]),o("div",$e,[o("div",Me,[t[20]||(t[20]=o("label",{class:"block text-xs font-medium text-foreground"},"TO-DO'lar",-1)),o("span",ze," Tamamlanma: "+b(L(e.id))+"% ",1)]),o("div",Ne,[(d(!0),u(T,null,S($(e.id),(r,c)=>(d(),u("div",{key:r.id||`temp-${c}`,class:"flex items-center gap-2 rounded-md border border-input bg-background p-2"},[o("input",{type:"checkbox",checked:r.is_completed,onChange:l=>H(e.id,c),class:"h-4 w-4 rounded border-input text-primary focus:ring-2 focus:ring-ring focus:ring-offset-2"},null,40,Oe),g(o("input",{"onUpdate:modelValue":l=>r.title=l,type:"text",placeholder:"Todo başlığı...",class:"flex-1 border-none bg-transparent px-2 py-1 text-xs text-foreground focus:outline-none focus:ring-0",onBlur:l=>X(e.id,c)},null,40,De),[[y,r.title]]),o("button",{type:"button",onClick:l=>q(e.id,c),class:"text-destructive hover:text-destructive/80"},[...t[21]||(t[21]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Ee)]))),128))]),o("button",{type:"button",onClick:r=>K(e.id),class:"inline-flex h-7 w-full items-center justify-center gap-2 rounded-md border border-input bg-background px-3 text-xs font-medium text-foreground transition-colors hover:bg-accent hover:text-accent-foreground"},[...t[22]||(t[22]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"})],-1),N(" Yeni TO-DO Ekle ",-1)])],8,Re)])])):_("",!0)]))),128))])),p.value.services||n(i).errors.services?(d(),u("p",Fe,b(p.value.services||n(i).errors.services),1)):_("",!0)]),o("div",Pe,[M(n(oe),{href:`/projects/${m.value.id}`,class:"inline-flex h-9 items-center justify-center rounded-md border border-input bg-background px-4 text-sm font-medium text-foreground ring-offset-background transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},{default:D(()=>[...t[24]||(t[24]=[N(" İptal ",-1)])]),_:1},8,["href"]),o("button",{type:"submit",class:"inline-flex h-9 items-center justify-center gap-2 rounded-md bg-primary px-4 text-sm font-medium text-primary-foreground ring-offset-background transition-colors hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",disabled:n(i).processing},[n(i).processing?(d(),u("svg",Ke,[...t[25]||(t[25]=[o("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),o("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(d(),u("svg",qe,[...t[26]||(t[26]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"},null,-1)])])),N(" "+b(n(i).processing?"Güncelleniyor...":"Projeyi Güncelle"),1)],8,Ae)])],32)])])]),_:1}))}};export{We as default};
