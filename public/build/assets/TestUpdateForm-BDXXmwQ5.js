import{Q,g as h,b as z,s as B,T as Y,x as J,y as W,c as d,a as t,i as b,j as f,m,u as r,n as x,t as g,v as X,G as Z,F as $,l as S,k as q,f as I,w as ee,p as te,h as se,N as oe,o as a}from"./ssr-B7YpsODM.js";const re={class:"space-y-6 py-6"},ie={class:"space-y-4 rounded-lg border border-border bg-card p-6"},le={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ne={class:"md:col-span-2",ref:"titleRef"},ue={key:0,class:"mt-1 text-xs text-destructive"},de={ref:"slugRef"},ae={key:0,class:"mt-1 text-xs text-destructive"},ce={ref:"statusRef"},pe={key:0,class:"mt-1 text-xs text-destructive"},fe={class:"md:col-span-2",ref:"descriptionRef"},be={key:0,class:"mt-1 text-xs text-destructive"},ge={ref:"categoryRef"},me={class:"relative"},ve={key:1,tabindex:"0",class:"absolute z-50 mt-1 max-h-48 w-full overflow-y-auto rounded border border-border bg-popover shadow-lg"},xe=["onMousedown"],_e={key:0,class:"mt-1 text-xs text-destructive"},he={ref:"timeLimitRef"},ye={key:0,class:"mt-1 text-xs text-destructive"},ke={ref:"publishedAtRef"},we={class:"flex gap-2"},Ce={key:0,class:"mt-1 text-xs text-destructive"},$e={class:"space-y-4 rounded-lg border border-border bg-card p-6"},Se={key:0,class:"text-sm text-muted-foreground"},qe={class:"flex items-center justify-between"},Te={class:"text-lg font-semibold text-foreground"},Ve=["onClick"],je={class:"space-y-4"},Ee=["onUpdate:modelValue"],Ue={key:0,class:"mt-1 text-xs text-destructive"},ze={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Be=["onUpdate:modelValue"],Me=["onUpdate:modelValue"],Ae={class:"space-y-3"},De={class:"flex items-center justify-between"},Le=["onClick"],Fe={class:"flex-1 space-y-2"},Re={class:"flex items-center gap-2"},Oe={class:"flex h-6 w-6 items-center justify-center rounded-full bg-muted text-xs font-medium text-muted-foreground"},Ne=["onUpdate:modelValue","placeholder"],Ge={class:"flex items-center gap-2"},He={class:"flex cursor-pointer items-center gap-2"},Ke=["name","checked","onChange"],Pe=["onClick"],Qe={key:0,class:"text-xs text-destructive"},Ye={class:"flex gap-4"},Je=["disabled"],We={key:0},Xe={key:1},et={__name:"TestUpdateForm",setup(Ze){const{props:T}=Q(),c=h(T.test||{}),M=l=>{const e=[],o=new Set,n=u=>{!u||!Array.isArray(u)||u.forEach(p=>{p&&p.id&&!o.has(p.id)&&(o.add(p.id),e.push(p),p.children&&Array.isArray(p.children)&&p.children.length>0&&n(p.children))})};return n(l),e},A=h(T.categories||[]),w=z(()=>M(A.value)),_=h(""),y=h(!1),V=h(null);B(()=>{if(c.value.category_id){const l=w.value.find(e=>e.id===c.value.category_id);l&&(_.value=l.name)}});const j=z(()=>{if(!_.value)return w.value.slice(0,10);const l=_.value.toLowerCase();return w.value.filter(e=>e.name.toLowerCase().includes(l)).slice(0,10)}),D=()=>{clearTimeout(V.value),y.value=!0},L=()=>{V.value=setTimeout(()=>{y.value=!1},200)},F=()=>{y.value=!0},R=l=>{s.category_id=l.id,_.value=l.name,y.value=!1},O=()=>{s.category_id=null,_.value=""},v=h({date:"",time:""});if(c.value.published_at){const l=new Date(c.value.published_at);v.value.date=l.toISOString().split("T")[0],v.value.time=l.toTimeString().slice(0,5)}const s=Y({title:c.value.title||"",slug:c.value.slug||"",description:c.value.description||"",category_id:c.value.category_id||null,status:c.value.status||"draft",time_limit:c.value.time_limit||null,published_at:c.value.published_at||null,questions:[]});let k=null;B(()=>{s.processing=!1,window.dispatchEvent(new CustomEvent("formProcessingState",{detail:{processing:!1}})),c.value.questions&&c.value.questions.length>0?s.questions=c.value.questions.map(l=>({question_text:l.question_text||"",question_type:l.question_type||"multiple_choice",points:l.points||10,explanation:l.explanation||"",order:l.order||0,options:(l.options||[]).map((e,o)=>({option_text:e.option_text||"",is_correct:e.is_correct||!1,order:o}))})):E(),k=()=>{U()},window.addEventListener("sidebarFormSubmit",k)}),J(()=>{k&&window.removeEventListener("sidebarFormSubmit",k)}),W(()=>s.processing,l=>{window.dispatchEvent(new CustomEvent("formProcessingState",{detail:{processing:l}}))});const E=()=>{s.questions.push({question_text:"",question_type:"multiple_choice",points:10,explanation:"",order:s.questions.length,options:[{option_text:"",is_correct:!1,order:0},{option_text:"",is_correct:!1,order:1},{option_text:"",is_correct:!1,order:2},{option_text:"",is_correct:!1,order:3}]})},N=l=>{s.questions.splice(l,1),s.questions.forEach((e,o)=>{e.order=o})},G=l=>{const e=s.questions[l];e.options.push({option_text:"",is_correct:!1,order:e.options.length})},H=(l,e)=>{const o=s.questions[l];o.options.length>2&&(o.options.splice(e,1),o.options.forEach((n,u)=>{n.order=u}))},K=(l,e)=>{s.questions[l].options.forEach((n,u)=>{n.is_correct=u===e})},i=h({}),P=()=>(i.value={},(!s.title||s.title.trim()==="")&&(i.value.title="Başlık zorunludur."),(!s.slug||s.slug.trim()==="")&&(i.value.slug="Slug zorunludur."),s.questions.length===0&&(i.value.questions="En az bir soru eklenmelidir."),s.questions.forEach((l,e)=>{(!l.question_text||l.question_text.trim()==="")&&(i.value[`questions.${e}.question_text`]="Soru metni zorunludur."),(!l.options||l.options.length<2)&&(i.value[`questions.${e}.options`]="En az 2 şık eklenmelidir."),l.options.some(n=>n.is_correct)||(i.value[`questions.${e}.options`]="En az bir doğru cevap seçilmelidir."),l.options.forEach((n,u)=>{(!n.option_text||n.option_text.trim()==="")&&(i.value[`questions.${e}.options.${u}.option_text`]="Şık metni zorunludur.")})}),Object.keys(i.value).length===0),U=()=>{if(!P())return;v.value.date&&v.value.time?s.published_at=`${v.value.date}T${v.value.time}:00`:s.published_at=null;const l=s.questions.map((e,o)=>({question_text:e.question_text,question_type:e.question_type||"multiple_choice",points:e.points||10,explanation:e.explanation||null,order:o,options:e.options.map((n,u)=>({option_text:n.option_text,is_correct:n.is_correct||!1,order:u}))}));s.questions=l,s.put(route("tests.update",{test:c.value.slug}),{onSuccess:e=>{var o,n;((n=(o=e==null?void 0:e.props)==null?void 0:o.test)!=null&&n.slug||s.slug)&&oe.visit(route("tests.show",{test:s.slug||c.value.slug}))},onError:e=>{e&&Object.keys(e).forEach(o=>{i.value.hasOwnProperty(o)&&(i.value[o]=e[o])})}})};return(l,e)=>(a(),d("div",re,[e[29]||(e[29]=t("div",{class:"mb-6"},[t("h1",{class:"text-3xl font-bold text-foreground"},"Test Düzenle"),t("p",{class:"mt-2 text-sm text-muted-foreground"},"Test bilgilerini ve sorularını düzenleyin")],-1)),t("form",{onSubmit:se(U,["prevent"]),class:"space-y-6"},[t("div",ie,[e[17]||(e[17]=t("h2",{class:"text-xl font-semibold text-foreground"},"Test Bilgileri",-1)),t("div",le,[t("div",ne,[e[9]||(e[9]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Test Başlığı *",-1)),b(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>r(s).title=o),placeholder:"Test başlığını girin",class:x(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.title||r(s).errors.title}])},null,2),[[m,r(s).title]]),i.value.title||r(s).errors.title?(a(),d("p",ue,g(i.value.title||r(s).errors.title),1)):f("",!0)],512),t("div",de,[e[10]||(e[10]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Slug *",-1)),b(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=o=>r(s).slug=o),placeholder:"test-slug",class:x(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.slug||r(s).errors.slug}])},null,2),[[m,r(s).slug]]),i.value.slug||r(s).errors.slug?(a(),d("p",ae,g(i.value.slug||r(s).errors.slug),1)):f("",!0)],512),t("div",ce,[e[12]||(e[12]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Durum *",-1)),b(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>r(s).status=o),class:x(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",{"border-destructive focus-visible:ring-destructive":i.value.status||r(s).errors.status}])},[...e[11]||(e[11]=[t("option",{value:"draft"},"Taslak",-1),t("option",{value:"published"},"Yayınlandı",-1),t("option",{value:"private"},"Gizli",-1)])],2),[[X,r(s).status]]),i.value.status||r(s).errors.status?(a(),d("p",pe,g(i.value.status||r(s).errors.status),1)):f("",!0)],512),t("div",fe,[e[13]||(e[13]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Açıklama",-1)),b(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=o=>r(s).description=o),rows:"3",placeholder:"Test hakkında kısa bir açıklama",class:x(["flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.description||r(s).errors.description}])},null,2),[[m,r(s).description]]),i.value.description||r(s).errors.description?(a(),d("p",be,g(i.value.description||r(s).errors.description),1)):f("",!0)],512),t("div",ge,[e[14]||(e[14]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Kategori",-1)),t("div",me,[b(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=o=>_.value=o),onFocus:D,onBlur:L,onInput:F,onKeydown:e[5]||(e[5]=Z(o=>y.value=!1,["esc"])),placeholder:"Kategori seçin...",class:x(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 pr-8 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.category_id||r(s).errors.category_id}]),tabindex:"0"},null,34),[[m,_.value]]),_.value?(a(),d("button",{key:0,onClick:O,class:"absolute right-2 top-1/2 inline-flex h-5 w-5 -translate-y-1/2 items-center justify-center rounded text-xs hover:bg-accent"}," ✕ ")):f("",!0),y.value&&j.value.length>0?(a(),d("ul",ve,[(a(!0),d($,null,S(j.value,o=>(a(),d("li",{key:o.id,onMousedown:n=>R(o),class:"cursor-pointer px-2 py-1.5 text-sm hover:bg-accent"},g(o.name),41,xe))),128))])):f("",!0)]),i.value.category_id||r(s).errors.category_id?(a(),d("p",_e,g(i.value.category_id||r(s).errors.category_id),1)):f("",!0)],512),t("div",he,[e[15]||(e[15]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Süre Limiti (dakika)",-1)),b(t("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=o=>r(s).time_limit=o),min:"0",placeholder:"Boş bırakılabilir",class:x(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.time_limit||r(s).errors.time_limit}])},null,2),[[m,r(s).time_limit,void 0,{number:!0}]]),i.value.time_limit||r(s).errors.time_limit?(a(),d("p",ye,g(i.value.time_limit||r(s).errors.time_limit),1)):f("",!0)],512),t("div",ke,[e[16]||(e[16]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Yayınlama Tarihi",-1)),t("div",we,[b(t("input",{type:"date","onUpdate:modelValue":e[7]||(e[7]=o=>v.value.date=o),class:x(["flex h-9 flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.published_at||r(s).errors.published_at}])},null,2),[[m,v.value.date]]),b(t("input",{type:"time","onUpdate:modelValue":e[8]||(e[8]=o=>v.value.time=o),class:x(["flex h-9 flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.published_at||r(s).errors.published_at}])},null,2),[[m,v.value.time]])]),i.value.published_at||r(s).errors.published_at?(a(),d("p",Ce,g(i.value.published_at||r(s).errors.published_at),1)):f("",!0)],512)])]),t("div",$e,[t("div",{class:"flex items-center justify-between"},[e[19]||(e[19]=t("h2",{class:"text-xl font-semibold text-foreground"},"Sorular",-1)),t("button",{type:"button",onClick:E,class:"inline-flex h-9 items-center justify-center gap-2 rounded-md bg-primary px-4 text-sm font-medium text-primary-foreground hover:bg-primary/90"},[...e[18]||(e[18]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),q(" Soru Ekle ",-1)])])]),r(s).questions.length===0?(a(),d("p",Se,' Henüz soru eklenmedi. "Soru Ekle" butonuna tıklayarak soru ekleyin. ')):f("",!0),(a(!0),d($,null,S(r(s).questions,(o,n)=>(a(),d("div",{key:n,class:"space-y-4 rounded-lg border border-border bg-background p-4"},[t("div",qe,[t("h3",Te,"Soru "+g(n+1),1),t("button",{type:"button",onClick:u=>N(n),class:"inline-flex h-8 w-8 items-center justify-center rounded-md text-destructive hover:bg-destructive/10"},[...e[20]||(e[20]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Ve)]),t("div",je,[t("div",null,[e[21]||(e[21]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Soru Metni *",-1)),b(t("textarea",{"onUpdate:modelValue":u=>o.question_text=u,rows:"3",placeholder:"Soruyu buraya yazın...",class:x(["flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",{"border-destructive focus-visible:ring-destructive":i.value[`questions.${n}.question_text`]||r(s).errors[`questions.${n}.question_text`]}])},null,10,Ee),[[m,o.question_text]]),i.value[`questions.${n}.question_text`]||r(s).errors[`questions.${n}.question_text`]?(a(),d("p",Ue,g(i.value[`questions.${n}.question_text`]||r(s).errors[`questions.${n}.question_text`]),1)):f("",!0)]),t("div",ze,[t("div",null,[e[22]||(e[22]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Puan",-1)),b(t("input",{type:"number","onUpdate:modelValue":u=>o.points=u,min:"1",placeholder:"10",class:"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,8,Be),[[m,o.points,void 0,{number:!0}]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Açıklama",-1)),b(t("input",{type:"text","onUpdate:modelValue":u=>o.explanation=u,placeholder:"Doğru cevap açıklaması (opsiyonel)",class:"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,8,Me),[[m,o.explanation]])])]),t("div",Ae,[t("div",De,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-foreground"},"Şıklar *",-1)),t("button",{type:"button",onClick:u=>G(n),class:"inline-flex h-8 items-center justify-center gap-1 rounded-md border border-input bg-background px-3 text-xs font-medium text-foreground hover:bg-accent"},[...e[24]||(e[24]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),q(" Şık Ekle ",-1)])],8,Le)]),(a(!0),d($,null,S(o.options,(u,p)=>(a(),d("div",{key:p,class:"flex items-start gap-3 rounded-lg border border-border bg-background p-3"},[t("div",Fe,[t("div",Re,[t("span",Oe,g(String.fromCharCode(65+p)),1),b(t("input",{type:"text","onUpdate:modelValue":C=>u.option_text=C,placeholder:`Şık ${p+1} metni`,class:x(["flex-1 rounded-md border border-input bg-background px-3 py-1.5 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",{"border-destructive focus-visible:ring-destructive":i.value[`questions.${n}.options.${p}.option_text`]||r(s).errors[`questions.${n}.options.${p}.option_text`]}])},null,10,Ne),[[m,u.option_text]])])]),t("div",Ge,[t("label",He,[t("input",{type:"radio",name:`question-${n}-correct`,checked:u.is_correct,onChange:C=>K(n,p),class:"h-4 w-4 cursor-pointer text-primary focus:ring-primary"},null,40,Ke),e[26]||(e[26]=t("span",{class:"text-xs text-muted-foreground"},"Doğru",-1))]),o.options.length>2?(a(),d("button",{key:0,type:"button",onClick:C=>H(n,p),class:"inline-flex h-8 w-8 items-center justify-center rounded-md text-destructive hover:bg-destructive/10"},[...e[27]||(e[27]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Pe)):f("",!0)])]))),128)),i.value[`questions.${n}.options`]||r(s).errors[`questions.${n}.options`]?(a(),d("p",Qe,g(i.value[`questions.${n}.options`]||r(s).errors[`questions.${n}.options`]),1)):f("",!0)])])]))),128))]),t("div",Ye,[t("button",{type:"submit",disabled:r(s).processing,class:"inline-flex h-11 items-center justify-center rounded-md bg-primary px-8 text-sm font-medium text-primary-foreground hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-50"},[r(s).processing?(a(),d("span",We,"Güncelleniyor...")):(a(),d("span",Xe,"Testi Güncelle"))],8,Je),I(r(te),{href:`/tests/${c.value.slug}`,class:"inline-flex h-11 items-center justify-center rounded-md border border-input bg-background px-8 text-sm font-medium text-foreground hover:bg-accent hover:text-accent-foreground"},{default:ee(()=>[...e[28]||(e[28]=[q(" İptal ",-1)])]),_:1},8,["href"])])],32)]))}};export{et as default};
