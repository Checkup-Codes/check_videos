const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/main-ke3Rw64X.js","assets/index-D4FwLHOa.js","assets/ssr-COJdwiSz.js","assets/ssr-BhXL_LJh.css","assets/index-Bioxc9UI.js","assets/client-DbSAFnA0.js"])))=>i.map(i=>d[i]);
import{a as y}from"./app-B0sKWreZ.js";import{Q as j,g as n,y as V,s as H,b as K,c as b,j as T,a as m,u as $,k as Q,t as U,C as I,o as k}from"./ssr-COJdwiSz.js";const q={class:"relative h-full w-full"},G={key:0,class:"absolute left-32 top-[53px] z-10 lg:left-36 lg:top-4"},X={key:1,class:"absolute left-32 top-[101px] z-20 rounded-lg border border-green-300 bg-green-100 px-3 py-2 text-sm text-green-800 shadow-lg lg:left-36 lg:top-16"},te={__name:"ExcalidrawComponent",setup(Y,{expose:M}){var O,N;const{props:r}=j(),o=n([]),u=n({}),f=n(""),l=n(((O=r.write)==null?void 0:O.writeDraws)||((N=r.write)==null?void 0:N.write_draws)||[]),_=n(null),d=n(null),h=n(null),c=n(!1),g=n(document.documentElement.getAttribute("data-theme")==="dark");V(g,t=>{_.value&&_.value.updateScene({theme:t?"dark":"light"})}),V(()=>r.write,t=>{if(t){const e=t.writeDraws||t.write_draws||[];e.length>0&&l.value.length===0&&(l.value=e,x())}},{deep:!0}),H(()=>{const t=new MutationObserver(e=>{e.forEach(a=>{a.attributeName==="data-theme"&&(g.value=document.documentElement.getAttribute("data-theme")==="dark")})});return t.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),x(),()=>t.disconnect()});const x=()=>{y(async()=>{const{Excalidraw:t}=await import("./main-ke3Rw64X.js").then(e=>e.m);return{Excalidraw:t}},__vite__mapDeps([0,1,2,3,4])).then(({Excalidraw:t})=>{y(()=>import("./index-D4FwLHOa.js").then(e=>e.i),__vite__mapDeps([1,2,3])).then(e=>{y(()=>import("./client-DbSAFnA0.js").then(a=>a.c),__vite__mapDeps([5,4,1,2,3])).then(a=>{var J,D,A;const s=document.getElementById("excali");if(!s)return;const B=a.createRoot(s),i=l.value||[],S=i.length>0&&((J=i[0])!=null&&J.elements)?JSON.parse(i[0].elements):[];let p={};if(i.length>0&&((D=i[0])!=null&&D.files))try{p=JSON.parse(i[0].files)}catch(v){console.warn("Files parse error:",v)}d.value=JSON.stringify(S),h.value=JSON.stringify(p),u.value=p;const L={elements:S,files:p,scrollToContent:!0,theme:g.value?"dark":"light"},P=(v,Z,C)=>{o.value=v,C&&(u.value=C)},z=e.createElement(t,{initialData:L,onChange:P,viewModeEnabled:!((A=r.auth)!=null&&A.user),theme:g.value?"dark":"light",onMount:v=>{_.value=v}});B.render(z)})})})},E=K(()=>{if(!d.value)return!1;const t=JSON.stringify(o.value),e=JSON.stringify(u.value);return t!==d.value||e!==h.value}),F=async()=>{if(!E.value||c.value)return Promise.resolve(!0);const t=o.value.length>0?o.value:[],e=JSON.stringify(t),a=JSON.stringify(u.value||{});c.value=!0;try{const s=await I.post(`/writes/${r.write.id}/draw`,{elements:e,files:a,version:1});return d.value=e,h.value=a,l.value.length>0?l.value[0]=s.data:l.value.push(s.data),w("Otomatik kaydedildi!"),!0}catch(s){return console.error("Auto-save failed:",s),w("Otomatik kaydetme başarısız oldu."),!1}finally{c.value=!1}},R=()=>{const t=o.value.length>0?o.value:[],e=JSON.stringify(t),a=JSON.stringify(u.value||{});c.value=!0,I.post(`/writes/${r.write.id}/draw`,{elements:e,files:a,version:1}).then(s=>{w("Canvas durumu başarıyla kaydedildi!"),d.value=e,h.value=a,l.value.length>0?l.value[0]=s.data:l.value.push(s.data)}).catch(()=>{w("Kaydetme sırasında bir hata oluştu. Lütfen tekrar deneyin.")}).finally(()=>{c.value=!1})};M({hasUnsavedChanges:E,saveIfNeeded:F});const w=t=>{f.value=t,setTimeout(()=>{f.value=""},3e3)};return(t,e)=>{var a;return k(),b("div",q,[(a=$(r).auth)!=null&&a.user?(k(),b("div",G,[m("button",{onClick:R,class:"flex items-center gap-2 rounded-lg border border-input bg-background px-3 py-2 text-sm text-foreground shadow-lg transition-all hover:bg-accent"},[...e[0]||(e[0]=[m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.5 3.75V16.5L12 14.25 7.5 16.5V3.75m9 0H18A2.25 2.25 0 0120.25 6v12A2.25 2.25 0 0118 20.25H6A2.25 2.25 0 013.75 18V6A2.25 2.25 0 016 3.75h1.5m9 0h-9"})],-1),Q(" Kaydet ",-1)])])])):T("",!0),f.value?(k(),b("div",X,U(f.value),1)):T("",!0),e[1]||(e[1]=m("div",{id:"excalidraw-container",class:"h-full w-full"},[m("div",{id:"excali",class:"h-full w-full"})],-1))])}}};export{te as _};
