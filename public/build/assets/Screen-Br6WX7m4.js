import{Q as le,p as k,e as p,T as ae,m as de,E as V,A as ue,y as W,j as ce,w as G,a as e,c as a,h as m,n as C,t as u,u as d,o as i,P as fe,l as pe,F as R,g as Q,k as J,C as ve,v as me,b as ge,i as he,f as xe}from"./ssr-DE0PqSHa.js";import{_ as we}from"./CheckScreen-DRqaTQfr.js";const be={class:"space-y-4 rounded-lg border border-border bg-card p-6"},_e={class:"flex items-center justify-between"},ye={class:"text-3xl font-bold text-foreground"},ke={key:0,class:"flex items-center gap-2 rounded-md bg-primary/10 px-4 py-2"},Ce={class:"font-mono text-lg font-semibold text-primary"},je={key:0,class:"text-muted-foreground"},Te={class:"flex flex-wrap gap-4 text-sm text-muted-foreground"},Me={class:"flex items-center gap-2"},Be={key:0,class:"flex items-center gap-2"},Se={class:"space-y-2"},Re={class:"flex items-center justify-between text-sm"},Qe={class:"font-medium text-foreground"},Ne={class:"h-2 w-full overflow-hidden rounded-full bg-muted"},$e=["id"],Le={class:"flex items-start justify-between"},ze={class:"flex-1"},Ee={class:"mb-2 flex items-center gap-2"},Ie={class:"rounded-md bg-primary px-2 py-1 text-sm font-semibold text-primary-foreground"},Ve={class:"text-sm text-muted-foreground"},Oe={class:"whitespace-pre-wrap text-lg font-medium text-foreground"},Ae={key:0,class:"ml-4 flex h-8 w-8 items-center justify-center rounded-full bg-green-500 text-white"},qe={class:"space-y-2"},He=["for"],De=["id","name","value","onUpdate:modelValue"],Ue={class:"flex-1"},Fe={class:"flex items-center gap-2"},Pe={class:"font-medium text-muted-foreground"},We={class:"whitespace-pre-wrap text-foreground"},Ge={key:0,class:"rounded-lg border border-border bg-card p-6"},Je={class:"flex gap-4"},Ke=["disabled"],Xe={key:0},Ye={key:1},Ze={class:"flex h-full flex-col"},et={class:"space-y-1"},tt=["onClick"],ot={class:"flex items-center gap-2"},st={class:"font-medium"},nt={class:"flex items-center gap-2"},rt={key:0,class:"flex h-5 w-5 items-center justify-center rounded-full bg-green-500 text-white",title:"Cevaplandı"},it={key:1,class:"flex h-5 w-5 items-center justify-center rounded-full border-2 border-muted-foreground/30",title:"Cevaplanmadı"},lt={class:"rounded-lg border border-border bg-popover shadow-lg"},at={class:"space-y-1"},dt=["onClick"],ut={class:"flex items-center gap-2"},ct={class:"font-medium"},ft={class:"flex items-center gap-2"},pt={key:0,class:"flex h-4 w-4 items-center justify-center rounded-full bg-green-500 text-white",title:"Cevaplandı"},vt={key:1,class:"flex h-4 w-4 items-center justify-center rounded-full border-2 border-muted-foreground/30",title:"Cevaplanmadı"},xt={__name:"Screen",setup(mt){const{props:N}=le(),r=N.test||{},K=k(()=>!!(N.auth&&N.auth.user)),v=p({}),$=p(""),X=p({}),Y=p(Date.now()),g=p(!1),x=k(()=>r.questions&&r.questions.length>0),w=p(null),L=p(new Map),O=p(null),A=p(null),Z=p(!1);let j=null,T=null,b=!1;const _=p(r.time_limit?r.time_limit*60:null),M=p(null),ee=k(()=>{if(!_.value)return"";const o=Math.floor(_.value/60),t=_.value%60;return`${String(o).padStart(2,"0")}:${String(t).padStart(2,"0")}`}),S=k(()=>Object.keys(v.value).filter(o=>v.value[o]!==null&&v.value[o]!==void 0).length),te=k(()=>!r.total_questions||r.total_questions===0?0:S.value/r.total_questions*100),z=k(()=>S.value>0),y=ae({answers:[],participant_name:"",time_taken:null}),oe=()=>{},se=(o,t)=>{o&&(X.value[t]=o)},q=(o,t)=>{o?L.value.set(t,o):L.value.delete(t)},B=()=>{g.value=!g.value},H=o=>{if(!o)return;const t=document.getElementById(`question-${o}`);if(!t)return;const s=t.closest(".overflow-y-auto");if(!s)return;b=!0,w.value=o,V(()=>{D()});const n=s.getBoundingClientRect(),l=t.getBoundingClientRect(),c=s.scrollTop,f=l.top-n.top+c;s.scrollTo({top:f-80,behavior:"smooth"}),setTimeout(()=>{b=!1},600),window.innerWidth<1280&&(g.value=!1)},D=()=>{if(!w.value)return;const o=L.value.get(w.value);if(!o)return;const t=window.innerWidth>=1280?A.value:O.value;if(!t)return;const s=t.getBoundingClientRect(),n=o.getBoundingClientRect(),l=n.top<s.top,c=n.bottom>s.bottom;if(l||c){t.scrollTop;const f=o.offsetTop,h=t.clientHeight,I=o.offsetHeight,ie=f-h/2+I/2;t.scrollTo({top:ie,behavior:"smooth"})}},ne=()=>{if(!r.questions||r.questions.length===0)return;const o=r.questions.map(n=>document.getElementById(`question-${n.id}`)).filter(Boolean);if(o.length===0)return;const t=80,s=()=>{if(b)return;let n=null,l=1/0;o.forEach(c=>{if(!c)return;const f=c.getBoundingClientRect(),h=f.top-t;f.top<=t+50&&f.bottom>0&&h<=50&&Math.abs(h)<l&&(l=Math.abs(h),n=c.id.replace("question-",""))}),n||o.forEach(c=>{if(!c)return;const f=c.getBoundingClientRect();if(f.top<t+200&&f.bottom>0){const h=Math.abs(f.top-t);h<l&&(l=h,n=c.id.replace("question-",""))}}),n&&w.value!==n&&(w.value=n)};j=new IntersectionObserver(()=>{b||s()},{root:null,rootMargin:`-${t+10}px 0px -60% 0px`,threshold:[0,.1,.25,.5,.75,1]}),o.forEach(n=>{n&&j.observe(n)}),T=()=>{b||s()},window.addEventListener("scroll",T,{passive:!0}),s()},U=()=>{const o=window.innerWidth>=1280;Z.value=o,o&&x.value?g.value=!0:o||(g.value=!1)},re=()=>{r.time_limit&&(M.value=setInterval(()=>{_.value>0?_.value--:(clearInterval(M.value),F(!0))},1e3))},E=()=>{M.value&&(clearInterval(M.value),M.value=null)},F=(o=!1)=>{(o||!z.value)&&o&&!z.value&&alert("Süre doldu! Test otomatik olarak gönderildi.");const t=r.questions.map(n=>({question_id:n.id,option_id:v.value[n.id]||null})),s=Math.floor((Date.now()-Y.value)/1e3);y.answers=t,y.participant_name=$.value,y.time_taken=s,y.post(route("tests.submit",r.slug),{onSuccess:()=>{E()},onError:n=>{console.error("Test submission error:",n),alert("Test gönderilirken bir hata oluştu. Lütfen tekrar deneyin.")}})};de(()=>{re(),U(),V(()=>{x.value&&ne()});const o=()=>{U()};window.addEventListener("resize",o),window.addEventListener("beforeunload",P)}),ue(()=>{E(),j&&(j.disconnect(),j=null),T&&(window.removeEventListener("scroll",T),T=null),window.removeEventListener("beforeunload",P)});const P=o=>{S.value>0&&(o.preventDefault(),o.returnValue="")};return W(()=>_.value,o=>{o===0&&E()}),W(w,(o,t)=>{o&&o!==t&&!b&&V(()=>{D()})}),(o,t)=>(i(),ce(we,null,{default:G(()=>[e("div",{class:C(["mx-auto max-w-4xl space-y-6 p-6 transition-all duration-300",{"xl:-translate-x-[100px]":x.value&&g.value}])},[e("div",be,[e("div",_e,[e("h1",ye,u(d(r).title),1),d(r).time_limit?(i(),a("div",ke,[t[1]||(t[1]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",Ce,u(ee.value),1)])):m("",!0)]),d(r).description?(i(),a("div",je,u(d(r).description),1)):m("",!0),e("div",Te,[e("div",Me,[t[2]||(t[2]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1)),e("span",null,u(d(r).total_questions)+" soru",1)]),d(r).total_points?(i(),a("div",Be,[t[3]||(t[3]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"})],-1)),e("span",null,u(d(r).total_points)+" puan",1)])):m("",!0)])]),e("div",Se,[e("div",Re,[t[4]||(t[4]=e("span",{class:"text-muted-foreground"},"İlerleme",-1)),e("span",Qe,u(S.value)+" / "+u(d(r).total_questions)+" soru cevaplandı",1)]),e("div",Ne,[e("div",{class:"h-full bg-primary transition-all duration-300",style:fe({width:`${te.value}%`})},null,4)])]),e("form",{onSubmit:pe(F,["prevent"]),class:"space-y-6"},[(i(!0),a(R,null,Q(d(r).questions,(s,n)=>(i(),a("div",{key:s.id,id:`question-${s.id}`,ref_for:!0,ref:l=>se(l,s.id),class:"space-y-4 rounded-lg border border-border bg-card p-6 scroll-mt-24"},[e("div",Le,[e("div",ze,[e("div",Ee,[e("span",Ie," Soru "+u(n+1),1),e("span",Ve,"("+u(s.points)+" puan)",1)]),e("p",Oe,u(s.question_text),1)]),v.value[s.id]?(i(),a("div",Ae,[...t[5]||(t[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])])):m("",!0)]),e("div",qe,[(i(!0),a(R,null,Q(s.options,(l,c)=>(i(),a("label",{key:l.id,for:`question-${s.id}-option-${l.id}`,class:C(["flex cursor-pointer items-start gap-3 rounded-lg border border-border bg-background p-4 transition-colors hover:bg-accent",{"border-primary bg-primary/5":v.value[s.id]===l.id,"border-border":v.value[s.id]!==l.id}])},[J(e("input",{id:`question-${s.id}-option-${l.id}`,type:"radio",name:`question-${s.id}`,value:l.id,"onUpdate:modelValue":f=>v.value[s.id]=f,class:"mt-1 h-4 w-4 cursor-pointer text-primary focus:ring-primary",onChange:oe},null,40,De),[[ve,v.value[s.id]]]),e("div",Ue,[e("div",Fe,[e("span",Pe,u(String.fromCharCode(65+c))+".",1),e("span",We,u(l.option_text),1)])])],10,He))),128))])],8,$e))),128)),K.value?m("",!0):(i(),a("div",Ge,[t[6]||(t[6]=e("label",{for:"participant_name",class:"mb-2 block text-sm font-medium text-foreground"}," Adınız (Opsiyonel) ",-1)),J(e("input",{id:"participant_name","onUpdate:modelValue":t[0]||(t[0]=s=>$.value=s),type:"text",placeholder:"İsminizi girin",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[me,$.value]])])),e("div",Je,[e("button",{type:"submit",disabled:d(y).processing||!z.value,class:"inline-flex h-11 items-center justify-center rounded-md bg-primary px-8 text-sm font-medium text-primary-foreground hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-50"},[d(y).processing?(i(),a("span",Xe,"Gönderiliyor...")):(i(),a("span",Ye,"Testi Tamamla"))],8,Ke),ge(d(he),{href:`/tests/${d(r).slug}`,class:"inline-flex h-11 items-center justify-center rounded-md border border-input bg-background px-8 text-sm font-medium text-foreground hover:bg-accent hover:text-accent-foreground"},{default:G(()=>[...t[7]||(t[7]=[xe(" İptal ",-1)])]),_:1},8,["href"])])],32)],2),x.value?(i(),a("button",{key:0,onClick:B,class:"fixed right-4 top-1/2 z-50 flex h-10 w-10 -translate-y-1/2 items-center justify-center rounded-full bg-primary text-primary-foreground shadow-lg transition-colors hover:bg-primary/90 xl:hidden"},[...t[8]||(t[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-5 w-5"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"})],-1)])])):m("",!0),x.value?(i(),a("div",{key:1,class:C(["fixed right-0 top-12 z-40 h-[calc(100vh-3rem)] w-80 transform border-l border-border bg-popover shadow-2xl transition-transform duration-300 lg:h-[calc(100vh-5.5rem)] xl:hidden",{"translate-x-full":!g.value}])},[e("div",Ze,[e("div",{class:"flex items-center justify-between border-b border-border p-4"},[t[10]||(t[10]=e("h3",{class:"text-lg font-semibold text-foreground"},"Sorular",-1)),e("button",{onClick:B,class:"inline-flex h-8 w-8 items-center justify-center rounded-md text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"},[...t[9]||(t[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",{ref_key:"mobileQuestionNavScrollRef",ref:O,class:"flex-1 overflow-y-auto p-4"},[e("nav",et,[(i(!0),a(R,null,Q(d(r).questions,(s,n)=>(i(),a("button",{key:s.id,ref_for:!0,ref:l=>q(l,s.id),onClick:l=>H(s.id),class:C(["flex w-full items-center justify-between rounded-md px-3 py-2 text-sm transition-colors",[w.value===s.id?"bg-accent font-medium text-accent-foreground":"text-muted-foreground hover:bg-accent/50 hover:text-foreground"]])},[e("div",ot,[e("span",st,"Soru "+u(n+1),1)]),e("div",nt,[v.value[s.id]?(i(),a("span",rt,[...t[11]||(t[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])])):(i(),a("span",it))])],10,tt))),128))])],512)])],2)):m("",!0),x.value?(i(),a("button",{key:2,onClick:B,class:"fixed right-4 top-28 z-50 hidden h-10 w-10 items-center justify-center rounded-full bg-primary text-primary-foreground shadow-lg transition-colors hover:bg-primary/90 xl:flex"},[...t[12]||(t[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-5 w-5"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"})],-1)])])):m("",!0),x.value?(i(),a("div",{key:3,class:C(["fixed right-4 top-28 z-30 hidden w-64 transition-all duration-300 ease-in-out xl:block",g.value?"translate-x-0 opacity-100":"pointer-events-none translate-x-full opacity-0"])},[e("div",lt,[e("div",{class:"flex items-center justify-between border-b border-border p-3"},[t[14]||(t[14]=e("h3",{class:"text-sm font-semibold text-foreground"},"Sorular",-1)),e("button",{onClick:B,class:"inline-flex h-6 w-6 items-center justify-center rounded-md text-xs font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"},[...t[13]||(t[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",{ref_key:"desktopQuestionNavScrollRef",ref:A,class:"overflow-y-auto p-3",style:{"max-height":"calc(100vh - 220px)"}},[e("nav",at,[(i(!0),a(R,null,Q(d(r).questions,(s,n)=>(i(),a("button",{key:s.id,ref_for:!0,ref:l=>q(l,s.id),onClick:l=>H(s.id),class:C(["flex w-full items-center justify-between rounded-md px-2 py-1.5 text-xs transition-colors",[w.value===s.id?"bg-accent font-medium text-accent-foreground":"text-muted-foreground hover:bg-accent/50 hover:text-foreground"]])},[e("div",ut,[e("span",ct,"Soru "+u(n+1),1)]),e("div",ft,[v.value[s.id]?(i(),a("span",pt,[...t[15]||(t[15]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-2.5 w-2.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])])):(i(),a("span",vt))])],10,dt))),128))])],512)])],2)):m("",!0),x.value&&g.value?(i(),a("div",{key:4,onClick:B,class:"fixed inset-0 z-30 bg-black/20 xl:hidden"})):m("",!0)]),_:1}))}};export{xt as default};
