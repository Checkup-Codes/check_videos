import{Q as re,e as c,p as D,T as oe,y as $,m as ne,A as ie,c as f,a as r,h as m,n as L,u as l,t as b,k as le,v as ae,J as ue,F as de,g as ce,f as F,l as fe,N as ve,o as v,D as z}from"./ssr-B6-2V9vM.js";const ge={class:"space-y-4 py-6"},pe={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},me=["value"],be={key:0,class:"mt-1 text-xs text-destructive"},he=["value"],xe={key:0,class:"mt-1 text-xs text-destructive"},we={class:"mb-1 flex items-center gap-2"},ke={key:0,class:"flex items-center gap-1.5"},ye={class:"text-sm text-foreground"},_e={key:0,class:"text-xs text-muted-foreground"},Ce={class:"relative w-full"},Ee={key:0,class:"absolute z-30 mt-1 w-full rounded-md border border-border bg-popover shadow-lg"},Se={class:"max-h-60 w-full overflow-y-auto p-1"},Le=["onMousedown"],je={class:"flex flex-col gap-0.5"},Me={class:"font-medium"},Pe={key:0,class:"text-xs text-muted-foreground"},Fe={key:0,class:"mt-1 text-xs text-destructive"},ze=["value"],Re={key:0,class:"mt-1 text-xs text-destructive"},Be={class:"flex justify-end gap-2 pt-2"},Ie=["disabled"],Te=["disabled"],Ae={key:0,class:"mr-2 h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ne=Object.assign({name:"CategoriesEditFrom"},{__name:"CategoriesEditFrom",setup(Ke){var H,N;const G=t=>{const e=[],o=new Set,p=u=>{!u||!Array.isArray(u)||u.forEach(i=>{i&&i.id&&!o.has(i.id)&&(o.add(i.id),e.push(i),i.children&&Array.isArray(i.children)&&i.children.length>0&&p(i.children))})};return p(t),e},{props:_}=re(),C=c(_.categories||[]),g=D(()=>G(C.value)),h=c(_.category||{}),s=oe({name:h.value.name||"",slug:h.value.slug||"",parent_id:h.value.parent_id||null,status:h.value.status||"public"});s.processing=!1;const R=c(null),B=c(null),I=c(null),T=c(null),a=c({name:"",slug:"",parent_id:"",status:""}),x=c(((H=_.category.parent)==null?void 0:H.name)||""),E=c(((N=_.category.parent)==null?void 0:N.name)||""),w=c(!1),A=c(!1),K=c(null),y=t=>{if(!t||!g.value||g.value.length===0)return"";const e=u=>g.value.find(i=>i.id===u),o=(u,i=[])=>{const n=e(u);return n?(i.unshift(n.name),n.parent_id?o(n.parent_id,i):i):i},p=o(t);return p.length>1?p.slice(0,-1).join(" > "):""},j=t=>{if(!t||!g.value||g.value.length===0)return"";const e=u=>g.value.find(i=>i.id===u),o=(u,i=[])=>{const n=e(u);return n?(i.unshift(n.name),n.parent_id?o(n.parent_id,i):i):i};return o(t).join(" > ")},M=D(()=>{if(!g.value||g.value.length===0)return[];const t=(n,k=new Set)=>(g.value.filter(d=>d.parent_id===n).forEach(d=>{k.add(d.id),t(d.id,k)}),k),e=new Set([h.value.id]);t(h.value.id).forEach(n=>e.add(n));let p=g.value.filter(n=>n&&n.id&&!e.has(n.id));if(x.value){const n=x.value.toLowerCase(),k=[],P=new Set;return p.forEach(d=>{if(!d||!d.name||P.has(d.id))return;const ee=d.name.toLowerCase().includes(n),te=y(d.id).toLowerCase().includes(n),se=j(d.id).toLowerCase().includes(n);(ee||te||se)&&(P.add(d.id),k.push(d))}),k}const u=[],i=new Set;return p.forEach(n=>{n&&n.id&&!i.has(n.id)&&(i.add(n.id),u.push(n))}),u}),O=()=>{Object.keys(a.value).forEach(e=>{a.value[e]=""});let t=!1;return(!s.name||s.name.trim()==="")&&(a.value.name="İsim zorunludur.",t=!0),(!s.slug||s.slug.trim()==="")&&(a.value.slug="Slug zorunludur.",t=!0),t&&V(),t},V=()=>{z(()=>{const t=[{ref:R,error:a.value.name},{ref:B,error:a.value.slug},{ref:I,error:a.value.parent_id},{ref:T,error:a.value.status}];for(const e of t)if(e.error&&e.ref.value){e.ref.value.scrollIntoView({behavior:"smooth",block:"center"}),z(()=>{const o=e.ref.value.querySelector("input, select");o&&o.focus()});break}})};$(()=>s.name,t=>{t&&(s.slug=t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""))});let S=null;ne(()=>{if(s.processing=!1,(!C.value||C.value.length===0)&&Y(),s.parent_id){const t=g.value.find(e=>e.id===s.parent_id);if(t){const e=j(t.id);x.value=e,E.value=t.name}}document.addEventListener("keydown",t=>{t.key==="Escape"&&(w.value=!1)}),S=()=>{q()},window.addEventListener("sidebarFormSubmit",S)}),ie(()=>{S&&window.removeEventListener("sidebarFormSubmit",S)}),$(()=>s.processing,t=>{window.dispatchEvent(new CustomEvent("formProcessingState",{detail:{processing:t}}))});const U=()=>{clearTimeout(K.value),M.value.length>0&&(w.value=!0)},X=()=>{K.value=setTimeout(()=>{w.value=!1},100)},J=()=>{s.parent_id="",x.value.length>=1&&(w.value=!0)},Q=t=>{if(!t||!t.id)return;s.parent_id=t.id,E.value=t.name;const e=j(t.id);x.value=e,z(()=>{w.value=!1})},W=()=>{s.parent_id="",x.value="",E.value=""},q=()=>{O()||s.put(route("categories.update",{category:h.value.id}),{onSuccess:()=>{ve.visit(route("categories.index"))},onError:e=>{Object.assign(a.value,e),V()}})},Y=async()=>{A.value=!0;try{const t=await fetch(route("categories.index"),{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error("Failed to fetch categories");const e=await t.json();C.value=e.categories||[]}catch(t){console.error("Error fetching categories:",t)}finally{A.value=!1}},Z=t=>{confirm("Bu kategoriyi silmek istediğinize emin misiniz?")&&s.delete(route("categories.destroy",{category:t})).then(()=>{console.log("Kategori başarıyla silindi")}).catch(e=>{console.error("Kategori silinirken hata:",e)})};return(t,e)=>(v(),f("div",ge,[r("form",{onSubmit:fe(q,["prevent"]),class:"space-y-4"},[r("div",pe,[r("div",{class:"md:col-span-2",ref_key:"nameRef",ref:R},[r("div",null,[e[6]||(e[6]=r("label",{class:"mb-1 block text-sm font-medium text-foreground"},"İsim",-1)),r("input",{type:"text",value:l(s).name,onInput:e[0]||(e[0]=o=>l(s).name=o.target.value),placeholder:"Kategori ismi",class:L(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":a.value.name||l(s).errors.name}])},null,42,me),a.value.name||l(s).errors.name?(v(),f("p",be,b(a.value.name||l(s).errors.name),1)):m("",!0)])],512),r("div",{ref_key:"slugRef",ref:B},[e[7]||(e[7]=r("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Slug",-1)),r("input",{type:"text",value:l(s).slug,onInput:e[1]||(e[1]=o=>l(s).slug=o.target.value),placeholder:"kategori-slug",class:L(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":a.value.slug||l(s).errors.slug}])},null,42,he),a.value.slug||l(s).errors.slug?(v(),f("p",xe,b(a.value.slug||l(s).errors.slug),1)):m("",!0)],512),r("div",{ref_key:"parentIdRef",ref:I},[r("div",we,[e[10]||(e[10]=r("label",{class:"text-sm font-medium text-foreground"},"Üst Kategori",-1)),l(s).parent_id?(v(),f("div",ke,[e[9]||(e[9]=r("span",{class:"text-xs text-muted-foreground"},":",-1)),r("span",ye,b(E.value),1),y(l(s).parent_id)?(v(),f("span",_e," ("+b(y(l(s).parent_id))+") ",1)):m("",!0),r("button",{type:"button",onClick:W,class:"flex h-4 w-4 items-center justify-center rounded text-muted-foreground transition-colors hover:text-destructive","aria-label":"Kaldır"},[...e[8]||(e[8]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):m("",!0)]),r("div",Ce,[le(r("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=o=>x.value=o),onFocus:U,onBlur:X,onInput:J,onKeydown:e[3]||(e[3]=ue(o=>w.value=!1,["esc"])),placeholder:"Üst kategori ara (opsiyonel)",class:L(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":a.value.parent_id||l(s).errors.parent_id}])},null,34),[[ae,x.value]]),w.value&&M.value.length>0?(v(),f("div",Ee,[r("ul",Se,[(v(!0),f(de,null,ce(M.value,o=>(v(),f("li",{key:o.id,onMousedown:p=>Q(o),class:"cursor-pointer rounded-sm px-2 py-1.5 text-sm text-popover-foreground transition-colors hover:bg-accent hover:text-accent-foreground"},[r("div",je,[r("span",Me,b(o.name),1),y(o.id)?(v(),f("span",Pe,[e[11]||(e[11]=r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mr-1 inline h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1)),F(" "+b(y(o.id)),1)])):m("",!0)])],40,Le))),128))])])):m("",!0)]),a.value.parent_id||l(s).errors.parent_id?(v(),f("p",Fe,b(a.value.parent_id||l(s).errors.parent_id),1)):m("",!0)],512),r("div",{ref_key:"statusRef",ref:T},[e[13]||(e[13]=r("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Durum",-1)),r("select",{value:l(s).status,onChange:e[4]||(e[4]=o=>l(s).status=o.target.value),class:L(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":a.value.status||l(s).errors.status}])},[...e[12]||(e[12]=[r("option",{value:"public"},"Açık",-1),r("option",{value:"hidden"},"Gizli",-1)])],42,ze),a.value.status||l(s).errors.status?(v(),f("p",Re,b(a.value.status||l(s).errors.status),1)):m("",!0)],512)]),r("div",Be,[r("button",{type:"button",onClick:e[5]||(e[5]=o=>Z(h.value.id)),class:"inline-flex h-9 items-center justify-center gap-1.5 rounded-md border border-destructive bg-background px-4 text-sm font-medium text-destructive ring-offset-background transition-colors hover:bg-destructive hover:text-destructive-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-destructive focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",disabled:l(s).processing},[...e[14]||(e[14]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})],-1),F(" Sil ",-1)])],8,Ie),r("button",{type:"submit",class:"inline-flex h-9 items-center justify-center rounded-md bg-primary px-4 text-sm font-medium text-primary-foreground ring-offset-background transition-colors hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",disabled:l(s).processing},[l(s).processing?(v(),f("svg",Ae,[...e[15]||(e[15]=[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):m("",!0),F(" "+b(l(s).processing?"Güncelleniyor...":"Kategoriyi Güncelle"),1)],8,Te)])],32)]))}});export{Ne as default};
