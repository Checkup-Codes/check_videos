const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/main-BCtVwZDT.js","assets/index-Dvt4-oZF.js","assets/ssr-DHg8KZh6.js","assets/ssr-BC8Sc59N.css","assets/index-BETuJlOM.js","assets/client-CQFry5TX.js"])))=>i.map(i=>d[i]);
import{a as _}from"./app-VE349D2Y.js";import{Q as M,g as n,y as F,s as R,b as B,c as y,j as O,a as v,u as L,k as P,t as z,C as N,o as b}from"./ssr-DHg8KZh6.js";const j={class:"relative h-full w-full"},H={key:0,class:"absolute left-32 top-[53px] z-10 lg:left-36 lg:top-4"},K={key:1,class:"absolute left-32 top-[101px] z-20 rounded-lg border border-green-300 bg-green-100 px-3 py-2 text-sm text-green-800 shadow-lg lg:left-36 lg:top-16"},G={__name:"ExcalidrawComponent",setup($,{expose:S}){const{props:o}=M(),r=n([]),i=n({}),m=n(""),a=n(o.write.write_draws),w=n(null),u=n(null),f=n(null),c=n(!1),h=n(document.documentElement.getAttribute("data-theme")==="dark");F(h,t=>{w.value&&w.value.updateScene({theme:t?"dark":"light"})}),R(()=>{const t=new MutationObserver(e=>{e.forEach(s=>{s.attributeName==="data-theme"&&(h.value=document.documentElement.getAttribute("data-theme")==="dark")})});return t.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),J(),()=>t.disconnect()});const J=()=>{_(async()=>{const{Excalidraw:t}=await import("./main-BCtVwZDT.js").then(e=>e.m);return{Excalidraw:t}},__vite__mapDeps([0,1,2,3,4])).then(({Excalidraw:t})=>{_(()=>import("./index-Dvt4-oZF.js").then(e=>e.i),__vite__mapDeps([1,2,3])).then(e=>{_(()=>import("./client-CQFry5TX.js").then(s=>s.c),__vite__mapDeps([5,4,1,2,3])).then(s=>{const l=document.getElementById("excali"),V=s.createRoot(l),x=a.value.length>0?JSON.parse(a.value[0].elements):[];let p={};if(a.value.length>0&&a.value[0].files)try{p=JSON.parse(a.value[0].files)}catch(d){console.warn("Files parse error:",d)}u.value=JSON.stringify(x),f.value=JSON.stringify(p),i.value=p;const D={elements:x,files:p,scrollToContent:!0,theme:h.value?"dark":"light"},T=(d,Q,E)=>{r.value=d,E&&(i.value=E)},I=e.createElement(t,{initialData:D,onChange:T,viewModeEnabled:!o.auth.user,theme:h.value?"dark":"light",onMount:d=>{w.value=d}});V.render(I)})})})},k=B(()=>{if(!u.value)return!1;const t=JSON.stringify(r.value),e=JSON.stringify(i.value);return t!==u.value||e!==f.value}),A=async()=>{if(!k.value||c.value)return Promise.resolve(!0);const t=r.value.length>0?r.value:[],e=JSON.stringify(t),s=JSON.stringify(i.value||{});c.value=!0;try{const l=await N.post(`/writes/${o.write.id}/draw`,{elements:e,files:s,version:1});return u.value=e,f.value=s,a.value.length>0?a.value[0]=l.data:a.value.push(l.data),g("Otomatik kaydedildi!"),!0}catch(l){return console.error("Auto-save failed:",l),g("Otomatik kaydetme başarısız oldu."),!1}finally{c.value=!1}},C=()=>{const t=r.value.length>0?r.value:[],e=JSON.stringify(t),s=JSON.stringify(i.value||{});c.value=!0,N.post(`/writes/${o.write.id}/draw`,{elements:e,files:s,version:1}).then(l=>{g("Canvas durumu başarıyla kaydedildi!"),u.value=e,f.value=s,a.value.length>0?a.value[0]=l.data:a.value.push(l.data)}).catch(()=>{g("Kaydetme sırasında bir hata oluştu. Lütfen tekrar deneyin.")}).finally(()=>{c.value=!1})};S({hasUnsavedChanges:k,saveIfNeeded:A});const g=t=>{m.value=t,setTimeout(()=>{m.value=""},3e3)};return(t,e)=>(b(),y("div",j,[L(o).auth.user?(b(),y("div",H,[v("button",{onClick:C,class:"flex items-center gap-2 rounded-lg border border-input bg-background px-3 py-2 text-sm text-foreground shadow-lg transition-all hover:bg-accent"},[...e[0]||(e[0]=[v("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[v("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.5 3.75V16.5L12 14.25 7.5 16.5V3.75m9 0H18A2.25 2.25 0 0120.25 6v12A2.25 2.25 0 0118 20.25H6A2.25 2.25 0 013.75 18V6A2.25 2.25 0 016 3.75h1.5m9 0h-9"})],-1),P(" Kaydet ",-1)])])])):O("",!0),m.value?(b(),y("div",K,z(m.value),1)):O("",!0),e[1]||(e[1]=v("div",{id:"excalidraw-container",class:"h-full w-full"},[v("div",{id:"excali",class:"h-full w-full"})],-1))]))}};export{G as _};
