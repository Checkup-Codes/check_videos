import{Q as B,g as f,y as w,B as G,b as t,s as J,N as T,z as X,c as Y,f as I,u as Z,w as N,a as ee,n as te,r as se,e as D,j as re,o as _,L as ae,a0 as ie,F as oe,M as x}from"./ssr-C_PJoyLf.js";import{_ as ne}from"./CheckLayout-CEtGr_mj.js";import le from"./SidebarLayoutWrite-BvRc6xv3.js";import ue from"./SidebarLayoutCategory-BhqzDmDY.js";import{_ as ce}from"./FlashMessage-BiyPC9ai.js";import{u as de}from"./useSidebar-Ds29qMk8.js";import"./WriteList-BUIYXJor.js";import"./IconCalendar-CzCgGzmK.js";import"./IconEye-Ddd3xyIy.js";import"./IconLock-D87Tg8v8.js";import"./IconLink-b8uRG4C0.js";import"./app-C7nLCr5l.js";/* empty css            */import"./SubSidebarScreen-CzcMcv1u.js";import"./IconMenu-w9Doi-es.js";import"./IconFolder-CeGlvuhW.js";import"./IconX-BJPDyKg8.js";import"./IconFilter-CvET5Hcx.js";import"./CategoryTree-CXKiBQU1.js";import"./IconChevronDown-COGnZsF3.js";function pe(){var u;const{props:h}=B(),l=f(((u=h.flash)==null?void 0:u.success)||"");return w(()=>{var r;return(r=h.flash)==null?void 0:r.success},r=>{r?l.value=r:l.value=""}),{flashMessage:l}}const xe=Object.assign({name:"LayoutWritesCategories"},{__name:"LayoutWritesCategories",setup(h){const{isCollapsed:l}=de(),{flashMessage:u}=pe(),r=G(),b=f(typeof window<"u"?window.innerWidth:1024),L=t(()=>b.value<1024),k=()=>{typeof window<"u"&&(b.value=window.innerWidth)},E=()=>{u.value=""},a=B(),C=t(()=>{var e;return((e=a.props.screen)==null?void 0:e.name)||"writes"}),F={writes:le,categories:ue},z=t(()=>!!(a.props.auth&&a.props.auth.user)),M=t(()=>{const e=a.url||"",s=e.startsWith("/writes/")&&e!=="/writes"&&!e.includes("/writes/create")&&!e.includes("/writes/edit"),i=e==="/writes/create"||e.includes("/writes/edit"),n=e.startsWith("/categories/")&&e!=="/categories"&&!e.includes("/categories/create")&&!e.includes("/categories/edit"),g=e==="/categories/create"||e.includes("/categories/edit");return s||i||n||g}),o=t(()=>{if(z.value)return!1;const e=a.url||"",s=e.includes("/writes/")&&!e.includes("/writes/create")&&!e.includes("/writes/edit"),i=e.includes("/categories/")&&!e.includes("/categories/create")&&!e.includes("/categories/edit");if(s||i){const n=a.props.write;if(n&&n.status==="link_only")return!0}return!1}),p=t(()=>L.value?!M.value:!0),P=t(()=>L.value?M.value:!0),O=t(()=>l.value&&C.value&&!o.value&&p.value&&F[C.value]||null),m=f(r.getters["Writes/isCollapsed"]);w(()=>r.getters["Writes/isCollapsed"],e=>{m.value=e},{immediate:!0});const R=t(()=>({"transition-all duration-300":!0,"lg:ml-[-200px]":m.value&&!o.value,"lg:ml-[00px]":!m.value&&!o.value,"lg:ml-0":o.value})),$=e=>{m.value=e},v=f(!1);let W=null;J(()=>{v.value=!0,document.body.style.overflow="hidden",typeof window<"u"&&(b.value=window.innerWidth,window.addEventListener("resize",k)),W=T.on("success",e=>{var n,g;const s=a.props.flash,i=e.detail.page.url||"";if(s!=null&&s.success&&(i.includes("/writes")||i.includes("/categories"))){const Q=i.includes("/create"),q=i.includes("/edit");!Q&&!q&&r.dispatch("Writes/invalidateAndReload",{currentUserId:((g=(n=a.props.auth)==null?void 0:n.user)==null?void 0:g.id)||null})}})}),X(()=>{document.body.style.overflow="",typeof window<"u"&&window.removeEventListener("resize",k),W&&W()});const c=t(()=>a.props.categories||[]),d=t(()=>a.props.writes||[]),U=t(()=>{var e,s;return((s=(e=a.props.auth)==null?void 0:e.user)==null?void 0:s.id)||null}),y=t(()=>r.getters["Writes/writes"]),S=t(()=>r.getters["Writes/categories"]),j=t(()=>r.getters["Writes/sidebarDataLoaded"]),A=t(()=>r.getters["Writes/lastUserId"]),V=t(()=>S.value&&S.value.length>0?S.value:c.value&&c.value.length>0?c.value:[]),H=t(()=>y.value&&y.value.length>0?y.value:d.value&&d.value.length>0?d.value:[]);x("categories",V),x("writes",H);const K=async()=>{const e=U.value,s=e!==A.value;if(c.value.length>0||d.value.length>0){r.dispatch("Writes/setSidebarDataFromProps",{writes:d.value,categories:c.value,currentUserId:e});return}(!j.value||s)&&await r.dispatch("Writes/loadSidebarData",{currentUserId:e})};return w([v,p,o],([e,s,i])=>{e&&s&&!i&&K()},{immediate:!0}),w(U,(e,s)=>{e!==s&&v.value&&r.dispatch("Writes/loadSidebarData",{forceRefresh:!0,currentUserId:e})}),(e,s)=>(_(),Y(oe,null,[I(ce,{message:Z(u),onClose:E},null,8,["message"]),I(ne,{isCollapsed:!o.value,"show-sidebar-on-mobile":p.value,"show-main-content-on-mobile":P.value},{sidebar:N(()=>[p.value&&!o.value&&v.value?(_(),D(ae,{key:0,max:5,include:["SidebarLayoutWrite","SidebarLayoutCategory"]},[(_(),D(ie(O.value),{key:C.value,"onUpdate:isNarrow":$},null,32))],1024)):re("",!0)]),default:N(()=>[ee("div",{class:te([P.value?"block":"hidden lg:block",R.value])},[se(e.$slots,"screen")],2)]),_:3},8,["isCollapsed","show-sidebar-on-mobile","show-main-content-on-mobile"])],64))}});export{xe as default};
