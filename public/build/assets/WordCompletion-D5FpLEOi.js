import{Q as ue,p as h,r as x,m as de,z as ge,c as l,o as i,a as n,t as c,F as p,g as k,h as L,n as A,f as U,S as ve,U as me,N as fe,K as N}from"./ssr-DzRk3HnO.js";import{g as y}from"./index-D3jsOSc0.js";import{_ as he}from"./app-CJ9FyM0q.js";const m=I=>(ve("data-v-1fc7e809"),I=I(),me(),I),xe={class:"flex flex-col items-center justify-center"},pe={key:0,class:"game-summary w-full max-w-md rounded-2xl border border-gray-200 bg-white px-6 shadow-sm"},ye=m(()=>n("h2",{class:"mb-2 text-2xl font-semibold text-gray-900"},"Test Özeti",-1)),we={class:"mb-4 text-center"},_e={class:"text-4xl font-bold text-gray-900"},be=m(()=>n("p",{class:"text-sm text-gray-600"},"Puan",-1)),ke={class:"mb-4 grid grid-cols-2 gap-4 rounded-lg bg-gray-50 p-4"},Le={class:"text-center"},Ie={class:"text-2xl font-bold text-green-600"},Ce=m(()=>n("p",{class:"text-sm text-gray-600"},"Doğru",-1)),Ae={class:"text-center"},Pe={class:"text-2xl font-bold text-red-600"},Se=m(()=>n("p",{class:"text-sm text-gray-600"},"Yanlış",-1)),Qe={class:"mb-4 text-center"},je={class:"text-3xl font-bold text-blue-600"},Me=m(()=>n("p",{class:"text-sm text-gray-600"},"Toplam Puan",-1)),Ue={class:"mb-4 max-h-60 overflow-y-auto"},ze=m(()=>n("h3",{class:"mb-2 font-medium text-gray-700"},"Cevaplarınız:",-1)),He={class:"space-y-2 text-left text-sm text-gray-800"},Re={class:"flex flex-col"},Be={class:"text-xs text-gray-500"},Te={key:0,class:"text-xs text-blue-600"},De={class:"space-y-2"},Ee={key:1,disabled:"",class:"w-full rounded-lg bg-blue-400 px-4 py-2 text-center text-sm font-medium text-white"},Ke={class:"flex gap-2"},$e={class:"relative mb-4 h-1 w-full overflow-hidden rounded-full bg-gray-200"},qe={class:"mb-4 flex items-center justify-between text-sm text-gray-500"},Ge={class:"flex flex-col items-end gap-1"},Ne={class:"flex items-center gap-2"},We={class:"font-medium text-blue-600"},Fe=m(()=>n("span",null,"toplam puan",-1)),Oe={class:"flex items-center gap-2 text-xs"},Ve={class:"font-medium text-gray-600"},Ye=m(()=>n("span",null,"mevcut soru puanı",-1)),Je=m(()=>n("div",{class:"flex items-center justify-between"},[n("h2",{class:"text-xl font-semibold text-gray-900"},"Eksik harfleri tamamlayın:")],-1)),Xe={class:"mt-1 text-sm text-gray-500"},Ze={class:"space-y-2"},et={key:0,class:"flex justify-center space-x-2"},tt=["disabled"],st={key:1,class:"mt-4"},nt={class:"flex flex-col gap-1 rounded-lg border border-gray-200 bg-gray-100 p-2"},rt={class:"flex gap-1"},at=["onClick"],ot={class:"flex gap-1"},lt=["onClick"],it={class:"flex gap-1"},ct=["onClick"],ut=m(()=>n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[n("path",{d:"M10 2a8 8 0 100 16 8 8 0 000-16zm0 14a6 6 0 110-12 6 6 0 010 12zm-1-5a1 1 0 011-1h2a1 1 0 110 2h-2a1 1 0 01-1-1zm0-4a1 1 0 011-1h2a1 1 0 110 2h-2a1 1 0 01-1-1z"})],-1)),dt=m(()=>n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[n("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)),gt={__name:"WordCompletion",props:{gameType:String,packSlug:String,words:Array,gameConfig:Object},emits:["game-completed"],setup(I,{emit:W}){const u=I,z=W,H=ue(),F=H.props.languagePacks||[],S=h(()=>{var t;return!!((t=H.props.auth)!=null&&t.user)});h(()=>u.packSlug?F.find(t=>t.slug===u.packSlug):null);const e=x({isLoading:!0,isPlaying:!1,currentQuestion:null,showAnswer:!1,isCorrect:!1,progress:0,currentIndex:0,totalQuestions:0,userResponses:[],maskedIndices:[],selectedLetters:[],hintShown:!1,currentHintIndex:0,correctAnswer:"",totalPoints:0,displayPoints:0,hintsUsed:0,hintLetterIndices:[],isHintAnimating:!1}),w=x([]),R=h(()=>Object.fromEntries(w.value.map(t=>[t.id,t]))),Q=h(()=>e.value.selectedLetters.every(t=>t!=="")),_=x(!1),P=x(!1),B=()=>{P.value=!P.value},O=()=>{const t=[...e.value.selectedLetters].reverse().findIndex((s,r)=>{const a=e.value.selectedLetters.length-1-r;return s&&!e.value.hintLetterIndices.includes(a)});if(t!==-1){const s=e.value.selectedLetters.length-1-t;e.value.selectedLetters[s]=""}},V=()=>{if(e.value.showAnswer||e.value.isHintAnimating)return;const t=K(e.value.currentQuestion.word.length);if(e.value.hintsUsed>=t){console.log("Maksimum ipucu sayısına ulaşıldı");return}const s=e.value.maskedIndices.filter((r,a)=>!e.value.selectedLetters[a]);if(s.length>0){const r=s[Math.floor(Math.random()*s.length)],a=e.value.currentQuestion.word[r].toLowerCase();e.value.isHintAnimating=!0;const o=C.value.children[r],d="abcdefghijklmnopqrstuvwxyz".split("");let v=50,g=0;const f=20,b=setInterval(()=>{o.textContent=d[Math.floor(Math.random()*d.length)],g>f*.7&&(v+=10),g++,g>=f&&(clearInterval(b),o.textContent=a,e.value.selectedLetters[r]=a,e.value.hintsUsed++,e.value.hintLetterIndices.push(r),y.to(o,{scale:1.1,duration:.2,yoyo:!0,repeat:1,onComplete:()=>{e.value.isHintAnimating=!1}}))},v)}},T=async()=>{if(!u.words||u.words.length<2){alert("Oyunu başlatmak için en az 2 kelime gereklidir.");return}e.value.isLoading=!0;let t=[...u.words];if(u.gameConfig.wordType&&(t=t.filter(s=>s.type===u.gameConfig.wordType)),u.gameConfig.learningStatus!==""&&(t=t.filter(s=>s.learning_status===parseInt(u.gameConfig.learningStatus))),u.gameConfig.difficultyLevel&&(t=t.filter(s=>s.difficulty_level===u.gameConfig.difficultyLevel)),u.gameConfig.prioritizeUnlearned){const s=t.filter(o=>o.learning_status===0),r=t.filter(o=>o.learning_status===1),a=t.filter(o=>o.learning_status===2);t=[...s,...r,...a]}u.gameConfig.prioritizeRecentlyLearned&&t.sort((s,r)=>{const a=new Date(s.last_reviewed_at||0);return new Date(r.last_reviewed_at||0)-a}),u.gameConfig.prioritizeFlagged&&t.sort((s,r)=>s.is_flagged&&!r.is_flagged?-1:!s.is_flagged&&r.is_flagged?1:0),u.gameConfig.prioritizeMostIncorrect&&t.sort((s,r)=>{const a=s.incorrect_count||0;return(r.incorrect_count||0)-a}),t=t.sort(()=>Math.random()-.5),await new Promise(s=>{w.value=t,e.value.totalQuestions=w.value.length,e.value.currentIndex=0,e.value.userResponses=[],s()}),e.value.isLoading=!1,e.value.isPlaying=!0,D()},Y=h(()=>{if(!e.value.userResponses.length)return 0;const t=e.value.userResponses.filter(s=>s.correct).length;return Math.round(t/e.value.userResponses.length*100)}),J=h(()=>{if(!e.value.currentQuestion)return 0;const s=e.value.currentQuestion.word.length*100,r=e.value.hintsUsed*100;return s-r}),X=()=>"abcçdefgğhıijklmnoöprsştuüvwxyz".split(""),Z=h(()=>e.value.userResponses.filter(t=>t.correct).length),ee=h(()=>e.value.userResponses.filter(t=>!t.correct).length),D=()=>{if(e.value.currentIndex>=w.value.length){oe();return}const t=w.value[e.value.currentIndex].word,s=t.length;console.log("Yeni soru yükleniyor:",{currentIndex:e.value.currentIndex,word:t,wordLength:s});const a={...{isLoading:e.value.isLoading,isPlaying:e.value.isPlaying,currentIndex:e.value.currentIndex,totalQuestions:e.value.totalQuestions,userResponses:e.value.userResponses,totalPoints:e.value.totalPoints,displayPoints:e.value.displayPoints},currentQuestion:w.value[e.value.currentIndex],selectedLetters:[],showAnswer:!1,hintShown:!1,currentHintIndex:0,hintsUsed:0,hintLetterIndices:[],isHintAnimating:!1,progress:0,maskedIndices:[]};e.value=a,e.value.selectedLetters=Array(s).fill(""),e.value.hintLetterIndices=[],e.value.maskedIndices=Array.from({length:s},(o,d)=>d),console.log("Yeni state:",{selectedLetters:e.value.selectedLetters,hintLetterIndices:e.value.hintLetterIndices,maskedIndices:e.value.maskedIndices}),N(()=>{console.log("DOM güncellendi, harf kutuları:",{selectedLetters:e.value.selectedLetters,hintLetterIndices:e.value.hintLetterIndices,maskedIndices:e.value.maskedIndices});const o=C.value.children;y.fromTo(o,{y:-50,opacity:0,scale:.8},{y:0,opacity:1,scale:1,duration:.5,stagger:.05,ease:"back.out(1.7)"})})},E=x(null),te=x(null),se=x(null),C=x(null),ne=t=>{const s=e.value.selectedLetters.findIndex(a=>!a);if(s===-1)return;const r=C.value.children[s];y.from(r,{scale:1.2,duration:.2,ease:"power2.out"})},j=t=>{if(e.value.showAnswer)return;const s=e.value.selectedLetters.findIndex(r=>!r);s!==-1&&(e.value.selectedLetters[s]=t.toLowerCase(),ne())},re=()=>e.value.selectedLetters.findIndex(t=>!t),K=t=>t<=3?1:t<=4?2:t<=5?3:4,$=t=>{if(e.value.showAnswer)return;const s=t.key.toLowerCase(),r=X();if(t.key==="Shift"){if(console.log("Shift tuşuna basıldı:",{selectedLetters:e.value.selectedLetters,hintLetterIndices:e.value.hintLetterIndices}),e.value.isHintAnimating)return;const a=K(e.value.currentQuestion.word.length);if(e.value.hintsUsed>=a){console.log("Maksimum ipucu sayısına ulaşıldı");return}const o=e.value.maskedIndices.filter((d,v)=>!e.value.selectedLetters[v]);if(o.length>0){const d=o[Math.floor(Math.random()*o.length)],v=e.value.currentQuestion.word[d].toLowerCase();e.value.isHintAnimating=!0;const g=C.value.children[d],f="abcdefghijklmnopqrstuvwxyz".split("");let b=50,M=0;const G=20,ce=setInterval(()=>{g.textContent=f[Math.floor(Math.random()*f.length)],M>G*.7&&(b+=10),M++,M>=G&&(clearInterval(ce),g.textContent=v,e.value.selectedLetters[d]=v,e.value.hintsUsed++,e.value.hintLetterIndices.push(d),y.to(g,{scale:1.1,duration:.2,yoyo:!0,repeat:1,onComplete:()=>{e.value.isHintAnimating=!1}}))},b)}}else if(r.includes(s)||s===" "){const a=e.value.selectedLetters.findIndex(o=>!o);a!==-1&&(e.value.selectedLetters[a]=s)}else if(t.key==="Backspace"){const a=[...e.value.selectedLetters].reverse().findIndex((o,d)=>{const v=e.value.selectedLetters.length-1-d;return o&&!e.value.hintLetterIndices.includes(v)});if(a!==-1){const o=e.value.selectedLetters.length-1-a;e.value.selectedLetters[o]=""}}else t.key==="Enter"&&Q.value&&q()},q=()=>{if(e.value.showAnswer||!Q.value)return;console.log("Cevap kontrolü öncesi:",{selectedLetters:e.value.selectedLetters,hintLetterIndices:e.value.hintLetterIndices});const t=e.value.currentQuestion.word.toLowerCase();let s=!0,r="";for(let g=0;g<e.value.maskedIndices.length;g++){const f=t[e.value.maskedIndices[g]],b=e.value.selectedLetters[g].toLowerCase();f!==b&&(s=!1),r+=f}console.log("Cevap kontrolü sonrası:",{isCorrect:s,correctAnswer:r,selectedLetters:e.value.selectedLetters,hintLetterIndices:e.value.hintLetterIndices}),e.value.isCorrect=s,e.value.correctAnswer=r;let a=0;s&&(a=t.length*100,a-=e.value.hintsUsed*100);const o=e.value.totalPoints,d=o+a;e.value.displayPoints=o,setTimeout(()=>{ae(o,d)},500),e.value.userResponses.push({word_id:e.value.currentQuestion.id,correct:s,points:a,hintsUsed:e.value.hintsUsed}),e.value.showAnswer=!0;const v=Math.round((e.value.currentIndex+1)/e.value.totalQuestions*100);y.to(E.value,{width:`${v}%`,duration:.5,ease:"power2.out"}),setTimeout(()=>{e.value.currentIndex++,D()},2e3)},ae=(t,s)=>{y.to(e.value,{displayPoints:s,duration:1,ease:"power2.out",onUpdate:()=>{e.value.totalPoints=Math.round(e.value.displayPoints)}})},oe=()=>{console.log("Oyun bitti, özet ekranı gösteriliyor"),e.value.isPlaying=!1,N(()=>{const t=document.querySelector(".game-summary");t&&y.fromTo(t,{opacity:0,y:20},{opacity:1,y:0,duration:.5,ease:"power2.out"})})},le=()=>{e.value={isLoading:!0,isPlaying:!1,currentQuestion:null,showAnswer:!1,isCorrect:!1,progress:0,currentIndex:0,totalQuestions:0,userResponses:[],maskedIndices:[],selectedLetters:[],hintShown:!1,currentHintIndex:0,correctAnswer:"",totalPoints:0,displayPoints:0,hintsUsed:0,hintLetterIndices:[],isHintAnimating:!1},T()},ie=()=>{if(!S.value||!e.value.userResponses.length||_.value)return;_.value=!0;const t=e.value.userResponses.map(s=>({word_id:s.word_id,review_count:1,incorrect_count:s.correct?0:1}));fe.post("/update-words",{words:t},{preserveState:!0,onSuccess:()=>{console.log("İstatistikler başarıyla güncellendi"),_.value=!1,setTimeout(()=>{z("game-completed")},1e3)},onError:s=>{console.error("İstatistik güncelleme hatası:",s),_.value=!1}})};return de(()=>{T(),window.addEventListener("keydown",$)}),ge(()=>{window.removeEventListener("keydown",$)}),(t,s)=>(i(),l("div",xe,[!e.value.isPlaying&&e.value.userResponses.length>0?(i(),l("div",pe,[ye,n("div",we,[n("p",_e,c(Y.value)+" / 100",1),be]),n("div",ke,[n("div",Le,[n("p",Ie,c(Z.value),1),Ce]),n("div",Ae,[n("p",Pe,c(ee.value),1),Se])]),n("div",Qe,[n("p",je,c(e.value.totalPoints),1),Me]),n("div",Ue,[ze,n("ul",He,[(i(!0),l(p,null,k(e.value.userResponses,r=>{var a,o;return i(),l("li",{key:r.word_id,class:"flex items-center justify-between rounded-md bg-gray-50 px-4 py-2"},[n("div",Re,[n("span",{class:A(r.correct?"font-medium text-green-600":"font-medium text-red-600")},c(((a=R.value[r.word_id])==null?void 0:a.word)||"Unknown"),3),n("span",Be,c(((o=R.value[r.word_id])==null?void 0:o.meaning)||""),1),r.correct?(i(),l("span",Te,c(r.points)+" puan "+c(r.hintsUsed>0?`(${r.hintsUsed} ipucu kullanıldı)`:""),1)):L("",!0)]),n("span",{class:A(r.correct?"text-lg text-green-600":"text-lg text-red-600")},c(r.correct?"✓":"✗"),3)])}),128))])]),n("div",De,[S.value&&!_.value?(i(),l("button",{key:0,onClick:ie,class:"w-full rounded-lg bg-blue-600 px-4 py-2 text-center text-sm font-medium text-white transition hover:bg-blue-700"}," Kelime İstatistiklerini Güncelle ve Pakete Dön ")):L("",!0),S.value&&_.value?(i(),l("button",Ee," Güncelleniyor... ")):L("",!0),n("div",Ke,[n("button",{onClick:s[0]||(s[0]=r=>z("game-completed")),class:"flex-1 rounded-lg bg-black px-4 py-2 text-center text-sm font-medium text-white transition hover:bg-gray-700"}," Pakete Dön "),n("button",{onClick:le,class:"flex-1 rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 transition hover:bg-gray-100"}," Tekrar Başla ")])])])):(i(),l("div",{key:1,class:A(["relative w-full max-w-md rounded-2xl border border-gray-200 p-6 shadow-sm transition-colors duration-500",{"bg-white":!e.value.showAnswer,"bg-green-50":e.value.showAnswer&&e.value.isCorrect,"bg-red-50":e.value.showAnswer&&!e.value.isCorrect}])},[n("div",$e,[n("div",{ref_key:"progressBar",ref:E,class:"h-full w-0 bg-black"},null,512),n("div",{ref_key:"progressBarGlow",ref:te,class:"absolute left-0 top-0 h-full w-[50px] bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,512)]),n("div",qe,[n("div",null,"Soru "+c(e.value.currentIndex+1)+" / "+c(e.value.totalQuestions),1),n("div",Ge,[n("div",Ne,[n("span",We,c(e.value.totalPoints),1),Fe]),n("div",Oe,[n("span",Ve,c(J.value),1),Ye])])]),e.value.currentQuestion?(i(),l("div",{key:0,class:"space-y-4",ref_key:"questionContainer",ref:se},[n("div",null,[Je,n("p",Xe,"Anlam: "+c(e.value.currentQuestion.meaning),1)]),n("div",Ze,[n("div",{class:"flex justify-center space-x-2",ref_key:"selectedLettersContainer",ref:C},[(i(!0),l(p,null,k(e.value.currentQuestion.word.split(""),(r,a)=>(i(),l("div",{key:`${e.value.currentIndex}-${a}`,class:A(["flex h-12 w-12 items-center justify-center rounded-lg border text-xl font-semibold transition-all",{"border-gray-300":!e.value.selectedLetters[a],"border-black bg-gray-50":!e.value.selectedLetters[a]&&a===re(),"border-green-500 bg-green-50":e.value.showAnswer&&e.value.isCorrect,"border-red-500 bg-red-50":e.value.showAnswer&&!e.value.isCorrect,"border-blue-500":e.value.hintLetterIndices.includes(a)&&!e.value.isHintAnimating}])},[e.value.maskedIndices.includes(a)?(i(),l("span",{key:0,class:A({"text-blue-600":e.value.hintLetterIndices.includes(a)})},c(e.value.selectedLetters[a]||""),3)):(i(),l(p,{key:1},[U(c(r.toLowerCase()),1)],64))],2))),128))],512),e.value.showAnswer&&!e.value.isCorrect?(i(),l("div",et,[(i(!0),l(p,null,k(e.value.currentQuestion.word.split(""),(r,a)=>(i(),l("div",{key:a,class:"flex h-8 w-8 items-center justify-center rounded-lg border border-green-500 bg-green-50 text-sm font-medium text-green-700"},c(r.toLowerCase()),1))),128))])):L("",!0)]),n("button",{onClick:q,disabled:e.value.showAnswer||!Q.value,class:"w-full rounded-lg bg-black px-4 py-2 text-center text-sm font-medium text-white transition hover:bg-gray-700 disabled:opacity-50"}," Kontrol Et ",8,tt)],512)):L("",!0),P.value?(i(),l("div",st,[n("div",nt,[n("div",rt,[(i(),l(p,null,k(["q","w","e","r","t","y","u","ı","o","p","ğ","ü"],r=>n("button",{key:r,onClick:a=>j(r),class:"flex h-10 w-10 items-center justify-center rounded-lg bg-white text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 active:bg-gray-100"},c(r),9,at)),64))]),n("div",ot,[(i(),l(p,null,k(["a","s","d","f","g","h","j","k","l","ş","i"],r=>n("button",{key:r,onClick:a=>j(r),class:"flex h-10 w-10 items-center justify-center rounded-lg bg-white text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 active:bg-gray-100"},c(r),9,lt)),64))]),n("div",it,[(i(),l(p,null,k(["z","x","c","v","b","n","m","ö","ç"],r=>n("button",{key:r,onClick:a=>j(r),class:"flex h-10 w-10 items-center justify-center rounded-lg bg-white text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 active:bg-gray-100"},c(r),9,ct)),64))]),n("div",{class:"flex gap-1"},[n("button",{onClick:O,class:"flex h-10 flex-1 items-center justify-center rounded-lg bg-white text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 active:bg-gray-100"}," ← "),n("button",{onClick:V,class:"flex h-10 flex-1 items-center justify-center rounded-lg bg-blue-100 text-sm font-medium text-blue-700 shadow-sm transition hover:bg-blue-200 active:bg-blue-300"}," İpucu ")])])])):L("",!0),P.value?(i(),l("button",{key:3,onClick:B,class:"mt-4 flex w-full items-center justify-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 transition hover:bg-gray-50"},[dt,U(" Klavyeyi Kapat ")])):(i(),l("button",{key:2,onClick:B,class:"mt-4 flex w-full items-center justify-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 transition hover:bg-gray-50"},[ut,U(" Klavyeyi Aç ")]))],2))]))}},ht=he(gt,[["__scopeId","data-v-1fc7e809"]]);export{ht as default};
