const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/main-9BO4IuWt.js","assets/index-Cnq-tEp4.js","assets/ssr-BIVtT62i.js","assets/ssr-CiUxchCB.css","assets/index-BzTHnC5E.js","assets/client-BmB8NrhI.js"])))=>i.map(i=>d[i]);
import{a as x}from"./app-BPwB7gnE.js";import{g as n,b as C,y as D,s as P,c as E,j as V,a as g,k as j,t as H,C as T,o as O}from"./ssr-BIVtT62i.js";const K={class:"relative h-full w-full"},$={key:0,class:"absolute left-32 top-[53px] z-10 lg:left-36 lg:top-4"},U={key:1,class:"absolute left-32 top-[101px] z-20 rounded-lg border border-green-300 bg-green-100 px-3 py-2 text-sm text-green-800 shadow-lg lg:left-36 lg:top-16"},Q={__name:"ExcalidrawComponent",props:{write:{type:Object,default:()=>({})},auth:{type:Object,default:null}},setup(I,{expose:M}){const l=I,o=n([]),c=n({}),p=n(""),b=n(null),d=n(null),w=n(null),v=n(!1),_=n(!1),y=n(document.documentElement.getAttribute("data-theme")==="dark"),k=C(()=>{var t,e;return((t=l.write)==null?void 0:t.writeDraws)||((e=l.write)==null?void 0:e.write_draws)||[]});D(y,t=>{b.value&&b.value.updateScene({theme:t?"dark":"light"})});const S=()=>{_.value||(_.value=!0,x(async()=>{const{Excalidraw:t}=await import("./main-9BO4IuWt.js").then(e=>e.m);return{Excalidraw:t}},__vite__mapDeps([0,1,2,3,4])).then(({Excalidraw:t})=>{x(()=>import("./index-Cnq-tEp4.js").then(e=>e.i),__vite__mapDeps([1,2,3])).then(e=>{x(()=>import("./client-BmB8NrhI.js").then(a=>a.c),__vite__mapDeps([5,4,1,2,3])).then(a=>{var J;const s=document.getElementById("excali");if(!s)return;const u=a.createRoot(s),r=k.value||[];let f=[],h={};if(r.length>0&&r[0]){if(r[0].elements)try{f=typeof r[0].elements=="string"?JSON.parse(r[0].elements):r[0].elements}catch(i){console.warn("Elements parse error:",i),f=[]}if(r[0].files)try{h=typeof r[0].files=="string"?JSON.parse(r[0].files):r[0].files}catch(i){console.warn("Files parse error:",i),h={}}}d.value=JSON.stringify(f),w.value=JSON.stringify(h),c.value=h,o.value=f;const R={elements:f,files:h,scrollToContent:!0,theme:y.value?"dark":"light"},B=(i,Y,A)=>{o.value=i,A&&(c.value=A)},L=e.createElement(t,{initialData:R,onChange:B,viewModeEnabled:!((J=l.auth)!=null&&J.user),theme:y.value?"dark":"light",onMount:i=>{b.value=i}});u.render(L)})})}))};D(k,t=>{t&&t.length>0&&!_.value&&S()},{deep:!0}),P(()=>{var e;const t=new MutationObserver(a=>{a.forEach(s=>{s.attributeName==="data-theme"&&(y.value=document.documentElement.getAttribute("data-theme")==="dark")})});return t.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),(k.value.length>0||(e=l.write)!=null&&e.id)&&S(),()=>t.disconnect()});const N=C(()=>{if(!d.value)return!1;const t=JSON.stringify(o.value),e=JSON.stringify(c.value);return t!==d.value||e!==w.value}),z=async()=>{var s;if(!N.value||v.value||!((s=l.write)!=null&&s.id))return Promise.resolve(!0);const t=o.value.length>0?o.value:[],e=JSON.stringify(t),a=JSON.stringify(c.value||{});v.value=!0;try{return await T.post(`/writes/${l.write.id}/draw`,{elements:e,files:a,version:1}),d.value=e,w.value=a,m("Otomatik kaydedildi!"),!0}catch(u){return console.error("Auto-save failed:",u),m("Otomatik kaydetme başarısız oldu."),!1}finally{v.value=!1}},F=()=>{var s;if(!((s=l.write)!=null&&s.id)){m("Yazı bulunamadı, kaydetme başarısız.");return}const t=o.value.length>0?o.value:[],e=JSON.stringify(t),a=JSON.stringify(c.value||{});v.value=!0,T.post(`/writes/${l.write.id}/draw`,{elements:e,files:a,version:1}).then(u=>{m("Canvas durumu başarıyla kaydedildi!"),d.value=e,w.value=a}).catch(u=>{console.error("Save error:",u),m("Kaydetme sırasında bir hata oluştu. Lütfen tekrar deneyin.")}).finally(()=>{v.value=!1})};M({hasUnsavedChanges:N,saveIfNeeded:z});const m=t=>{p.value=t,setTimeout(()=>{p.value=""},3e3)};return(t,e)=>{var a;return O(),E("div",K,[(a=l.auth)!=null&&a.user?(O(),E("div",$,[g("button",{onClick:F,class:"flex items-center gap-2 rounded-lg border border-input bg-background px-3 py-2 text-sm text-foreground shadow-lg transition-all hover:bg-accent"},[...e[0]||(e[0]=[g("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[g("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.5 3.75V16.5L12 14.25 7.5 16.5V3.75m9 0H18A2.25 2.25 0 0120.25 6v12A2.25 2.25 0 0118 20.25H6A2.25 2.25 0 013.75 18V6A2.25 2.25 0 016 3.75h1.5m9 0h-9"})],-1),j(" Kaydet ",-1)])])])):V("",!0),p.value?(O(),E("div",U,H(p.value),1)):V("",!0),e[1]||(e[1]=g("div",{id:"excalidraw-container",class:"h-full w-full"},[g("div",{id:"excali",class:"h-full w-full"})],-1))])}}};export{Q as _};
