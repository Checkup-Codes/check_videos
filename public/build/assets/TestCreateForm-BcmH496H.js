import{Q as Y,g as y,b as U,T as J,y as W,s as X,x as Z,c as d,a as t,i as p,j as f,m,u as r,n as g,t as b,v as I,G as ee,F as $,l as S,k as E,f as te,w as se,p as oe,h as re,o as a,N as ie}from"./ssr-Dzsw7L2j.js";const le={class:"space-y-6 py-6"},ne={class:"space-y-4 rounded-lg border border-border bg-card p-6"},ue={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},de={class:"md:col-span-2",ref:"titleRef"},ae={key:0,class:"mt-1 text-xs text-destructive"},ce={ref:"slugRef"},fe={key:0,class:"mt-1 text-xs text-destructive"},pe={ref:"statusRef"},be={key:0,class:"mt-1 text-xs text-destructive"},me={class:"md:col-span-2",ref:"descriptionRef"},ge={key:0,class:"mt-1 text-xs text-destructive"},ve={ref:"categoryRef"},xe={class:"relative"},he={key:1,tabindex:"0",class:"absolute z-50 mt-1 max-h-48 w-full overflow-y-auto rounded border border-border bg-popover shadow-lg"},ye=["onMousedown"],_e={key:0,class:"mt-1 text-xs text-destructive"},ke={ref:"timeLimitRef"},we={key:0,class:"mt-1 text-xs text-destructive"},Ce={ref:"publishedAtRef"},$e={class:"flex gap-2"},Se={key:0,class:"mt-1 text-xs text-destructive"},Ee={class:"space-y-4 rounded-lg border border-border bg-card p-6"},je={key:0,class:"text-sm text-muted-foreground"},Ve={class:"flex items-center justify-between"},qe={class:"text-lg font-semibold text-foreground"},Te=["onClick"],Ue={class:"space-y-4"},ze=["onUpdate:modelValue"],Be={key:0,class:"mt-1 text-xs text-destructive"},Le={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Me=["onUpdate:modelValue"],Fe=["onUpdate:modelValue"],Re={class:"space-y-3"},Ae={class:"flex items-center justify-between"},De=["onClick"],Oe={class:"flex-1 space-y-2"},Ke={class:"flex items-center gap-2"},Ne={class:"flex h-6 w-6 items-center justify-center rounded-full bg-muted text-xs font-medium text-muted-foreground"},He=["onUpdate:modelValue","placeholder"],Pe={class:"flex items-center gap-2"},Ge={class:"flex cursor-pointer items-center gap-2"},Qe=["name","checked","onChange"],Ye=["onClick"],Je={key:0,class:"text-xs text-destructive"},We={class:"flex gap-4"},Xe=["disabled"],Ze={key:0},Ie={key:1},st={__name:"TestCreateForm",setup(et){const{props:z}=Y(),B=n=>{const e=[],o=new Set,l=u=>{!u||!Array.isArray(u)||u.forEach(c=>{c&&c.id&&!o.has(c.id)&&(o.add(c.id),e.push(c),c.children&&Array.isArray(c.children)&&c.children.length>0&&l(c.children))})};return l(n),e},L=y(z.categories||[]),j=U(()=>B(L.value)),x=y(""),h=y(!1),V=y(null),q=U(()=>{if(!x.value)return j.value.slice(0,10);const n=x.value.toLowerCase();return j.value.filter(e=>e.name.toLowerCase().includes(n)).slice(0,10)}),M=()=>{clearTimeout(V.value),h.value=!0},F=()=>{V.value=setTimeout(()=>{h.value=!1},200)},R=()=>{h.value=!0},A=n=>{s.category_id=n.id,x.value=n.name,h.value=!1},D=()=>{s.category_id=null,x.value=""},v=y({date:"",time:""}),s=J({title:"",slug:"",description:"",category_id:null,status:"draft",time_limit:null,published_at:null,questions:[]}),O=()=>{(!s.slug||s.slug==="")&&(s.slug=s.title.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"").trim())},w=()=>{s.questions.push({question_text:"",question_type:"multiple_choice",points:10,explanation:"",order:s.questions.length,options:[{option_text:"",is_correct:!1,order:0},{option_text:"",is_correct:!1,order:1},{option_text:"",is_correct:!1,order:2},{option_text:"",is_correct:!1,order:3}]})},K=n=>{s.questions.splice(n,1),s.questions.forEach((e,o)=>{e.order=o})},N=n=>{const e=s.questions[n];e.options.push({option_text:"",is_correct:!1,order:e.options.length})},H=(n,e)=>{const o=s.questions[n];o.options.length>2&&(o.options.splice(e,1),o.options.forEach((l,u)=>{l.order=u}))},P=(n,e)=>{s.questions[n].options.forEach((l,u)=>{l.is_correct=u===e})},i=y({}),G=()=>(i.value={},(!s.title||s.title.trim()==="")&&(i.value.title="Başlık zorunludur."),(!s.slug||s.slug.trim()==="")&&(i.value.slug="Slug zorunludur."),s.questions.length===0&&(i.value.questions="En az bir soru eklenmelidir."),s.questions.forEach((n,e)=>{(!n.question_text||n.question_text.trim()==="")&&(i.value[`questions.${e}.question_text`]="Soru metni zorunludur."),(!n.options||n.options.length<2)&&(i.value[`questions.${e}.options`]="En az 2 şık eklenmelidir."),n.options.some(l=>l.is_correct)||(i.value[`questions.${e}.options`]="En az bir doğru cevap seçilmelidir."),n.options.forEach((l,u)=>{(!l.option_text||l.option_text.trim()==="")&&(i.value[`questions.${e}.options.${u}.option_text`]="Şık metni zorunludur.")})}),Object.keys(i.value).length===0),T=()=>{if(!G())return;v.value.date&&v.value.time?s.published_at=`${v.value.date}T${v.value.time}:00`:s.published_at=null;const n=s.questions.map((e,o)=>({question_text:e.question_text,question_type:e.question_type||"multiple_choice",points:e.points||10,explanation:e.explanation||null,order:o,options:e.options.map((l,u)=>({option_text:l.option_text,is_correct:l.is_correct||!1,order:u}))}));s.questions=n,s.post(route("tests.store"),{onSuccess:e=>{var o,l;(l=(o=e==null?void 0:e.props)==null?void 0:o.test)!=null&&l.slug&&ie.visit(route("tests.show",{test:e.props.test.slug}))},onError:e=>{e&&Object.keys(e).forEach(o=>{i.value.hasOwnProperty(o)&&(i.value[o]=e[o])})}})};s.questions.length===0&&w(),W(()=>s.processing,n=>{window.dispatchEvent(new CustomEvent("formProcessingState",{detail:{processing:n}}))});let _=null,k=null;const Q=()=>{s.reset(),s.processing=!1,Object.keys(i.value).forEach(n=>{i.value[n]=""}),v.value={date:"",time:""},x.value="",s.category_id=null,s.questions=[],w()};return X(()=>{s.processing=!1,window.dispatchEvent(new CustomEvent("formProcessingState",{detail:{processing:!1}})),_=()=>{T()},window.addEventListener("sidebarFormSubmit",_),k=()=>{Q()},window.addEventListener("sidebarFormReset",k)}),Z(()=>{_&&window.removeEventListener("sidebarFormSubmit",_),k&&window.removeEventListener("sidebarFormReset",k)}),(n,e)=>(a(),d("div",le,[e[29]||(e[29]=t("div",{class:"mb-6"},[t("h1",{class:"text-3xl font-bold text-foreground"},"Yeni Test Oluştur"),t("p",{class:"mt-2 text-sm text-muted-foreground"},"Test bilgilerini ve sorularını ekleyin")],-1)),t("form",{onSubmit:re(T,["prevent"]),class:"space-y-6"},[t("div",ne,[e[17]||(e[17]=t("h2",{class:"text-xl font-semibold text-foreground"},"Test Bilgileri",-1)),t("div",ue,[t("div",de,[e[9]||(e[9]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Test Başlığı *",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>r(s).title=o),onInput:O,placeholder:"Test başlığını girin",class:g(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.title||r(s).errors.title}])},null,34),[[m,r(s).title]]),i.value.title||r(s).errors.title?(a(),d("p",ae,b(i.value.title||r(s).errors.title),1)):f("",!0)],512),t("div",ce,[e[10]||(e[10]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Slug *",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=o=>r(s).slug=o),placeholder:"test-slug",class:g(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.slug||r(s).errors.slug}])},null,2),[[m,r(s).slug]]),i.value.slug||r(s).errors.slug?(a(),d("p",fe,b(i.value.slug||r(s).errors.slug),1)):f("",!0)],512),t("div",pe,[e[12]||(e[12]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Durum *",-1)),p(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>r(s).status=o),class:g(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",{"border-destructive focus-visible:ring-destructive":i.value.status||r(s).errors.status}])},[...e[11]||(e[11]=[t("option",{value:"draft"},"Taslak",-1),t("option",{value:"published"},"Yayınlandı",-1),t("option",{value:"private"},"Gizli",-1)])],2),[[I,r(s).status]]),i.value.status||r(s).errors.status?(a(),d("p",be,b(i.value.status||r(s).errors.status),1)):f("",!0)],512),t("div",me,[e[13]||(e[13]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Açıklama",-1)),p(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=o=>r(s).description=o),rows:"3",placeholder:"Test hakkında kısa bir açıklama",class:g(["flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.description||r(s).errors.description}])},null,2),[[m,r(s).description]]),i.value.description||r(s).errors.description?(a(),d("p",ge,b(i.value.description||r(s).errors.description),1)):f("",!0)],512),t("div",ve,[e[14]||(e[14]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Kategori",-1)),t("div",xe,[p(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=o=>x.value=o),onFocus:M,onBlur:F,onInput:R,onKeydown:e[5]||(e[5]=ee(o=>h.value=!1,["esc"])),placeholder:"Kategori seçin...",class:g(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 pr-8 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.category_id||r(s).errors.category_id}]),tabindex:"0"},null,34),[[m,x.value]]),x.value?(a(),d("button",{key:0,onClick:D,class:"absolute right-2 top-1/2 inline-flex h-5 w-5 -translate-y-1/2 items-center justify-center rounded text-xs hover:bg-accent"}," ✕ ")):f("",!0),h.value&&q.value.length>0?(a(),d("ul",he,[(a(!0),d($,null,S(q.value,o=>(a(),d("li",{key:o.id,onMousedown:l=>A(o),class:"cursor-pointer px-2 py-1.5 text-sm hover:bg-accent"},b(o.name),41,ye))),128))])):f("",!0)]),i.value.category_id||r(s).errors.category_id?(a(),d("p",_e,b(i.value.category_id||r(s).errors.category_id),1)):f("",!0)],512),t("div",ke,[e[15]||(e[15]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Süre Limiti (dakika)",-1)),p(t("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=o=>r(s).time_limit=o),min:"0",placeholder:"Boş bırakılabilir",class:g(["flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.time_limit||r(s).errors.time_limit}])},null,2),[[m,r(s).time_limit,void 0,{number:!0}]]),i.value.time_limit||r(s).errors.time_limit?(a(),d("p",we,b(i.value.time_limit||r(s).errors.time_limit),1)):f("",!0)],512),t("div",Ce,[e[16]||(e[16]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Yayınlama Tarihi",-1)),t("div",$e,[p(t("input",{type:"date","onUpdate:modelValue":e[7]||(e[7]=o=>v.value.date=o),class:g(["flex h-9 flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.published_at||r(s).errors.published_at}])},null,2),[[m,v.value.date]]),p(t("input",{type:"time","onUpdate:modelValue":e[8]||(e[8]=o=>v.value.time=o),class:g(["flex h-9 flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":i.value.published_at||r(s).errors.published_at}])},null,2),[[m,v.value.time]])]),i.value.published_at||r(s).errors.published_at?(a(),d("p",Se,b(i.value.published_at||r(s).errors.published_at),1)):f("",!0)],512)])]),t("div",Ee,[t("div",{class:"flex items-center justify-between"},[e[19]||(e[19]=t("h2",{class:"text-xl font-semibold text-foreground"},"Sorular",-1)),t("button",{type:"button",onClick:w,class:"inline-flex h-9 items-center justify-center gap-2 rounded-md bg-primary px-4 text-sm font-medium text-primary-foreground hover:bg-primary/90"},[...e[18]||(e[18]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),E(" Soru Ekle ",-1)])])]),r(s).questions.length===0?(a(),d("p",je,' Henüz soru eklenmedi. "Soru Ekle" butonuna tıklayarak soru ekleyin. ')):f("",!0),(a(!0),d($,null,S(r(s).questions,(o,l)=>(a(),d("div",{key:l,class:"space-y-4 rounded-lg border border-border bg-background p-4"},[t("div",Ve,[t("h3",qe,"Soru "+b(l+1),1),t("button",{type:"button",onClick:u=>K(l),class:"inline-flex h-8 w-8 items-center justify-center rounded-md text-destructive hover:bg-destructive/10"},[...e[20]||(e[20]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Te)]),t("div",Ue,[t("div",null,[e[21]||(e[21]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Soru Metni *",-1)),p(t("textarea",{"onUpdate:modelValue":u=>o.question_text=u,rows:"3",placeholder:"Soruyu buraya yazın...",class:g(["flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",{"border-destructive focus-visible:ring-destructive":i.value[`questions.${l}.question_text`]||r(s).errors[`questions.${l}.question_text`]}])},null,10,ze),[[m,o.question_text]]),i.value[`questions.${l}.question_text`]||r(s).errors[`questions.${l}.question_text`]?(a(),d("p",Be,b(i.value[`questions.${l}.question_text`]||r(s).errors[`questions.${l}.question_text`]),1)):f("",!0)]),t("div",Le,[t("div",null,[e[22]||(e[22]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Puan",-1)),p(t("input",{type:"number","onUpdate:modelValue":u=>o.points=u,min:"1",placeholder:"10",class:"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,8,Me),[[m,o.points,void 0,{number:!0}]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"mb-1 block text-sm font-medium text-foreground"},"Açıklama",-1)),p(t("input",{type:"text","onUpdate:modelValue":u=>o.explanation=u,placeholder:"Doğru cevap açıklaması (opsiyonel)",class:"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,8,Fe),[[m,o.explanation]])])]),t("div",Re,[t("div",Ae,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-foreground"},"Şıklar *",-1)),t("button",{type:"button",onClick:u=>N(l),class:"inline-flex h-8 items-center justify-center gap-1 rounded-md border border-input bg-background px-3 text-xs font-medium text-foreground hover:bg-accent"},[...e[24]||(e[24]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),E(" Şık Ekle ",-1)])],8,De)]),(a(!0),d($,null,S(o.options,(u,c)=>(a(),d("div",{key:c,class:"flex items-start gap-3 rounded-lg border border-border bg-background p-3"},[t("div",Oe,[t("div",Ke,[t("span",Ne,b(String.fromCharCode(65+c)),1),p(t("input",{type:"text","onUpdate:modelValue":C=>u.option_text=C,placeholder:`Şık ${c+1} metni`,class:g(["flex-1 rounded-md border border-input bg-background px-3 py-1.5 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",{"border-destructive focus-visible:ring-destructive":i.value[`questions.${l}.options.${c}.option_text`]||r(s).errors[`questions.${l}.options.${c}.option_text`]}])},null,10,He),[[m,u.option_text]])])]),t("div",Pe,[t("label",Ge,[t("input",{type:"radio",name:`question-${l}-correct`,checked:u.is_correct,onChange:C=>P(l,c),class:"h-4 w-4 cursor-pointer text-primary focus:ring-primary"},null,40,Qe),e[26]||(e[26]=t("span",{class:"text-xs text-muted-foreground"},"Doğru",-1))]),o.options.length>2?(a(),d("button",{key:0,type:"button",onClick:C=>H(l,c),class:"inline-flex h-8 w-8 items-center justify-center rounded-md text-destructive hover:bg-destructive/10"},[...e[27]||(e[27]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Ye)):f("",!0)])]))),128)),i.value[`questions.${l}.options`]||r(s).errors[`questions.${l}.options`]?(a(),d("p",Je,b(i.value[`questions.${l}.options`]||r(s).errors[`questions.${l}.options`]),1)):f("",!0)])])]))),128))]),t("div",We,[t("button",{type:"submit",disabled:r(s).processing,class:"inline-flex h-11 items-center justify-center rounded-md bg-primary px-8 text-sm font-medium text-primary-foreground hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-50"},[r(s).processing?(a(),d("span",Ze,"Kaydediliyor...")):(a(),d("span",Ie,"Testi Kaydet"))],8,Xe),te(r(oe),{href:"/tests",class:"inline-flex h-11 items-center justify-center rounded-md border border-input bg-background px-8 text-sm font-medium text-foreground hover:bg-accent hover:text-accent-foreground"},{default:se(()=>[...e[28]||(e[28]=[E(" İptal ",-1)])]),_:1})])],32)]))}};export{st as default};
