import{Q,r as x,p as j,T as W,y as Y,m as Z,c as u,a as t,l as ee,k as z,h as g,v as L,u as l,n as M,t as b,I as te,F as se,g as re,D as oe,f as T,o as c,J as ie}from"./ssr-Dv_HsqzD.js";const ne={class:"mx-auto mt-6 w-full max-w-full px-3 sm:px-5 lg:mt-0"},le={class:"container mx-auto p-0 sm:p-4"},ae={class:"rounded-lg border border-border bg-card text-card-foreground shadow-sm"},de={class:"p-4 sm:p-6"},ue={class:"w-full"},ce={key:0,class:"mt-1 text-sm text-destructive"},fe={class:"w-full"},me={key:0,class:"mt-1 text-sm text-destructive"},ge={class:"w-full"},pe={class:"relative w-full"},ve={key:0,class:"absolute z-30 mt-1 w-full rounded-md border border-border bg-popover shadow-lg"},be={class:"max-h-60 w-full overflow-y-auto p-1"},he=["onMousedown"],xe={class:"flex flex-col gap-0.5"},we={class:"font-medium"},ye={key:0,class:"text-xs text-muted-foreground"},ke={key:1,class:"mt-2 flex items-center gap-2"},_e={class:"inline-flex flex-col items-start rounded-full border border-border bg-secondary px-2 py-1 text-xs font-semibold text-secondary-foreground"},Ce={key:0,class:"text-[10px] font-normal opacity-80"},ze={key:0,class:"mt-1 text-sm text-destructive"},Me={class:"w-full"},Pe={key:0,class:"mt-1 text-sm text-destructive"},Ee={class:"mt-5 flex flex-col justify-between gap-3 sm:flex-row"},Se=["disabled"],je={key:0,class:"mr-2 h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ve=Object.assign({name:"CategoriesEditFrom"},{__name:"CategoriesEditFrom",setup(Le){var F,V;const A=r=>{const e=[],n=new Set,m=a=>{!a||!Array.isArray(a)||a.forEach(i=>{i&&i.id&&!n.has(i.id)&&(n.add(i.id),e.push(i),i.children&&Array.isArray(i.children)&&i.children.length>0&&m(i.children))})};return m(r),e},{props:k}=Q(),_=x(k.categories||[]),f=j(()=>A(_.value)),p=x(k.category||{}),s=W({name:p.value.name||"",slug:p.value.slug||"",parent_id:p.value.parent_id||null,status:p.value.status||"public"}),v=x(((F=k.category.parent)==null?void 0:F.name)||""),C=x(((V=k.category.parent)==null?void 0:V.name)||""),h=x(!1),K=x(!1),B=x(null),y=r=>{if(!r||!f.value||f.value.length===0)return"";const e=a=>f.value.find(i=>i.id===a),n=(a,i=[])=>{const o=e(a);return o?(i.unshift(o.name),o.parent_id?n(o.parent_id,i):i):i},m=n(r);return m.length>1?m.slice(0,-1).join(" > "):""},P=r=>{if(!r||!f.value||f.value.length===0)return"";const e=a=>f.value.find(i=>i.id===a),n=(a,i=[])=>{const o=e(a);return o?(i.unshift(o.name),o.parent_id?n(o.parent_id,i):i):i};return n(r).join(" > ")},E=j(()=>{if(!f.value||f.value.length===0)return[];const r=(o,w=new Set)=>(f.value.filter(d=>d.parent_id===o).forEach(d=>{w.add(d.id),r(d.id,w)}),w),e=new Set([p.value.id]);r(p.value.id).forEach(o=>e.add(o));let m=f.value.filter(o=>o&&o.id&&!e.has(o.id));if(v.value){const o=v.value.toLowerCase(),w=[],S=new Set;return m.forEach(d=>{if(!d||!d.name||S.has(d.id))return;const X=d.name.toLowerCase().includes(o),J=y(d.id).toLowerCase().includes(o),O=P(d.id).toLowerCase().includes(o);(X||J||O)&&(S.add(d.id),w.push(d))}),w}const a=[],i=new Set;return m.forEach(o=>{o&&o.id&&!i.has(o.id)&&(i.add(o.id),a.push(o))}),a}),D=j(()=>!s.name||!s.slug);Y(()=>s.name,r=>{r&&(s.slug=r.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""))}),Z(()=>{if((!_.value||_.value.length===0)&&N(),s.parent_id){const r=f.value.find(e=>e.id===s.parent_id);if(r){const e=P(r.id);v.value=e,C.value=r.name}}document.addEventListener("keydown",r=>{r.key==="Escape"&&(h.value=!1)})});const I=()=>{clearTimeout(B.value),E.value.length>0&&(h.value=!0)},q=()=>{B.value=setTimeout(()=>{h.value=!1},100)},R=()=>{s.parent_id="",v.value.length>=1&&(h.value=!0)},U=r=>{if(!r||!r.id)return;s.parent_id=r.id,C.value=r.name;const e=P(r.id);v.value=e,ie(()=>{h.value=!1})},$=()=>{s.parent_id="",v.value="",C.value=""},H=()=>{s.put(route("categories.update",{category:p.value.id}))},N=async()=>{K.value=!0;try{const r=await fetch(route("categories.index"),{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!r.ok)throw new Error("Failed to fetch categories");const e=await r.json();_.value=e.categories||[]}catch(r){console.error("Error fetching categories:",r)}finally{K.value=!1}},G=r=>{confirm("Bu kategoriyi silmek istediğinize emin misiniz?")&&s.delete(route("categories.destroy",{category:r})).then(()=>{console.log("Kategori başarıyla silindi")}).catch(e=>{console.error("Kategori silinirken hata:",e)})};return(r,e)=>(c(),u("div",ne,[t("div",le,[t("div",ae,[t("div",de,[e[15]||(e[15]=t("div",{class:"mb-4"},[t("h2",{class:"text-lg font-semibold text-card-foreground"},"Kategori Düzenle"),t("p",{class:"mt-1 text-sm text-muted-foreground"}," Kategorileriniz için düzenlemeler yapabilirsiniz. İsterseniz bir üst kategori seçebilirsiniz. ")],-1)),e[16]||(e[16]=t("div",{class:"my-4 border-t border-border"},null,-1)),t("form",{onSubmit:ee(H,["prevent"]),class:"space-y-6"},[t("div",ue,[e[6]||(e[6]=t("label",{class:"mb-2 block text-sm font-medium text-foreground"},"İsim",-1)),z(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=n=>l(s).name=n),class:M(["flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":l(s).errors.name}]),placeholder:"Kategori ismi"},null,2),[[L,l(s).name]]),l(s).errors.name?(c(),u("p",ce,b(l(s).errors.name),1)):g("",!0)]),t("div",fe,[e[7]||(e[7]=t("label",{class:"mb-2 block text-sm font-medium text-foreground"},"Slug",-1)),z(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=n=>l(s).slug=n),class:M(["flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":l(s).errors.slug}]),placeholder:"kategori-slug"},null,2),[[L,l(s).slug]]),l(s).errors.slug?(c(),u("p",me,b(l(s).errors.slug),1)):g("",!0)]),t("div",ge,[e[10]||(e[10]=t("label",{class:"mb-2 block text-sm font-medium text-foreground"},"Üst Kategori",-1)),t("div",pe,[z(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=n=>v.value=n),onFocus:I,onBlur:q,onInput:R,onKeydown:e[3]||(e[3]=te(n=>h.value=!1,["esc"])),class:M(["flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":l(s).errors.parent_id}]),placeholder:"Üst kategori ara"},null,34),[[L,v.value]]),h.value&&E.value.length>0?(c(),u("div",ve,[t("ul",be,[(c(!0),u(se,null,re(E.value,n=>(c(),u("li",{key:n.id,onMousedown:m=>U(n),class:"cursor-pointer rounded-sm px-2 py-1.5 text-sm text-popover-foreground transition-colors hover:bg-accent hover:text-accent-foreground"},[t("div",xe,[t("span",we,b(n.name),1),y(n.id)?(c(),u("span",ye,[e[8]||(e[8]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mr-1 inline h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1)),T(" "+b(y(n.id)),1)])):g("",!0)])],40,he))),128))])])):g("",!0),l(s).parent_id?(c(),u("div",ke,[t("div",_e,[t("span",null,b(C.value),1),y(l(s).parent_id)?(c(),u("span",Ce,b(y(l(s).parent_id)),1)):g("",!0)]),t("button",{type:"button",onClick:$,class:"inline-flex h-6 w-6 items-center justify-center rounded-md text-muted-foreground transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring","aria-label":"Remove parent category"},[...e[9]||(e[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):g("",!0)]),l(s).errors.parent_id?(c(),u("p",ze,b(l(s).errors.parent_id),1)):g("",!0)]),t("div",Me,[e[12]||(e[12]=t("label",{class:"mb-2 block text-sm font-medium text-foreground"},"Durum",-1)),z(t("select",{"onUpdate:modelValue":e[4]||(e[4]=n=>l(s).status=n),class:M(["flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive focus-visible:ring-destructive":l(s).errors.status}])},[...e[11]||(e[11]=[t("option",{value:"public"},"Açık",-1),t("option",{value:"hidden"},"Gizli",-1)])],2),[[oe,l(s).status]]),l(s).errors.status?(c(),u("p",Pe,b(l(s).errors.status),1)):g("",!0)]),t("div",Ee,[t("button",{type:"button",onClick:e[5]||(e[5]=n=>G(p.value.id)),class:"order-2 inline-flex h-9 items-center justify-center rounded-md border border-destructive/20 bg-background px-4 text-sm font-medium text-destructive transition-colors hover:bg-destructive hover:text-destructive-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 sm:order-1"}," Kategoriyi Sil "),t("button",{type:"submit",class:"order-1 inline-flex h-9 items-center justify-center rounded-md bg-primary px-4 text-sm font-medium text-primary-foreground shadow transition-colors hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 sm:order-2",disabled:l(s).processing||D.value},[l(s).processing?(c(),u("svg",je,[...e[13]||(e[13]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):g("",!0),e[14]||(e[14]=T(" Kategoriyi Güncelle ",-1))],8,Se)])],32)])])])]))}});export{Ve as default};
